.. index:: pair: example; distrans.cpp
.. _doxid-d4/d11/distrans_8cpp-example:

distrans.cpp
============

An example on using the distance transform\

.. ref-code-block:: cpp

	#include <opencv2/core/utility.hpp>
	#include "opencv2/imgproc.hpp"
	#include "opencv2/imgcodecs.hpp"
	#include "opencv2/highgui.hpp"
	
	#include <stdio.h>
	
	using namespace :ref:`std <doxid-d8/dcc/namespacestd>`;
	using namespace :ref:`cv <doxid-d2/d75/namespacecv>`;
	
	int maskSize0 = :ref:`DIST_MASK_5 <doxid-d7/d1b/group__imgproc__misc_1ggaaa68392323ccf7fad87570e41259b497a8a8b17ed6012f6ce42e56f302c07d481>`;
	int voronoiType = -1;
	int edgeThresh = 100;
	int distType0 = :ref:`DIST_L1 <doxid-d7/d1b/group__imgproc__misc_1ggaa2bfbebbc5c320526897996aafa1d8ebae5b2dfaf2ba5024d7ce47885001fad86>`;
	
	// The output and temporary images
	:ref:`Mat <doxid-db/de6/classcv_1_1_mat>` gray;
	
	// threshold trackbar callback
	static void onTrackbar( int, void* )
	{
	    static const Scalar colors[] =
	    {
	        :ref:`Scalar <doxid-dc/d84/group__core__basic_1ga599fe92e910c027be274233eccad7beb>`(0,0,0),
	        :ref:`Scalar <doxid-dc/d84/group__core__basic_1ga599fe92e910c027be274233eccad7beb>`(255,0,0),
	        :ref:`Scalar <doxid-dc/d84/group__core__basic_1ga599fe92e910c027be274233eccad7beb>`(255,128,0),
	        :ref:`Scalar <doxid-dc/d84/group__core__basic_1ga599fe92e910c027be274233eccad7beb>`(255,255,0),
	        :ref:`Scalar <doxid-dc/d84/group__core__basic_1ga599fe92e910c027be274233eccad7beb>`(0,255,0),
	        :ref:`Scalar <doxid-dc/d84/group__core__basic_1ga599fe92e910c027be274233eccad7beb>`(0,128,255),
	        :ref:`Scalar <doxid-dc/d84/group__core__basic_1ga599fe92e910c027be274233eccad7beb>`(0,255,255),
	        :ref:`Scalar <doxid-dc/d84/group__core__basic_1ga599fe92e910c027be274233eccad7beb>`(0,0,255),
	        :ref:`Scalar <doxid-dc/d84/group__core__basic_1ga599fe92e910c027be274233eccad7beb>`(255,0,255)
	    };
	
	    int maskSize = voronoiType >= 0 ? :ref:`DIST_MASK_5 <doxid-d7/d1b/group__imgproc__misc_1ggaaa68392323ccf7fad87570e41259b497a8a8b17ed6012f6ce42e56f302c07d481>` : maskSize0;
	    int distType = voronoiType >= 0 ? :ref:`DIST_L2 <doxid-d7/d1b/group__imgproc__misc_1ggaa2bfbebbc5c320526897996aafa1d8ebaff0d1f5be0fc152a56a9b9716d158b96>` : distType0;
	
	    :ref:`Mat <doxid-db/de6/classcv_1_1_mat>` edge = gray >= edgeThresh, dist, labels, dist8u;
	
	    if( voronoiType < 0 )
	        :ref:`distanceTransform <doxid-d7/d1b/group__imgproc__misc_1ga8a0b7fdfcb7a13dde018988ba3a43042>`( edge, dist, distType, maskSize );
	    else
	        :ref:`distanceTransform <doxid-d7/d1b/group__imgproc__misc_1ga8a0b7fdfcb7a13dde018988ba3a43042>`( edge, dist, labels, distType, maskSize, voronoiType );
	
	    if( voronoiType < 0 )
	    {
	        // begin "painting" the distance transform result
	        dist *= 5000;
	        :ref:`pow <doxid-d2/d75/namespacecv_1a8bc36646a43b82baa15f151a973fb0c5>`(dist, 0.5, dist);
	
	        :ref:`Mat <doxid-db/de6/classcv_1_1_mat>` dist32s, dist8u1, dist8u2;
	
	        dist.:ref:`convertTo <doxid-db/de6/classcv_1_1_mat_1adf88c60c5b4980e05bb556080916978b>`(dist32s, :ref:`CV_32S <doxid-d1/d1b/group__core__hal__interface_1ga4067910fc388075c3ea3aa14393e83b9>`, 1, 0.5);
	        dist32s &= Scalar::all(255);
	
	        dist32s.:ref:`convertTo <doxid-db/de6/classcv_1_1_mat_1adf88c60c5b4980e05bb556080916978b>`(dist8u1, :ref:`CV_8U <doxid-d1/d1b/group__core__hal__interface_1ga32b18d904ee2b1731a9416a8eef67d06>`, 1, 0);
	        dist32s *= -1;
	
	        dist32s += Scalar::all(255);
	        dist32s.:ref:`convertTo <doxid-db/de6/classcv_1_1_mat_1adf88c60c5b4980e05bb556080916978b>`(dist8u2, :ref:`CV_8U <doxid-d1/d1b/group__core__hal__interface_1ga32b18d904ee2b1731a9416a8eef67d06>`);
	
	        :ref:`Mat <doxid-db/de6/classcv_1_1_mat>` planes[] = {dist8u1, dist8u2, dist8u2};
	        :ref:`merge <doxid-d2/de8/group__core__array_1ga7d7b4d6c6ee504b30a20b1680029c7b4>`(planes, 3, dist8u);
	    }
	    else
	    {
	        dist8u.create(labels.size(), :ref:`CV_8UC3 <doxid-d1/d1b/group__core__hal__interface_1ga88c4cd9de76f678f33928ef1e3f96047>`);
	        for( int i = 0; i < labels.rows; i++ )
	        {
	            const int* ll = (const int*)labels.ptr(i);
	            const float* dd = (const float*)dist.ptr(i);
	            :ref:`uchar <doxid-d1/d1b/group__core__hal__interface_1ga65f85814a8290f9797005d3b28e7e5fc>`* d = (:ref:`uchar <doxid-d1/d1b/group__core__hal__interface_1ga65f85814a8290f9797005d3b28e7e5fc>`*)dist8u.ptr(i);
	            for( int j = 0; j < labels.cols; j++ )
	            {
	                int idx = ll[j] == 0 || dd[j] == 0 ? 0 : (ll[j]-1)%8 + 1;
	                float scale = 1.f/(1 + dd[j]*dd[j]*0.0004f);
	                int b = :ref:`cvRound <doxid-db/de0/group__core__utils_1ga085eca238176984a0b72df2818598d85>`(colors[idx][0]*scale);
	                int g = :ref:`cvRound <doxid-db/de0/group__core__utils_1ga085eca238176984a0b72df2818598d85>`(colors[idx][1]*scale);
	                int r = :ref:`cvRound <doxid-db/de0/group__core__utils_1ga085eca238176984a0b72df2818598d85>`(colors[idx][2]*scale);
	                d[j*3] = (:ref:`uchar <doxid-d1/d1b/group__core__hal__interface_1ga65f85814a8290f9797005d3b28e7e5fc>`)b;
	                d[j*3+1] = (:ref:`uchar <doxid-d1/d1b/group__core__hal__interface_1ga65f85814a8290f9797005d3b28e7e5fc>`)g;
	                d[j*3+2] = (:ref:`uchar <doxid-d1/d1b/group__core__hal__interface_1ga65f85814a8290f9797005d3b28e7e5fc>`)r;
	            }
	        }
	    }
	
	    :ref:`imshow <doxid-d7/dfc/group__highgui_1ga453d42fe4cb60e5723281a89973ee563>`("Distance Map", dist8u );
	}
	
	static void help()
	{
	    printf("\nProgram to demonstrate the use of the distance transform function between edge images.\n"
	            "Usage:\n"
	            "./distrans [image_name -- default image is ../data/stuff.jpg]\n"
	            "\nHot keys: \n"
	            "\tESC - quit the program\n"
	            "\tC - use C/Inf metric\n"
	            "\tL1 - use L1 metric\n"
	            "\tL2 - use L2 metric\n"
	            "\t3 - use 3x3 mask\n"
	            "\t5 - use 5x5 mask\n"
	            "\t0 - use precise distance transform\n"
	            "\tv - switch to Voronoi diagram mode\n"
	            "\tp - switch to pixel-based Voronoi diagram mode\n"
	            "\tSPACE - loop through all the modes\n\n");
	}
	
	const char* keys =
	{
	    "{help h||}{@image |../data/stuff.jpg|input image file}"
	};
	
	int main( int argc, const char** argv )
	{
	    :ref:`CommandLineParser <doxid-da/dd8/classcv_1_1_command_line_parser>` parser(argc, argv, keys);
	    help();
	    if (parser.has("help"))
	        return 0;
	    string filename = parser.get<string>(0);
	    gray = :ref:`imread <doxid-d4/da8/group__imgcodecs_1ga288b8b3da0892bd651fce07b3bbd3a56>`(filename, 0);
	    if(gray.empty())
	    {
	        printf("Cannot read image file: %s\n", filename.c_str());
	        help();
	        return -1;
	    }
	
	    :ref:`namedWindow <doxid-d7/dfc/group__highgui_1ga5afdf8410934fd099df85c75b2e0888b>`("Distance Map", 1);
	    :ref:`createTrackbar <doxid-d7/dfc/group__highgui_1gaf78d2155d30b728fc413803745b67a9b>`("Brightness Threshold", "Distance Map", &edgeThresh, 255, onTrackbar, 0);
	
	    for(;;)
	    {
	        // Call to update the view
	        onTrackbar(0, 0);
	
	        char c = (char):ref:`waitKey <doxid-d7/dfc/group__highgui_1ga5628525ad33f52eab17feebcfba38bd7>`(0);
	
	        if( c == 27 )
	            break;
	
	        if( c == 'c' || c == 'C' || c == '1' || c == '2' ||
	            c == '3' || c == '5' || c == '0' )
	            voronoiType = -1;
	
	        if( c == 'c' || c == 'C' )
	            distType0 = :ref:`DIST_C <doxid-d7/d1b/group__imgproc__misc_1ggaa2bfbebbc5c320526897996aafa1d8eba507b16eb5ef95ea784ca1b3cb7b0d7ee>`;
	        else if( c == '1' )
	            distType0 = :ref:`DIST_L1 <doxid-d7/d1b/group__imgproc__misc_1ggaa2bfbebbc5c320526897996aafa1d8ebae5b2dfaf2ba5024d7ce47885001fad86>`;
	        else if( c == '2' )
	            distType0 = :ref:`DIST_L2 <doxid-d7/d1b/group__imgproc__misc_1ggaa2bfbebbc5c320526897996aafa1d8ebaff0d1f5be0fc152a56a9b9716d158b96>`;
	        else if( c == '3' )
	            maskSize0 = :ref:`DIST_MASK_3 <doxid-d7/d1b/group__imgproc__misc_1ggaaa68392323ccf7fad87570e41259b497a520d4f90e1e37d13d7592fd295a6b5b2>`;
	        else if( c == '5' )
	            maskSize0 = :ref:`DIST_MASK_5 <doxid-d7/d1b/group__imgproc__misc_1ggaaa68392323ccf7fad87570e41259b497a8a8b17ed6012f6ce42e56f302c07d481>`;
	        else if( c == '0' )
	            maskSize0 = :ref:`DIST_MASK_PRECISE <doxid-d7/d1b/group__imgproc__misc_1ggaaa68392323ccf7fad87570e41259b497a71e13e06c1d12eabd2acd2669f94f9ca>`;
	        else if( c == 'v' )
	            voronoiType = 0;
	        else if( c == 'p' )
	            voronoiType = 1;
	        else if( c == ' ' )
	        {
	            if( voronoiType == 0 )
	                voronoiType = 1;
	            else if( voronoiType == 1 )
	            {
	                voronoiType = -1;
	                maskSize0 = :ref:`DIST_MASK_3 <doxid-d7/d1b/group__imgproc__misc_1ggaaa68392323ccf7fad87570e41259b497a520d4f90e1e37d13d7592fd295a6b5b2>`;
	                distType0 = :ref:`DIST_C <doxid-d7/d1b/group__imgproc__misc_1ggaa2bfbebbc5c320526897996aafa1d8eba507b16eb5ef95ea784ca1b3cb7b0d7ee>`;
	            }
	            else if( distType0 == :ref:`DIST_C <doxid-d7/d1b/group__imgproc__misc_1ggaa2bfbebbc5c320526897996aafa1d8eba507b16eb5ef95ea784ca1b3cb7b0d7ee>` )
	                distType0 = :ref:`DIST_L1 <doxid-d7/d1b/group__imgproc__misc_1ggaa2bfbebbc5c320526897996aafa1d8ebae5b2dfaf2ba5024d7ce47885001fad86>`;
	            else if( distType0 == :ref:`DIST_L1 <doxid-d7/d1b/group__imgproc__misc_1ggaa2bfbebbc5c320526897996aafa1d8ebae5b2dfaf2ba5024d7ce47885001fad86>` )
	                distType0 = :ref:`DIST_L2 <doxid-d7/d1b/group__imgproc__misc_1ggaa2bfbebbc5c320526897996aafa1d8ebaff0d1f5be0fc152a56a9b9716d158b96>`;
	            else if( maskSize0 == :ref:`DIST_MASK_3 <doxid-d7/d1b/group__imgproc__misc_1ggaaa68392323ccf7fad87570e41259b497a520d4f90e1e37d13d7592fd295a6b5b2>` )
	                maskSize0 = :ref:`DIST_MASK_5 <doxid-d7/d1b/group__imgproc__misc_1ggaaa68392323ccf7fad87570e41259b497a8a8b17ed6012f6ce42e56f302c07d481>`;
	            else if( maskSize0 == :ref:`DIST_MASK_5 <doxid-d7/d1b/group__imgproc__misc_1ggaaa68392323ccf7fad87570e41259b497a8a8b17ed6012f6ce42e56f302c07d481>` )
	                maskSize0 = :ref:`DIST_MASK_PRECISE <doxid-d7/d1b/group__imgproc__misc_1ggaaa68392323ccf7fad87570e41259b497a71e13e06c1d12eabd2acd2669f94f9ca>`;
	            else if( maskSize0 == :ref:`DIST_MASK_PRECISE <doxid-d7/d1b/group__imgproc__misc_1ggaaa68392323ccf7fad87570e41259b497a71e13e06c1d12eabd2acd2669f94f9ca>` )
	                voronoiType = 0;
	        }
	    }
	
	    return 0;
	}
