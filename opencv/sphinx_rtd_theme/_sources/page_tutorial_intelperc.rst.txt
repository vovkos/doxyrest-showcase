.. index:: pair: page; Using Creative Senz3D and other Intel Perceptual Computing SDK compatible depth sensors
.. _doxid-db/d08/tutorial_intelperc:

Using Creative Senz3D and other Intel Perceptual Computing SDK compatible depth sensors
=======================================================================================

Depth sensors compatible with Intel Perceptual Computing SDK are supported through VideoCapture class. Depth map, RGB image and some other formats of output can be retrieved by using familiar interface of VideoCapture.

In order to use depth sensor with OpenCV you should do the following preliminary steps:

#. Install Intel Perceptual Computing SDK (from here `http://www.intel.com/software/perceptual <http://www.intel.com/software/perceptual>`__).

#. Configure OpenCV with Intel Perceptual Computing SDK support by setting WITH_INTELPERC flag in CMake. If Intel Perceptual Computing SDK is found in install folders OpenCV will be built with Intel Perceptual Computing SDK library (see a status INTELPERC in CMake log). If CMake process doesn't find Intel Perceptual Computing SDK installation folder automatically, the user should change corresponding CMake variables INTELPERC_LIB_DIR and INTELPERC_INCLUDE_DIR to the proper value.

#. Build OpenCV.

VideoCapture can retrieve the following data:

#. data given from depth generator:
   
   * CAP_INTELPERC_DEPTH_MAP - each pixel is a 16-bit integer. The value indicates the distance from an object to the camera's XY plane or the Cartesian depth. (CV_16UC1)
   
   * CAP_INTELPERC_UVDEPTH_MAP - each pixel contains two 32-bit floating point values in the range of 0-1, representing the mapping of depth coordinates to the color coordinates. (CV_32FC2)
   
   * CAP_INTELPERC_IR_MAP - each pixel is a 16-bit integer. The value indicates the intensity of the reflected laser beam. (CV_16UC1)

#. data given from RGB image generator:
   
   * CAP_INTELPERC_IMAGE - color image. (CV_8UC3)

In order to get depth map from depth sensor use VideoCapture::operator >>, e. g. :

.. ref-code-block:: cpp

	VideoCapture capture( :ref:`CAP_INTELPERC <doxid-d4/d15/group__videoio__flags__base_1gga023786be1ee68a9105bf2e48c700294dabe0df46cd132d1cfbae88efd6f4becdf>` );
	for(;;)
	{
	    Mat depthMap;
	    capture >> depthMap;
	
	    if( :ref:`waitKey <doxid-d7/dfc/group__highgui_1ga5628525ad33f52eab17feebcfba38bd7>`( 30 ) >= 0 )
	        break;
	}

For getting several data maps use VideoCapture::grab and VideoCapture::retrieve, e.g. :

.. ref-code-block:: cpp

	VideoCapture capture(:ref:`CAP_INTELPERC <doxid-d4/d15/group__videoio__flags__base_1gga023786be1ee68a9105bf2e48c700294dabe0df46cd132d1cfbae88efd6f4becdf>`);
	for(;;)
	{
	    Mat depthMap;
	    Mat image;
	    Mat irImage;
	
	    capture.grab();
	
	    capture.retrieve( depthMap, :ref:`CAP_INTELPERC_DEPTH_MAP <doxid-dc/dfc/group__videoio__flags__others_1gga3f9a572bf02ebe19f6652ce7cadadc7ca0633813010b6c21838951de5fb34d643>` );
	    capture.retrieve(    image, :ref:`CAP_INTELPERC_IMAGE <doxid-dc/dfc/group__videoio__flags__others_1gga3f9a572bf02ebe19f6652ce7cadadc7ca5c722445f6d9324474cf50b39b92ae74>` );
	    capture.retrieve(  irImage, :ref:`CAP_INTELPERC_IR_MAP <doxid-dc/dfc/group__videoio__flags__others_1gga3f9a572bf02ebe19f6652ce7cadadc7ca56fd50220f952776712bcfb656a5c64d>`);
	
	    if( :ref:`waitKey <doxid-d7/dfc/group__highgui_1ga5628525ad33f52eab17feebcfba38bd7>`( 30 ) >= 0 )
	        break;
	}

For setting and getting some property of sensor` data generators use VideoCapture::set and VideoCapture::get methods respectively, e.g. :

.. ref-code-block:: cpp

	VideoCapture capture( :ref:`CAP_INTELPERC <doxid-d4/d15/group__videoio__flags__base_1gga023786be1ee68a9105bf2e48c700294dabe0df46cd132d1cfbae88efd6f4becdf>` );
	capture.set( :ref:`CAP_INTELPERC_DEPTH_GENERATOR <doxid-dc/dfc/group__videoio__flags__others_1ggabfc4ba1d1fb873f2b56d34032f86c1d4af09153f3c7f98ceb038d39453da205cf>` | :ref:`CAP_PROP_INTELPERC_PROFILE_IDX <doxid-dc/dfc/group__videoio__flags__others_1ggaf454b747a111dc9819419b99807ae7aca03489c9c3fc5b2656a9063f2e079d7a3>`, 0 );
	cout << "FPS    " << capture.get( :ref:`CAP_INTELPERC_DEPTH_GENERATOR <doxid-dc/dfc/group__videoio__flags__others_1ggabfc4ba1d1fb873f2b56d34032f86c1d4af09153f3c7f98ceb038d39453da205cf>`+:ref:`CAP_PROP_FPS <doxid-d4/d15/group__videoio__flags__base_1ggaeb8dd9c89c10a5c63c139bf7c4f5704daf01bc92359d2abc9e6eeb5cbe36d9af2>` ) << endl;

Since two types of sensor's data generators are supported (image generator and depth generator), there are two flags that should be used to set/get property of the needed generator:

* CAP_INTELPERC_IMAGE_GENERATOR a flag for access to the image generator properties.

* CAP_INTELPERC_DEPTH_GENERATOR a flag for access to the depth generator properties. This flag value is assumed by default if neither of the two possible values of the property is set.

For more information please refer to the example of usage `intelperc_capture.cpp <https://github.com/opencv/tree/master/samples/cpp/intelperc_capture.cpp>`__ in opencv/samples/cpp folder.

