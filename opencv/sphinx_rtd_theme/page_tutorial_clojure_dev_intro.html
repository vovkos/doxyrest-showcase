

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Introduction to OpenCV Development with Clojure &mdash; OpenCV Documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="_static/target-highlight.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/doxyrest-pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/doxyrest-sphinx_rtd_theme.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Load and Display an Image" href="page_tutorial_display_image.html" />
    <link rel="prev" title="Introduction to Java Development" href="page_tutorial_java_dev_intro.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> OpenCV Documentation
          

          
          </a>

          
            
            
              <div class="version">
                3.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="group_features2d.html">2D Features Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_viz.html">3D Visualizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_calib3d.html">Camera Calibration and 3D Reconstruction</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_flann.html">Clustering and Search in Multi-Dimensional Spaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_photo.html">Computational Photography</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_core.html">Core functionality</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_highgui.html">High-level GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_imgcodecs.html">Image file reading and writing</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_imgproc.html">Image processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_stitching.html">Images stitching</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_ml.html">Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_objdetect.html">Object Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_shape.html">Shape Distance and Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_superres.html">Super Resolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_video.html">Video Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_videoio.html">Video I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_videostab.html">Video Stabilization</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="page_citelist.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_cuda_intro.html">CUDA Module Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_imgproc_color_conversions.html">Color conversions</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_deprecated.html">Deprecated List</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_ml_intro.html">Machine Learning Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="page_tutorial_root.html">OpenCV Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_features2d.html">2D Features framework (feature2d module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_calib3d.html">Camera calibration and 3D reconstruction (calib3d module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_photo.html">Computational photography (photo module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_gpu.html">GPU-Accelerated Computer Vision (cuda module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_highgui.html">High Level GUI and Media (highgui module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_imgcodecs.html">Image Input and Output (imgcodecs module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_imgproc.html">Image Processing (imgproc module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_stitching.html">Images stitching (stitching module)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="page_tutorial_table_of_content_introduction.html">Introduction to OpenCV</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_dev_with_OCV_on_Android.html">Android Development with OpenCV</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_building_tegra_cuda.html">Building OpenCV for Tegra with CUDA</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_arm_crosscompile_with_cmake.html">Cross compilation for ARM based Linux systems</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_windows_visual_studio_Opencv.html">How to build applications with OpenCV inside the “Microsoft Visual Studio”</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_windows_visual_studio_image_watch.html">Image Watch: viewing in-memory images in the Visual Studio debugger</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_linux_install.html">Installation in Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_windows_install.html">Installation in Windows</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_ios_install.html">Installation in iOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_android_dev_intro.html">Introduction into Android Development</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_java_dev_intro.html">Introduction to Java Development</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Introduction to OpenCV Development with Clojure</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_display_image.html">Load and Display an Image</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_load_save_image.html">Load, Modify, and Save an Image</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_O4A_SDK.html">OpenCV4Android SDK</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_transition_guide.html">Transition guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_android_ocl_intro.html">Use OpenCL in Android camera preview based CV application</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_java_eclipse.html">Using OpenCV Java with Eclipse</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_linux_eclipse.html">Using OpenCV with Eclipse (plugin CDT)</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_biicode.html">Using OpenCV with biicode dependency manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_linux_gcc_cmake.html">Using OpenCV with gcc and CMake</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_documentation.html">Writing documentation for OpenCV</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_ml.html">Machine Learning (ml module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_objdetect.html">Object Detection (objdetect module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_viz.html">OpenCV Viz</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_ios.html">OpenCV iOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_core.html">The Core Functionality (core module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_videoio.html">Video Input and Output (videoio module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_video.html">Video analysis (video module)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="page_index.html">OpenCV modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_tutorial_py_root.html">OpenCV-Python Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_todo.html">Todo List</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_videoio_overview.html">Video I/O with OpenCV Overview</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="example_contours2.cpp.html">contours2.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_convexhull.cpp.html">convexhull.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_cout_mat.cpp.html">cout_mat.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_demhist.cpp.html">demhist.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_distrans.cpp.html">distrans.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_edge.cpp.html">edge.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_ffilldemo.cpp.html">ffilldemo.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_filestorage.cpp.html">filestorage.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_fitellipse.cpp.html">fitellipse.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_grabcut.cpp.html">grabcut.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_houghcircles.cpp.html">houghcircles.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_houghlines.cpp.html">houghlines.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_kmeans.cpp.html">kmeans.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_laplace.cpp.html">laplace.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_lsd_lines.cpp.html">lsd_lines.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_minarea.cpp.html">minarea.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_morphology2.cpp.html">morphology2.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_pca.cpp.html">pca.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_polar_transforms.cpp.html">polar_transforms.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_segment_objects.cpp.html">segment_objects.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_watershed.cpp.html">watershed.cpp</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="global.html">Global Namespace</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">OpenCV Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="page_tutorial_root.html">OpenCV Tutorials</a> &raquo;</li>
        
          <li><a href="page_tutorial_table_of_content_introduction.html">Introduction to OpenCV</a> &raquo;</li>
        
      <li>Introduction to OpenCV Development with Clojure</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="introduction-to-opencv-development-with-clojure">
<span id="doxid-d7-d1e-tutorial-clojure-dev-intro"></span><span id="index-0"></span><h1>Introduction to OpenCV Development with Clojure</h1>
<p>As of OpenCV 2.4.4, OpenCV supports desktop Java development using nearly the same interface as for Android development.</p>
<p><a class="reference external" href="http://clojure.org/">Clojure</a> is a contemporary LISP dialect hosted by the Java Virtual Machine and it offers a complete interoperability with the underlying JVM. This means that we should even be able to use the Clojure REPL (Read Eval Print Loop) as and interactive programmable interface to the underlying OpenCV engine.</p>
<p class="rubric">What we’ll do in this tutorial</p>
<p>This tutorial will help you in setting up a basic Clojure environment for interactively learning OpenCV within the fully programmable CLojure REPL.</p>
<p class="rubric">Tutorial source code</p>
<p>You can find a runnable source code of the sample in the <code class="docutils literal notranslate"><span class="pre">samples/java/clojure/simple-sample</span></code> folder of the OpenCV repository. After having installed OpenCV and Clojure as explained in the tutorial, issue the following command to run the sample from the command line.</p>
<pre class="highlight literal-block">
<span></span><span class="n">cd</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">samples</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">clojure</span><span class="o">/</span><span class="n">simple</span><span class="o">-</span><span class="n">sample</span>
<span class="n">lein</span> <span class="n">run</span>
</pre>
<p class="rubric">Preamble</p>
<p>For detailed instruction on installing OpenCV with desktop Java support refer to the <a class="reference external" href="http://docs.opencv.org/2.4.4-beta/doc/tutorials/introduction/desktop_java/java_dev_intro.html">corresponding tutorial</a>.</p>
<p>If you are in hurry, here is a minimum quick start guide to install OpenCV on Mac OS X:</p>
<p>I’m assuming you already installed <a class="reference external" href="https://developer.apple.com/xcode/">xcode</a>, <a class="reference external" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">jdk</a> and <a class="reference external" href="http://www.cmake.org/cmake/resources/software.html">Cmake</a>.</p>
<pre class="highlight literal-block">
<span></span><span class="n">cd</span> <span class="o">~/</span>
<span class="n">mkdir</span> <span class="n">opt</span>
<span class="n">git</span> <span class="n">clone</span> <span class="nl">https</span><span class="p">:</span><span class="c1">//github.com/opencv/opencv.git</span>
<span class="n">cd</span> <span class="n">opencv</span>
<span class="n">git</span> <span class="n">checkout</span> <span class="mf">2.4</span>
<span class="n">mkdir</span> <span class="n">build</span>
<span class="n">cd</span> <span class="n">build</span>
<span class="n">cmake</span> <span class="o">-</span><span class="n">DBUILD_SHARED_LIBS</span><span class="o">=</span><span class="n">OFF</span> <span class="p">..</span>
<span class="p">...</span>
<span class="p">...</span>
<span class="n">make</span> <span class="o">-</span><span class="n">j8</span>
<span class="cp"># optional</span>
<span class="cp"># make install</span>
</pre>
<p class="rubric">Install Leiningen</p>
<p>Once you installed OpenCV with desktop java support the only other requirement is to install <a class="reference external" href="https://github.com/technomancy/leiningen">Leiningeng</a> which allows you to manage the entire life cycle of your CLJ projects.</p>
<p>The available <a class="reference external" href="https://github.com/technomancy/leiningen#installation">installation guide</a> is very easy to be followed:</p>
<ol class="arabic simple">
<li><a class="reference external" href="https://raw.github.com/technomancy/leiningen/stable/bin/lein">Download the script</a></li>
<li>Place it on your $PATH (cf./bin is a good choice if it is on your path.)</li>
<li>Set the script to be executable. (i.e. chmod 755/bin/lein).</li>
</ol>
<p>If you work on Windows, follow <a class="reference external" href="https://github.com/technomancy/leiningen#windows">this instruction</a></p>
<p>You now have both the OpenCV library and a fully installed basic Clojure environment. What is now needed is to configure the Clojure environment to interact with the OpenCV library.</p>
<p class="rubric">Install the localrepo Leiningen plugin</p>
<p>The set of commands (tasks in Leiningen parlance) natively supported by Leiningen can be very easily extended by various plugins. One of them is the <a class="reference external" href="https://github.com/kumarshantanu/lein-localrepo">lein-localrepo</a> plugin which allows to install any jar lib as an artifact in the local maven repository of your machine (typically in the /.m2/repository directory of your username).</p>
<p>We’re going to use this lein plugin to add to the local maven repository the opencv components needed by Java and Clojure to use the opencv lib.</p>
<p>Generally speaking, if you want to use a plugin on project base only, it can be added directly to a CLJ project created by lein.</p>
<p>Instead, when you want a plugin to be available to any CLJ project in your username space, you can add it to the profiles.clj in the/.lein/ directory.</p>
<p>The lein-localrepo plugin will be useful to me in other CLJ projects where I need to call native libs wrapped by a Java interface. So I decide to make it available to any CLJ project:</p>
<pre class="highlight literal-block">
<span></span><span class="n">mkdir</span> <span class="o">~/</span><span class="p">.</span><span class="n">lein</span>
</pre>
<p>Create a file named profiles.clj in the/.lein directory and copy into it the following content:</p>
<pre class="highlight literal-block">
<span></span><span class="p">{</span><span class="o">:</span><span class="n">user</span> <span class="p">{</span><span class="o">:</span><span class="n">plugins</span> <span class="p">[[</span><span class="n">lein</span><span class="o">-</span><span class="n">localrepo</span> <span class="s">&quot;0.5.2&quot;</span><span class="p">]]}}</span>
</pre>
<p>Here we’re saying that the version release “0.5.2” of the lein-localrepo plugin will be available to the :user profile for any CLJ project created by lein.</p>
<p>You do not need to do anything else to install the plugin because it will be automatically downloaded from a remote repository the very first time you issue any lein task.</p>
<p class="rubric">Install the java specific libs as local repository</p>
<p>If you followed the standard documentation for installing OpenCV on your computer, you should find the following two libs under the directory where you built OpenCV:</p>
<ul class="simple">
<li>the build/bin/opencv-247.jar java lib</li>
<li>the build/lib/libopencv_java247.dylib native lib (or .so in you built OpenCV a GNU/Linux OS)</li>
</ul>
<p>They are the only opencv libs needed by the JVM to interact with OpenCV.</p>
<p class="rubric">Take apart the needed opencv libs</p>
<p>Create a new directory to store in the above two libs. Start by copying into it the opencv-247.jar lib.</p>
<pre class="highlight literal-block">
<span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">opt</span>
<span class="n">mkdir</span> <span class="n">clj</span><span class="o">-</span><span class="n">opencv</span>
<span class="n">cd</span> <span class="n">clj</span><span class="o">-</span><span class="n">opencv</span>
<span class="n">cp</span> <span class="o">~/</span><span class="n">opt</span><span class="o">/</span><span class="n">opencv</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">opencv</span><span class="o">-</span><span class="mf">247.</span><span class="n">jar</span> <span class="p">.</span>
</pre>
<p>First lib done.</p>
<p>Now, to be able to add the libopencv_java247.dylib shared native lib to the local maven repository, we first need to package it as a jar file.</p>
<p>The native lib has to be copied into a directories layout which mimics the names of your operating system and architecture. I’m using a Mac OS X with a X86 64 bit architecture. So my layout will be the following:</p>
<pre class="highlight literal-block">
<span></span><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="n">native</span><span class="o">/</span><span class="n">macosx</span><span class="o">/</span><span class="n">x86_64</span>
</pre>
<p>Copy into the x86_64 directory the libopencv_java247.dylib lib.</p>
<pre class="highlight literal-block">
<span></span><span class="n">cp</span> <span class="o">~/</span><span class="n">opt</span><span class="o">/</span><span class="n">opencv</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libopencv_java247</span><span class="p">.</span><span class="n">dylib</span> <span class="n">native</span><span class="o">/</span><span class="n">macosx</span><span class="o">/</span><span class="n">x86_64</span><span class="o">/</span>
</pre>
<p>If you’re running OpenCV from a different OS/Architecture pair, here is a summary of the mapping you can choose from.</p>
<pre class="highlight literal-block">
<span></span><span class="n">OS</span>

<span class="n">Mac</span> <span class="n">OS</span> <span class="n">X</span> <span class="o">-&gt;</span> <span class="n">macosx</span>
<span class="n">Windows</span>  <span class="o">-&gt;</span> <span class="n">windows</span>
<span class="n">Linux</span>    <span class="o">-&gt;</span> <span class="n">linux</span>
<span class="n">SunOS</span>    <span class="o">-&gt;</span> <span class="n">solaris</span>

<span class="n">Architectures</span>

<span class="n">amd64</span>    <span class="o">-&gt;</span> <span class="n">x86_64</span>
<span class="n">x86_64</span>   <span class="o">-&gt;</span> <span class="n">x86_64</span>
<span class="n">x86</span>      <span class="o">-&gt;</span> <span class="n">x86</span>
<span class="n">i386</span>     <span class="o">-&gt;</span> <span class="n">x86</span>
<span class="n">arm</span>      <span class="o">-&gt;</span> <span class="n">arm</span>
<span class="n">sparc</span>    <span class="o">-&gt;</span> <span class="n">sparc</span>
</pre>
<p class="rubric">Package the native lib as a jar</p>
<p>Next you need to package the native lib in a jar file by using the jar command to create a new jar file from a directory.</p>
<pre class="highlight literal-block">
<span></span><span class="n">jar</span> <span class="o">-</span><span class="n">cMf</span> <span class="n">opencv</span><span class="o">-</span><span class="n">native</span><span class="o">-</span><span class="mf">247.</span><span class="n">jar</span> <span class="n">native</span>
</pre>
<p>Note that ehe M option instructs the jar command to not create a MANIFEST file for the artifact.</p>
<p>Your directories layout should look like the following:</p>
<pre class="highlight literal-block">
<span></span><span class="n">tree</span>
<span class="p">.</span>
<span class="o">|</span><span class="n">__</span> <span class="n">native</span>
<span class="o">|</span>   <span class="o">|</span><span class="n">__</span> <span class="n">macosx</span>
<span class="o">|</span>       <span class="o">|</span><span class="n">__</span> <span class="n">x86_64</span>
<span class="o">|</span>           <span class="o">|</span><span class="n">__</span> <span class="n">libopencv_java247</span><span class="p">.</span><span class="n">dylib</span>
<span class="o">|</span>
<span class="o">|</span><span class="n">__</span> <span class="n">opencv</span><span class="o">-</span><span class="mf">247.</span><span class="n">jar</span>
<span class="o">|</span><span class="n">__</span> <span class="n">opencv</span><span class="o">-</span><span class="n">native</span><span class="o">-</span><span class="mf">247.</span><span class="n">jar</span>

<span class="mi">3</span> <span class="n">directories</span><span class="p">,</span> <span class="mi">3</span> <span class="n">files</span>
</pre>
<p class="rubric">Locally install the jars</p>
<p>We are now ready to add the two jars as artifacts to the local maven repository with the help of the lein-localrepo plugin.</p>
<pre class="highlight literal-block">
<span></span><span class="n">lein</span> <span class="n">localrepo</span> <span class="n">install</span> <span class="n">opencv</span><span class="o">-</span><span class="mf">247.</span><span class="n">jar</span> <span class="n">opencv</span><span class="o">/</span><span class="n">opencv</span> <span class="mf">2.4.7</span>
</pre>
<p>Here the localrepo install task creates the 2.4.7. release of the opencv/opencv maven artifact from the opencv-247.jar lib and then installs it into the local maven repository. The opencv/opencv artifact will then be available to any maven compliant project (Leiningen is internally based on maven).</p>
<p>Do the same thing with the native lib previously wrapped in a new jar file.</p>
<pre class="highlight literal-block">
<span></span><span class="n">lein</span> <span class="n">localrepo</span> <span class="n">install</span> <span class="n">opencv</span><span class="o">-</span><span class="n">native</span><span class="o">-</span><span class="mf">247.</span><span class="n">jar</span> <span class="n">opencv</span><span class="o">/</span><span class="n">opencv</span><span class="o">-</span><span class="n">native</span> <span class="mf">2.4.7</span>
</pre>
<p>Note that the groupId, opencv, of the two artifacts is the same. We are now ready to create a new CLJ project to start interacting with OpenCV.</p>
<p class="rubric">Create a project</p>
<p>Create a new CLJ project by using the lein new task from the terminal.</p>
<pre class="highlight literal-block">
<span></span><span class="cp"># cd in the directory where you work with your development projects (e.g. ~/devel)</span>
<span class="n">lein</span> <span class="k">new</span> <span class="n">simple</span><span class="o">-</span><span class="n">sample</span>
<span class="n">Generating</span> <span class="n">a</span> <span class="n">project</span> <span class="n">called</span> <span class="n">simple</span><span class="o">-</span><span class="n">sample</span> <span class="n">based</span> <span class="n">on</span> <span class="n">the</span> <span class="sc">&#39;default&#39;</span> <span class="k">template</span><span class="p">.</span>
<span class="n">To</span> <span class="n">see</span> <span class="n">other</span> <span class="n">templates</span> <span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">lein</span> <span class="n">plugin</span><span class="p">,</span> <span class="n">etc</span><span class="p">),</span> <span class="k">try</span> <span class="err">`</span><span class="n">lein</span> <span class="n">help</span> <span class="k">new</span><span class="err">`</span><span class="p">.</span>
</pre>
<p>The above task creates the following simple-sample directories layout:</p>
<pre class="highlight literal-block">
<span></span><span class="n">tree</span> <span class="n">simple</span><span class="o">-</span><span class="n">sample</span><span class="o">/</span>
<span class="n">simple</span><span class="o">-</span><span class="n">sample</span><span class="o">/</span>
<span class="o">|</span><span class="n">__</span> <span class="n">LICENSE</span>
<span class="o">|</span><span class="n">__</span> <span class="n">README</span><span class="p">.</span><span class="n">md</span>
<span class="o">|</span><span class="n">__</span> <span class="n">doc</span>
<span class="o">|</span>   <span class="o">|</span><span class="n">__</span> <span class="n">intro</span><span class="p">.</span><span class="n">md</span>
<span class="o">|</span>
<span class="o">|</span><span class="n">__</span> <span class="n">project</span><span class="p">.</span><span class="n">clj</span>
<span class="o">|</span><span class="n">__</span> <span class="n">resources</span>
<span class="o">|</span><span class="n">__</span> <span class="n">src</span>
<span class="o">|</span>   <span class="o">|</span><span class="n">__</span> <span class="n">simple_sample</span>
<span class="o">|</span>       <span class="o">|</span><span class="n">__</span> <span class="n">core</span><span class="p">.</span><span class="n">clj</span>
<span class="o">|</span><span class="n">__</span> <span class="n">test</span>
    <span class="o">|</span><span class="n">__</span> <span class="n">simple_sample</span>
        <span class="o">|</span><span class="n">__</span> <span class="n">core_test</span><span class="p">.</span><span class="n">clj</span>

<span class="mi">6</span> <span class="n">directories</span><span class="p">,</span> <span class="mi">6</span> <span class="n">files</span>
</pre>
<p>We need to add the two opencv artifacts as dependencies of the newly created project. Open the project.clj and modify its dependencies section as follows:</p>
<pre class="highlight literal-block">
<span></span><span class="p">(</span><span class="n">defproject</span> <span class="n">simple</span><span class="o">-</span><span class="n">sample</span> <span class="s">&quot;0.1.0-SNAPSHOT&quot;</span>
<span class="n">description</span> <span class="s">&quot;FIXME: write description&quot;</span>
<span class="n">url</span> <span class="s">&quot;http://example.com/FIXME&quot;</span>
<span class="n">license</span> <span class="p">{</span><span class="o">:</span><span class="n">name</span> <span class="s">&quot;Eclipse Public License&quot;</span>
<span class="n">url</span> <span class="s">&quot;http://www.eclipse.org/legal/epl-v10.html&quot;</span><span class="p">}</span>
<span class="n">dependencies</span> <span class="p">[[</span><span class="n">org</span><span class="p">.</span><span class="n">clojure</span><span class="o">/</span><span class="n">clojure</span> <span class="s">&quot;1.5.1&quot;</span><span class="p">]</span>
                 <span class="p">[</span><span class="n">opencv</span><span class="o">/</span><span class="n">opencv</span> <span class="s">&quot;2.4.7&quot;</span><span class="p">]</span> <span class="p">;</span> <span class="n">added</span> <span class="n">line</span>
                 <span class="p">[</span><span class="n">opencv</span><span class="o">/</span><span class="n">opencv</span><span class="o">-</span><span class="n">native</span> <span class="s">&quot;2.4.7&quot;</span><span class="p">]])</span> <span class="p">;</span><span class="n">added</span> <span class="n">line</span>
</pre>
<p>Note that The Clojure Programming Language is a jar artifact too. This is why Clojure is called an hosted language.</p>
<p>To verify that everything went right issue the lein deps task. The very first time you run a lein task it will take sometime to download all the required dependencies before executing the task itself.</p>
<pre class="highlight literal-block">
<span></span><span class="n">cd</span> <span class="n">simple</span><span class="o">-</span><span class="n">sample</span>
<span class="n">lein</span> <span class="n">deps</span>
<span class="p">...</span>
</pre>
<p>The deps task reads and merges from the project.clj and the/.lein/profiles.clj files all the dependencies of the simple-sample project and verifies if they have already been cached in the local maven repository. If the task returns without messages about not being able to retrieve the two new artifacts your installation is correct, otherwise go back and double check that you did everything right.</p>
<p class="rubric">REPLing with OpenCV</p>
<p>Now cd in the simple-sample directory and issue the following lein task:</p>
<pre class="highlight literal-block">
<span></span><span class="n">cd</span> <span class="n">simple</span><span class="o">-</span><span class="n">sample</span>
<span class="n">lein</span> <span class="n">repl</span>
<span class="p">...</span>
<span class="p">...</span>
<span class="n">nREPL</span> <span class="n">server</span> <span class="n">started</span> <span class="n">on</span> <span class="n">port</span> <span class="mi">50907</span> <span class="n">on</span> <span class="n">host</span> <span class="mf">127.0.0.1</span>
<span class="n">REPL</span><span class="o">-</span><span class="n">y</span> <span class="mf">0.3.0</span>
<span class="n">Clojure</span> <span class="mf">1.5.1</span>
    <span class="nl">Docs</span><span class="p">:</span> <span class="p">(</span><span class="n">doc</span> <span class="n">function</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">here</span><span class="p">)</span>
          <span class="p">(</span><span class="n">find</span><span class="o">-</span><span class="n">doc</span> <span class="s">&quot;part-of-name-here&quot;</span><span class="p">)</span>
  <span class="nl">Source</span><span class="p">:</span> <span class="p">(</span><span class="n">source</span> <span class="n">function</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">here</span><span class="p">)</span>
 <span class="nl">Javadoc</span><span class="p">:</span> <span class="p">(</span><span class="n">javadoc</span> <span class="n">java</span><span class="o">-</span><span class="n">object</span><span class="o">-</span><span class="n">or</span><span class="o">-</span><span class="k">class</span><span class="o">-</span><span class="n">here</span><span class="p">)</span>
    <span class="nl">Exit</span><span class="p">:</span> <span class="n">Control</span><span class="o">+</span><span class="n">D</span> <span class="n">or</span> <span class="p">(</span><span class="n">exit</span><span class="p">)</span> <span class="n">or</span> <span class="p">(</span><span class="n">quit</span><span class="p">)</span>
 <span class="nl">Results</span><span class="p">:</span> <span class="n">Stored</span> <span class="n">in</span> <span class="n">vars</span> <span class="o">*</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="n">an</span> <span class="n">exception</span> <span class="n">in</span> <span class="o">*</span><span class="n">e</span>

<span class="n">user</span><span class="o">=&gt;</span>
</pre>
<p>You can immediately interact with the REPL by issuing any CLJ expression to be evaluated.</p>
<pre class="highlight literal-block">
<span></span><span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="o">+</span> <span class="mi">41</span> <span class="mi">1</span><span class="p">)</span>
<span class="mi">42</span>
<span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">println</span> <span class="s">&quot;Hello, OpenCV!&quot;</span><span class="p">)</span>
<span class="n">Hello</span><span class="p">,</span> <span class="n">OpenCV</span><span class="o">!</span>
<span class="n">nil</span>
<span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">defn</span> <span class="n">foo</span> <span class="p">[]</span> <span class="p">(</span><span class="n">str</span> <span class="s">&quot;bar&quot;</span><span class="p">))</span>
<span class="cp">#&#39;user/foo</span>
<span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">foo</span><span class="p">)</span>
<span class="s">&quot;bar&quot;</span>
</pre>
<p>When ran from the home directory of a lein based project, even if the lein repl task automatically loads all the project dependencies, you still need to load the opencv native library to be able to interact with the OpenCV.</p>
<pre class="highlight literal-block">
<span></span><span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">clojure</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="n">RT</span><span class="o">/</span><span class="n">loadLibrary</span> <span class="n">org</span><span class="p">.</span><span class="n">opencv</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">Core</span><span class="o">/</span><span class="n">NATIVE_LIBRARY_NAME</span><span class="p">)</span>
<span class="n">nil</span>
</pre>
<p>Then you can start interacting with OpenCV by just referencing the fully qualified names of its classes.</p>
<p><a class="reference external" href="http://docs.opencv.org/java/">Here</a> you can find the full OpenCV Java API.</p>
<pre class="highlight literal-block">
<span></span><span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">org</span><span class="p">.</span><span class="n">opencv</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">Point</span><span class="p">.</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)</span>
<span class="cp">#&lt;Point {0.0, 0.0}&gt;</span>
</pre>
<p>Here we created a two dimensions opencv Point instance. Even if all the java packages included within the java interface to OpenCV are immediately available from the CLJ REPL, it’s very annoying to prefix the Point. instance constructors with the fully qualified package name.</p>
<p>Fortunately CLJ offer a very easy way to overcome this annoyance by directly importing the Point class.</p>
<pre class="highlight literal-block">
<span></span><span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">import</span> <span class="sc">&#39;org.opencv.core.Point)</span>
<span class="n">org</span><span class="p">.</span><span class="n">opencv</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">Point</span>
<span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">def</span> <span class="n">p1</span> <span class="p">(</span><span class="n">Point</span><span class="p">.</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">))</span>
<span class="cp">#&#39;user/p1</span>
<span class="n">user</span><span class="o">=&gt;</span> <span class="n">p1</span>
<span class="cp">#&lt;Point {0.0, 0.0}&gt;</span>
<span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">def</span> <span class="n">p2</span> <span class="p">(</span><span class="n">Point</span><span class="p">.</span> <span class="mi">100</span> <span class="mi">100</span><span class="p">))</span>
<span class="cp">#&#39;user/p2</span>
</pre>
<p>We can even inspect the class of an instance and verify if the value of a symbol is an instance of a Point java class.</p>
<pre class="highlight literal-block">
<span></span><span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="k">class</span> <span class="n">p1</span><span class="p">)</span>
<span class="n">org</span><span class="p">.</span><span class="n">opencv</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">Point</span>
<span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">instance</span><span class="o">?</span> <span class="n">org</span><span class="p">.</span><span class="n">opencv</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">Point</span> <span class="n">p1</span><span class="p">)</span>
<span class="nb">true</span>
</pre>
<p>If we now want to use the opencv Rect class to create a rectangle, we again have to fully qualify its constructor even if it leaves in the same org.opencv.core package of the Point class.</p>
<pre class="highlight literal-block">
<span></span><span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">org</span><span class="p">.</span><span class="n">opencv</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">Rect</span><span class="p">.</span> <span class="n">p1</span> <span class="n">p2</span><span class="p">)</span>
<span class="cp">#&lt;Rect {0, 0, 100x100}&gt;</span>
</pre>
<p>Again, the CLJ importing facilities is very handy and let you to map more symbols in one shot.</p>
<pre class="highlight literal-block">
<span></span><span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">import</span> <span class="sc">&#39;[org.opencv.core Point Rect Size])</span>
<span class="n">org</span><span class="p">.</span><span class="n">opencv</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">Size</span>
<span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">def</span> <span class="n">r1</span> <span class="p">(</span><span class="n">Rect</span><span class="p">.</span> <span class="n">p1</span> <span class="n">p2</span><span class="p">))</span>
<span class="cp">#&#39;user/r1</span>
<span class="n">user</span><span class="o">=&gt;</span> <span class="n">r1</span>
<span class="cp">#&lt;Rect {0, 0, 100x100}&gt;</span>
<span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="k">class</span> <span class="n">r1</span><span class="p">)</span>
<span class="n">org</span><span class="p">.</span><span class="n">opencv</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">Rect</span>
<span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">instance</span><span class="o">?</span> <span class="n">org</span><span class="p">.</span><span class="n">opencv</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">Rect</span> <span class="n">r1</span><span class="p">)</span>
<span class="nb">true</span>
<span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">Size</span><span class="p">.</span> <span class="mi">100</span> <span class="mi">100</span><span class="p">)</span>
<span class="cp">#&lt;Size 100x100&gt;</span>
<span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">def</span> <span class="n">sq</span><span class="o">-</span><span class="mi">100</span> <span class="p">(</span><span class="n">Size</span><span class="p">.</span> <span class="mi">100</span> <span class="mi">100</span><span class="p">))</span>
<span class="cp">#&#39;user/sq-100</span>
<span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="k">class</span> <span class="n">sq</span><span class="o">-</span><span class="mi">100</span><span class="p">)</span>
<span class="n">org</span><span class="p">.</span><span class="n">opencv</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">Size</span>
<span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">instance</span><span class="o">?</span> <span class="n">org</span><span class="p">.</span><span class="n">opencv</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">Size</span> <span class="n">sq</span><span class="o">-</span><span class="mi">100</span><span class="p">)</span>
<span class="nb">true</span>
</pre>
<p>Obviously you can call methods on instances as well.</p>
<pre class="highlight literal-block">
<span></span><span class="n">user</span><span class="o">=&gt;</span> <span class="p">(.</span><span class="n">area</span> <span class="n">r1</span><span class="p">)</span>
<span class="mf">10000.0</span>
<span class="n">user</span><span class="o">=&gt;</span> <span class="p">(.</span><span class="n">area</span> <span class="n">sq</span><span class="o">-</span><span class="mi">100</span><span class="p">)</span>
<span class="mf">10000.0</span>
</pre>
<p>Or modify the value of a member field.</p>
<pre class="highlight literal-block">
<span></span><span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">set</span><span class="o">!</span> <span class="p">(.</span><span class="n">x</span> <span class="n">p1</span><span class="p">)</span> <span class="mi">10</span><span class="p">)</span>
<span class="mi">10</span>
<span class="n">user</span><span class="o">=&gt;</span> <span class="n">p1</span>
<span class="cp">#&lt;Point {10.0, 0.0}&gt;</span>
<span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">set</span><span class="o">!</span> <span class="p">(.</span><span class="n">width</span> <span class="n">sq</span><span class="o">-</span><span class="mi">100</span><span class="p">)</span> <span class="mi">10</span><span class="p">)</span>
<span class="mi">10</span>
<span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">set</span><span class="o">!</span> <span class="p">(.</span><span class="n">height</span> <span class="n">sq</span><span class="o">-</span><span class="mi">100</span><span class="p">)</span> <span class="mi">10</span><span class="p">)</span>
<span class="mi">10</span>
<span class="n">user</span><span class="o">=&gt;</span> <span class="p">(.</span><span class="n">area</span> <span class="n">sq</span><span class="o">-</span><span class="mi">100</span><span class="p">)</span>
<span class="mf">100.0</span>
</pre>
<p>If you find yourself not remembering a OpenCV class behavior, the REPL gives you the opportunity to easily search the corresponding javadoc documention:</p>
<pre class="highlight literal-block">
<span></span><span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">javadoc</span> <span class="n">Rect</span><span class="p">)</span>
<span class="s">&quot;http://www.google.com/search?btnI=I%27m%20Feeling%20Lucky&amp;q=allinurl:org/opencv/core/Rect.html&quot;</span>
</pre>
<p class="rubric">Mimic the OpenCV Java Tutorial Sample in the REPL</p>
<p>Let’s now try to port to Clojure the <a class="reference external" href="http://docs.opencv.org/2.4.4-beta/doc/tutorials/introduction/desktop_java/java_dev_intro.html">opencv java tutorial sample</a>. Instead of writing it in a source file we’re going to evaluate it at the REPL.</p>
<p>Following is the original Java source code of the cited sample.</p>
<pre class="highlight literal-block">
<span></span><span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">opencv</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">Mat</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">opencv</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">CvType</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">opencv</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">Scalar</span><span class="p">;</span>

<span class="k">class</span> <span class="n">SimpleSample</span> <span class="p">{</span>

  <span class="k">static</span><span class="p">{</span> <span class="n">System</span><span class="p">.</span><span class="n">loadLibrary</span><span class="p">(</span><span class="s">&quot;opencv_java244&quot;</span><span class="p">);</span> <span class="p">}</span>

  <span class="k">public</span> <span class="k">static</span> <span class="kt">void</span> <span class="n">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Mat</span> <span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Mat</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <a class="reference internal" href="struct_CvType.html#doxid-d5-dea-struct-cv-type"><span class="std std-ref">CvType</span></a><span></span><span class="p">.</span><span class="n">CV_8UC1</span><span class="p">,</span> <span class="k">new</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
    <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;OpenCV Mat: &quot;</span> <span class="o">+</span> <span class="n">m</span><span class="p">);</span>
    <span class="n">Mat</span> <span class="n">mr1</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">row</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">mr1</span><span class="p">.</span><span class="n">setTo</span><span class="p">(</span><span class="k">new</span> <a class="reference internal" href="namespace_cv.html#doxid-dc-d84-group-core-basic-1ga599fe92e910c027be274233eccad7beb"><span class="std std-ref">Scalar</span></a><span></span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
    <span class="n">Mat</span> <span class="n">mc5</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
    <span class="n">mc5</span><span class="p">.</span><span class="n">setTo</span><span class="p">(</span><span class="k">new</span> <a class="reference internal" href="namespace_cv.html#doxid-dc-d84-group-core-basic-1ga599fe92e910c027be274233eccad7beb"><span class="std std-ref">Scalar</span></a><span></span><span class="p">(</span><span class="mi">5</span><span class="p">));</span>
    <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;OpenCV Mat data:</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">m</span><span class="p">.</span><span class="n">dump</span><span class="p">());</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre>
<p class="rubric">Add injections to the project</p>
<p>Before start coding, we’d like to eliminate the boring need of interactively loading the native opencv lib any time we start a new REPL to interact with it.</p>
<p>First, stop the REPL by evaluating the (exit) expression at the REPL prompt.</p>
<pre class="highlight literal-block">
<span></span><span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">exit</span><span class="p">)</span>
<span class="n">Bye</span> <span class="k">for</span> <span class="n">now</span><span class="o">!</span>
</pre>
<p>Then open your project.clj file and edit it as follows:</p>
<pre class="highlight literal-block">
<span></span><span class="p">(</span><span class="n">defproject</span> <span class="n">simple</span><span class="o">-</span><span class="n">sample</span> <span class="s">&quot;0.1.0-SNAPSHOT&quot;</span>
  <span class="p">...</span>
<span class="n">injections</span> <span class="p">[(</span><span class="n">clojure</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="n">RT</span><span class="o">/</span><span class="n">loadLibrary</span> <span class="n">org</span><span class="p">.</span><span class="n">opencv</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">Core</span><span class="o">/</span><span class="n">NATIVE_LIBRARY_NAME</span><span class="p">)])</span>
</pre>
<p>Here we’re saying to load the opencv native lib anytime we run the REPL in such a way that we have not anymore to remember to manually do it.</p>
<p>Rerun the lein repl task</p>
<pre class="highlight literal-block">
<span></span><span class="n">lein</span> <span class="n">repl</span>
<span class="n">nREPL</span> <span class="n">server</span> <span class="n">started</span> <span class="n">on</span> <span class="n">port</span> <span class="mi">51645</span> <span class="n">on</span> <span class="n">host</span> <span class="mf">127.0.0.1</span>
<span class="n">REPL</span><span class="o">-</span><span class="n">y</span> <span class="mf">0.3.0</span>
<span class="n">Clojure</span> <span class="mf">1.5.1</span>
    <span class="nl">Docs</span><span class="p">:</span> <span class="p">(</span><span class="n">doc</span> <span class="n">function</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">here</span><span class="p">)</span>
          <span class="p">(</span><span class="n">find</span><span class="o">-</span><span class="n">doc</span> <span class="s">&quot;part-of-name-here&quot;</span><span class="p">)</span>
  <span class="nl">Source</span><span class="p">:</span> <span class="p">(</span><span class="n">source</span> <span class="n">function</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">here</span><span class="p">)</span>
 <span class="nl">Javadoc</span><span class="p">:</span> <span class="p">(</span><span class="n">javadoc</span> <span class="n">java</span><span class="o">-</span><span class="n">object</span><span class="o">-</span><span class="n">or</span><span class="o">-</span><span class="k">class</span><span class="o">-</span><span class="n">here</span><span class="p">)</span>
    <span class="nl">Exit</span><span class="p">:</span> <span class="n">Control</span><span class="o">+</span><span class="n">D</span> <span class="n">or</span> <span class="p">(</span><span class="n">exit</span><span class="p">)</span> <span class="n">or</span> <span class="p">(</span><span class="n">quit</span><span class="p">)</span>
 <span class="nl">Results</span><span class="p">:</span> <span class="n">Stored</span> <span class="n">in</span> <span class="n">vars</span> <span class="o">*</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="n">an</span> <span class="n">exception</span> <span class="n">in</span> <span class="o">*</span><span class="n">e</span>

<span class="n">user</span><span class="o">=&gt;</span>
</pre>
<p>Import the interested OpenCV java interfaces.</p>
<pre class="highlight literal-block">
<span></span><span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">import</span> <span class="sc">&#39;[org.opencv.core Mat CvType Scalar])</span>
<span class="n">org</span><span class="p">.</span><span class="n">opencv</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">Scalar</span>
</pre>
<p>We’re going to mimic almost verbatim the original OpenCV java tutorial to:</p>
<ul class="simple">
<li>create a 5x10 matrix with all its elements intialized to 0</li>
<li>change the value of every element of the second row to 1</li>
<li>change the value of every element of the 6th column to 5</li>
<li>print the content of the obtained matrix</li>
</ul>
<pre class="highlight literal-block">
<span></span><span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">def</span> <span class="n">m</span> <span class="p">(</span><span class="n">Mat</span><span class="p">.</span> <span class="mi">5</span> <span class="mi">10</span> <span class="n">CvType</span><span class="o">/</span><span class="n">CV_8UC1</span> <span class="p">(</span><span class="n">Scalar</span><span class="p">.</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)))</span>
<span class="cp">#&#39;user/m</span>
<span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">def</span> <span class="n">mr1</span> <span class="p">(.</span><span class="n">row</span> <span class="n">m</span> <span class="mi">1</span><span class="p">))</span>
<span class="cp">#&#39;user/mr1</span>
<span class="n">user</span><span class="o">=&gt;</span> <span class="p">(.</span><span class="n">setTo</span> <span class="n">mr1</span> <span class="p">(</span><span class="n">Scalar</span><span class="p">.</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">))</span>
<span class="cp">#&lt;Mat Mat [ 1*10*CV_8UC1, isCont=true, isSubmat=true, nativeObj=0x7fc9dac49880, dataAddr=0x7fc9d9c98d5a ]&gt;</span>
<span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">def</span> <span class="n">mc5</span> <span class="p">(.</span><span class="n">col</span> <span class="n">m</span> <span class="mi">5</span><span class="p">))</span>
<span class="cp">#&#39;user/mc5</span>
<span class="n">user</span><span class="o">=&gt;</span> <span class="p">(.</span><span class="n">setTo</span> <span class="n">mc5</span> <span class="p">(</span><span class="n">Scalar</span><span class="p">.</span> <span class="mi">5</span> <span class="mi">0</span><span class="p">))</span>
<span class="cp">#&lt;Mat Mat [ 5*1*CV_8UC1, isCont=false, isSubmat=true, nativeObj=0x7fc9d9c995a0, dataAddr=0x7fc9d9c98d55 ]&gt;</span>
<span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">println</span> <span class="p">(.</span><span class="n">dump</span> <span class="n">m</span><span class="p">))</span>
<span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">;</span>
  <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">;</span>
  <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">;</span>
  <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">;</span>
  <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">nil</span>
</pre>
<p>If you are accustomed to a functional language all those abused and mutating nouns are going to irritate your preference for verbs. Even if the CLJ interop syntax is very handy and complete, there is still an impedance mismatch between any OOP language and any FP language (bein Scala a mixed paradigms programming language).</p>
<p>To exit the REPL type (exit), ctr-D or (quit) at the REPL prompt.</p>
<pre class="highlight literal-block">
<span></span><span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">exit</span><span class="p">)</span>
<span class="n">Bye</span> <span class="k">for</span> <span class="n">now</span><span class="o">!</span>
</pre>
<p class="rubric">Interactively load and blur an image</p>
<p>In the next sample you will learn how to interactively load and blur and image from the REPL by using the following OpenCV methods:</p>
<ul class="simple">
<li>the imread static method from the Highgui class to read an image from a file</li>
<li>the imwrite static method from the Highgui class to write an image to a file</li>
<li>the GaussianBlur static method from the Imgproc class to apply to blur the original image</li>
</ul>
<p>We’re also going to use the Mat class which is returned from the imread method and accpeted as the main argument to both the GaussianBlur and the imwrite methods.</p>
<p class="rubric">Add an image to the project</p>
<p>First we want to add an image file to a newly create directory for storing static resources of the project.</p>
<img alt="_images/lena.png" src="_images/lena.png" />
<pre class="highlight literal-block">
<span></span><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="n">resources</span><span class="o">/</span><span class="n">images</span>
<span class="n">cp</span> <span class="o">~/</span><span class="n">opt</span><span class="o">/</span><span class="n">opencv</span><span class="o">/</span><span class="n">doc</span><span class="o">/</span><span class="n">tutorials</span><span class="o">/</span><span class="n">introduction</span><span class="o">/</span><span class="n">desktop_java</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">lena</span><span class="p">.</span><span class="n">png</span> <span class="n">resource</span><span class="o">/</span><span class="n">images</span><span class="o">/</span>
</pre>
<p class="rubric">Read the image</p>
<p>Now launch the REPL as usual and start by importing all the OpenCV classes we’re going to use:</p>
<pre class="highlight literal-block">
<span></span><span class="n">lein</span> <span class="n">repl</span>
<span class="n">nREPL</span> <span class="n">server</span> <span class="n">started</span> <span class="n">on</span> <span class="n">port</span> <span class="mi">50624</span> <span class="n">on</span> <span class="n">host</span> <span class="mf">127.0.0.1</span>
<span class="n">REPL</span><span class="o">-</span><span class="n">y</span> <span class="mf">0.3.0</span>
<span class="n">Clojure</span> <span class="mf">1.5.1</span>
    <span class="nl">Docs</span><span class="p">:</span> <span class="p">(</span><span class="n">doc</span> <span class="n">function</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">here</span><span class="p">)</span>
          <span class="p">(</span><span class="n">find</span><span class="o">-</span><span class="n">doc</span> <span class="s">&quot;part-of-name-here&quot;</span><span class="p">)</span>
  <span class="nl">Source</span><span class="p">:</span> <span class="p">(</span><span class="n">source</span> <span class="n">function</span><span class="o">-</span><span class="n">name</span><span class="o">-</span><span class="n">here</span><span class="p">)</span>
 <span class="nl">Javadoc</span><span class="p">:</span> <span class="p">(</span><span class="n">javadoc</span> <span class="n">java</span><span class="o">-</span><span class="n">object</span><span class="o">-</span><span class="n">or</span><span class="o">-</span><span class="k">class</span><span class="o">-</span><span class="n">here</span><span class="p">)</span>
    <span class="nl">Exit</span><span class="p">:</span> <span class="n">Control</span><span class="o">+</span><span class="n">D</span> <span class="n">or</span> <span class="p">(</span><span class="n">exit</span><span class="p">)</span> <span class="n">or</span> <span class="p">(</span><span class="n">quit</span><span class="p">)</span>
 <span class="nl">Results</span><span class="p">:</span> <span class="n">Stored</span> <span class="n">in</span> <span class="n">vars</span> <span class="o">*</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="n">an</span> <span class="n">exception</span> <span class="n">in</span> <span class="o">*</span><span class="n">e</span>

<span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">import</span> <span class="sc">&#39;[org.opencv.core Mat Size CvType]</span>
               <span class="sc">&#39;[org.opencv.imgcodecs Imgcodecs]</span>
               <span class="sc">&#39;[org.opencv.imgproc Imgproc])</span>
<span class="n">org</span><span class="p">.</span><span class="n">opencv</span><span class="p">.</span><span class="n">imgproc</span><span class="p">.</span><span class="n">Imgproc</span>
</pre>
<p>Now read the image from the resources/images/lena.png file.</p>
<pre class="highlight literal-block">
<span></span><span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">def</span> <span class="n">lena</span> <span class="p">(</span><span class="n">Highgui</span><span class="o">/</span><span class="n">imread</span> <span class="s">&quot;resources/images/lena.png&quot;</span><span class="p">))</span>
<span class="cp">#&#39;user/lena</span>
<span class="n">user</span><span class="o">=&gt;</span> <span class="n">lena</span>
<span class="cp">#&lt;Mat Mat [ 512*512*CV_8UC3, isCont=true, isSubmat=false, nativeObj=0x7f9ab3054c40, dataAddr=0x19fea9010 ]&gt;</span>
</pre>
<p>As you see, by simply evaluating the lena symbol we know that lena.png is a 512x512 matrix of CV_8UC3 elements type. Let’s create a new Mat instance of the same dimensions and elements type.</p>
<pre class="highlight literal-block">
<span></span><span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">def</span> <span class="n">blurred</span> <span class="p">(</span><span class="n">Mat</span><span class="p">.</span> <span class="mi">512</span> <span class="mi">512</span> <span class="n">CvType</span><span class="o">/</span><span class="n">CV_8UC3</span><span class="p">))</span>
<span class="cp">#&#39;user/blurred</span>
<span class="n">user</span><span class="o">=&gt;</span>
</pre>
<p>Now apply a GaussianBlur filter using lena as the source matrix and blurred as the destination matrix.</p>
<pre class="highlight literal-block">
<span></span><span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">Imgproc</span><span class="o">/</span><span class="n">GaussianBlur</span> <span class="n">lena</span> <span class="n">blurred</span> <span class="p">(</span><span class="n">Size</span><span class="p">.</span> <span class="mi">5</span> <span class="mi">5</span><span class="p">)</span> <span class="mi">3</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">nil</span>
</pre>
<p>As a last step just save the blurred matrix in a new image file.</p>
<pre class="highlight literal-block">
<span></span><span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">Highgui</span><span class="o">/</span><span class="n">imwrite</span> <span class="s">&quot;resources/images/blurred.png&quot;</span> <span class="n">blurred</span><span class="p">)</span>
<span class="nb">true</span>
<span class="n">user</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">exit</span><span class="p">)</span>
<span class="n">Bye</span> <span class="k">for</span> <span class="n">now</span><span class="o">!</span>
</pre>
<p>Following is the new blurred image of Lena.</p>
<img alt="_images/blurred.png" src="_images/blurred.png" />
<p class="rubric">Next Steps</p>
<p>This tutorial only introduces the very basic environment set up to be able to interact with OpenCV in a CLJ REPL.</p>
<p>I recommend any Clojure newbie to read the <a class="reference external" href="http://clojure.org/java_interop">Clojure Java Interop chapter</a> to get all you need to know to interoperate with any plain java lib that has not been wrapped in Clojure to make it usable in a more idiomatic and functional way within Clojure.</p>
<p>The OpenCV Java API does not wrap the highgui module functionalities depending on Qt (e.g. namedWindow and imshow. If you want to create windows and show images into them while interacting with OpenCV from the REPL, at the moment you’re left at your own. You could use Java Swing to fill the gap.</p>
<p class="rubric">License</p>
<p>Copyright © 2013 Giacomo (Mimmo) Cosenza aka Magomimmo</p>
<p>Distributed under the BSD 3-clause License, the same of OpenCV.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="page_tutorial_display_image.html" class="btn btn-neutral float-right" title="Load and Display an Image" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="page_tutorial_java_dev_intro.html" class="btn btn-neutral float-left" title="Introduction to Java Development" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 1999-2017, OpenCV Maintainers

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>