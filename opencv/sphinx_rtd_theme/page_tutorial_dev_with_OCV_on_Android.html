

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Android Development with OpenCV &mdash; OpenCV Documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="_static/target-highlight.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/doxyrest-pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/doxyrest-sphinx_rtd_theme.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Building OpenCV for Tegra with CUDA" href="page_tutorial_building_tegra_cuda.html" />
    <link rel="prev" title="Introduction to OpenCV" href="page_tutorial_table_of_content_introduction.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> OpenCV Documentation
          

          
          </a>

          
            
            
              <div class="version">
                3.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="group_features2d.html">2D Features Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_viz.html">3D Visualizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_calib3d.html">Camera Calibration and 3D Reconstruction</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_flann.html">Clustering and Search in Multi-Dimensional Spaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_photo.html">Computational Photography</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_core.html">Core functionality</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_highgui.html">High-level GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_imgcodecs.html">Image file reading and writing</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_imgproc.html">Image processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_stitching.html">Images stitching</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_ml.html">Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_objdetect.html">Object Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_shape.html">Shape Distance and Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_superres.html">Super Resolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_video.html">Video Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_videoio.html">Video I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_videostab.html">Video Stabilization</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="page_citelist.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_cuda_intro.html">CUDA Module Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_imgproc_color_conversions.html">Color conversions</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_deprecated.html">Deprecated List</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_ml_intro.html">Machine Learning Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="page_tutorial_root.html">OpenCV Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_features2d.html">2D Features framework (feature2d module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_calib3d.html">Camera calibration and 3D reconstruction (calib3d module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_photo.html">Computational photography (photo module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_gpu.html">GPU-Accelerated Computer Vision (cuda module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_highgui.html">High Level GUI and Media (highgui module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_imgcodecs.html">Image Input and Output (imgcodecs module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_imgproc.html">Image Processing (imgproc module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_stitching.html">Images stitching (stitching module)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="page_tutorial_table_of_content_introduction.html">Introduction to OpenCV</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Android Development with OpenCV</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_building_tegra_cuda.html">Building OpenCV for Tegra with CUDA</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_arm_crosscompile_with_cmake.html">Cross compilation for ARM based Linux systems</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_windows_visual_studio_Opencv.html">How to build applications with OpenCV inside the “Microsoft Visual Studio”</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_windows_visual_studio_image_watch.html">Image Watch: viewing in-memory images in the Visual Studio debugger</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_linux_install.html">Installation in Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_windows_install.html">Installation in Windows</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_ios_install.html">Installation in iOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_android_dev_intro.html">Introduction into Android Development</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_java_dev_intro.html">Introduction to Java Development</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_clojure_dev_intro.html">Introduction to OpenCV Development with Clojure</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_display_image.html">Load and Display an Image</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_load_save_image.html">Load, Modify, and Save an Image</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_O4A_SDK.html">OpenCV4Android SDK</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_transition_guide.html">Transition guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_android_ocl_intro.html">Use OpenCL in Android camera preview based CV application</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_java_eclipse.html">Using OpenCV Java with Eclipse</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_linux_eclipse.html">Using OpenCV with Eclipse (plugin CDT)</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_biicode.html">Using OpenCV with biicode dependency manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_linux_gcc_cmake.html">Using OpenCV with gcc and CMake</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_documentation.html">Writing documentation for OpenCV</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_ml.html">Machine Learning (ml module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_objdetect.html">Object Detection (objdetect module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_viz.html">OpenCV Viz</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_ios.html">OpenCV iOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_core.html">The Core Functionality (core module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_videoio.html">Video Input and Output (videoio module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_video.html">Video analysis (video module)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="page_index.html">OpenCV modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_tutorial_py_root.html">OpenCV-Python Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_todo.html">Todo List</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_videoio_overview.html">Video I/O with OpenCV Overview</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="example_contours2.cpp.html">contours2.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_convexhull.cpp.html">convexhull.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_cout_mat.cpp.html">cout_mat.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_demhist.cpp.html">demhist.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_distrans.cpp.html">distrans.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_edge.cpp.html">edge.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_ffilldemo.cpp.html">ffilldemo.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_filestorage.cpp.html">filestorage.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_fitellipse.cpp.html">fitellipse.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_grabcut.cpp.html">grabcut.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_houghcircles.cpp.html">houghcircles.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_houghlines.cpp.html">houghlines.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_kmeans.cpp.html">kmeans.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_laplace.cpp.html">laplace.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_lsd_lines.cpp.html">lsd_lines.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_minarea.cpp.html">minarea.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_morphology2.cpp.html">morphology2.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_pca.cpp.html">pca.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_polar_transforms.cpp.html">polar_transforms.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_segment_objects.cpp.html">segment_objects.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_watershed.cpp.html">watershed.cpp</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="global.html">Global Namespace</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">OpenCV Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="page_tutorial_root.html">OpenCV Tutorials</a> &raquo;</li>
        
          <li><a href="page_tutorial_table_of_content_introduction.html">Introduction to OpenCV</a> &raquo;</li>
        
      <li>Android Development with OpenCV</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="android-development-with-opencv">
<span id="doxid-d5-d34-tutorial-dev-with-o-c-v-on-android"></span><span id="index-0"></span><h1>Android Development with OpenCV</h1>
<p>This tutorial has been created to help you use OpenCV library within your Android project.</p>
<p>This guide was written with Windows 7 in mind, though it should work with any other OS supported by OpenCV4Android SDK.</p>
<p>This tutorial assumes you have the following installed and configured:</p>
<ul class="simple">
<li>JDK</li>
<li>Android SDK and NDK</li>
<li>Eclipse IDE</li>
<li>ADT and CDT plugins for Eclipse</li>
</ul>
<p>If you need help with anything of the above, you may refer to our <a class="reference internal" href="page_tutorial_android_dev_intro.html#doxid-d9-d3f-tutorial-android-dev-intro"><span class="std std-ref">Introduction into Android Development</span></a> guide.</p>
<p>This tutorial also assumes you have OpenCV4Android SDK already installed on your development machine and OpenCV Manager on your testing device correspondingly. If you need help with any of these, you may consult our <a class="reference internal" href="page_tutorial_O4A_SDK.html#doxid-d9-da6-tutorial-o4-a-s-d-k"><span class="std std-ref">OpenCV4Android SDK</span></a> tutorial.</p>
<p>If you encounter any error after thoroughly following these steps, feel free to contact us via <a class="reference external" href="https://groups.google.com/group/android-opencv/">OpenCV4Android</a> discussion group or OpenCV <a class="reference external" href="http://answers.opencv.org">Q&amp;A forum</a>. We’ll do our best to help you out.</p>
<p class="rubric">Using OpenCV Library Within Your Android Project</p>
<p>In this section we will explain how to make some existing project to use OpenCV. Starting with 2.4.2 release for Android, <em>OpenCV Manager</em> is used to provide apps with the best available version of OpenCV. You can get more information here: <code class="docutils literal notranslate"><span class="pre">Android</span> <span class="pre">OpenCV</span> <span class="pre">Manager</span></code> and in these <a class="reference external" href="https://docs.google.com/a/itseez.com/presentation/d/1EO_1kijgBg_BsjNp2ymk-aarg-0K279_1VZRcPplSuk/present#slide=id.p">slides</a>.</p>
<p class="rubric">Java</p>
<p class="rubric">Application Development with Async Initialization</p>
<p>Using async initialization is a <strong>recommended</strong> way for application development. It uses the OpenCV Manager to access OpenCV libraries externally installed in the target system.</p>
<ol class="arabic">
<li><p class="first">Add OpenCV library project to your workspace. Use menu File -&gt; Import -&gt; Existing project in your workspace.</p>
<p>Press Browse button and locate OpenCV4Android SDK (<code class="docutils literal notranslate"><span class="pre">OpenCV-2.4.9-android-sdk/sdk</span></code>).</p>
<img alt="_images/eclipse_opencv_dependency0.png" src="_images/eclipse_opencv_dependency0.png" />
</li>
<li><p class="first">In application project add a reference to the OpenCV Java SDK in Project -&gt; Properties -&gt; Android -&gt; Library -&gt; Add select OpenCV Library - 2.4.9.</p>
<img alt="_images/eclipse_opencv_dependency1.png" src="_images/eclipse_opencv_dependency1.png" />
</li>
</ol>
<p>In most cases OpenCV Manager may be installed automatically from Google Play. For the case, when Google Play is not available, i.e. emulator, developer board, etc, you can install it manually using adb tool. See <code class="docutils literal notranslate"><span class="pre">Manager</span> <span class="pre">Selection</span></code> for details.</p>
<p>There is a very base code snippet implementing the async initialization. It shows basic principles. See the “15-puzzle” OpenCV sample for details.</p>
<pre class="highlight literal-block">
<span></span><span class="k">public</span> <span class="k">class</span> <span class="n">Sample1Java</span> <span class="n">extends</span> <span class="n">Activity</span> <span class="n">implements</span> <span class="n">CvCameraViewListener</span> <span class="p">{</span>

    <span class="k">private</span> <span class="n">BaseLoaderCallback</span> <span class="n">mLoaderCallback</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BaseLoaderCallback</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span>
        <span class="err">@</span><span class="n">Override</span>
        <span class="k">public</span> <span class="kt">void</span> <span class="n">onManagerConnected</span><span class="p">(</span><span class="kt">int</span> <span class="n">status</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">case</span> <span class="n">LoaderCallbackInterface</span><span class="p">.</span><span class="nl">SUCCESS</span><span class="p">:</span>
                <span class="p">{</span>
                    <span class="n">Log</span><span class="p">.</span><span class="n">i</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s">&quot;OpenCV loaded successfully&quot;</span><span class="p">);</span>
                    <span class="n">mOpenCvCameraView</span><span class="p">.</span><span class="n">enableView</span><span class="p">();</span>
                <span class="p">}</span> <span class="k">break</span><span class="p">;</span>
                <span class="k">default</span><span class="o">:</span>
                <span class="p">{</span>
                    <span class="n">super</span><span class="p">.</span><span class="n">onManagerConnected</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="err">@</span><span class="n">Override</span>
    <span class="k">public</span> <span class="kt">void</span> <span class="n">onResume</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">super</span><span class="p">.</span><span class="n">onResume</span><span class="p">();</span>
        <span class="n">OpenCVLoader</span><span class="p">.</span><span class="n">initAsync</span><span class="p">(</span><span class="n">OpenCVLoader</span><span class="p">.</span><span class="n">OPENCV_VERSION_2_4_6</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="n">mLoaderCallback</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="p">...</span>
<span class="p">}</span>
</pre>
<p>It this case application works with OpenCV Manager in asynchronous fashion. OnManagerConnected callback will be called in UI thread, when initialization finishes. Please note, that it is not allowed to use OpenCV calls or load OpenCV-dependent native libs before invoking this callback. Load your own native libraries that depend on OpenCV after the successful OpenCV initialization. Default BaseLoaderCallback implementation treat application context as Activity and calls <a class="reference internal" href="namespace_cv_ocl.html#doxid-dc-d83-group-core-opencl-1gabfca32247f267c662b3bff6587d14b40"><span class="std std-ref">Activity.finish()</span></a> method to exit in case of initialization failure. To override this behavior you need to override <a class="reference internal" href="namespace_cv_ocl.html#doxid-dc-d83-group-core-opencl-1gabfca32247f267c662b3bff6587d14b40"><span class="std std-ref">finish()</span></a> method of BaseLoaderCallback class and implement your own finalization method.</p>
<p class="rubric">Application Development with Static Initialization</p>
<p>According to this approach all OpenCV binaries are included into your application package. It is designed mostly for development purposes. This approach is deprecated for the production code, release package is recommended to communicate with OpenCV Manager via the async initialization described above.</p>
<ol class="arabic">
<li><p class="first">Add the OpenCV library project to your workspace the same way as for the async initialization above. Use menu File -&gt; Import -&gt; Existing project in your workspace, press Browse button and select OpenCV SDK path (<code class="docutils literal notranslate"><span class="pre">OpenCV-2.4.9-android-sdk/sdk</span></code>).</p>
<img alt="_images/eclipse_opencv_dependency0.png" src="_images/eclipse_opencv_dependency0.png" />
</li>
<li><p class="first">In the application project add a reference to the OpenCV4Android SDK in Project -&gt; Properties -&gt; Android -&gt; Library -&gt; Add select OpenCV Library - 2.4.9;</p>
<img alt="_images/eclipse_opencv_dependency1.png" src="_images/eclipse_opencv_dependency1.png" />
</li>
<li><p class="first">If your application project <strong>doesn’t have a JNI part</strong>, just copy the corresponding OpenCV native libs from <code class="docutils literal notranslate"><span class="pre">&lt;OpenCV-2.4.9-android-sdk&gt;/sdk/native/libs/&lt;target_arch&gt;</span></code> to your project directory to folder <code class="docutils literal notranslate"><span class="pre">libs/&lt;target_arch&gt;</span></code>.</p>
<p>In case of the application project <strong>with a JNI part</strong>, instead of manual libraries copying you need to modify your Android.mk file: add the following two code lines after the “include $(CLEAR_VARS)” and before “include path_to_OpenCV-2.4.9-android-sdk/sdk/native/jni/OpenCV.mk”</p>
<pre class="highlight literal-block">
<span></span><span class="nl">OPENCV_CAMERA_MODULES</span><span class="p">:</span><span class="o">=</span><span class="n">on</span>
<span class="nl">OPENCV_INSTALL_MODULES</span><span class="p">:</span><span class="o">=</span><span class="n">on</span>
</pre>
<p>The result should look like the following:</p>
<pre class="highlight literal-block">
<span></span><span class="n">include</span> <span class="err">$</span><span class="p">(</span><span class="n">CLEAR_VARS</span><span class="p">)</span>

<span class="cp"># OpenCV</span>
<span class="nl">OPENCV_CAMERA_MODULES</span><span class="p">:</span><span class="o">=</span><span class="n">on</span>
<span class="nl">OPENCV_INSTALL_MODULES</span><span class="p">:</span><span class="o">=</span><span class="n">on</span>
<span class="n">include</span> <span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="n">sdk</span><span class="o">/</span><span class="n">native</span><span class="o">/</span><span class="n">jni</span><span class="o">/</span><span class="n">OpenCV</span><span class="p">.</span><span class="n">mk</span>
</pre>
<p>After that the OpenCV libraries will be copied to your application <code class="docutils literal notranslate"><span class="pre">libs</span></code> folder during the JNI build.v</p>
<p>Eclipse will automatically include all the libraries from the <code class="docutils literal notranslate"><span class="pre">libs</span></code> folder to the application package (APK).</p>
</li>
<li><p class="first">The last step of enabling OpenCV in your application is Java initialization code before calling OpenCV API. It can be done, for example, in the static section of the Activity class:</p>
<pre class="highlight literal-block">
<span></span><span class="k">static</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">OpenCVLoader</span><span class="p">.</span><span class="n">initDebug</span><span class="p">())</span> <span class="p">{</span>
        <span class="c1">// Handle initialization error</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
<p>If you application includes other OpenCV-dependent native libraries you should load them <strong>after</strong> OpenCV initialization:</p>
<pre class="highlight literal-block">
<span></span><span class="k">static</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">OpenCVLoader</span><span class="p">.</span><span class="n">initDebug</span><span class="p">())</span> <span class="p">{</span>
        <span class="c1">// Handle initialization error</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="n">loadLibrary</span><span class="p">(</span><span class="s">&quot;my_jni_lib1&quot;</span><span class="p">);</span>
        <span class="n">System</span><span class="p">.</span><span class="n">loadLibrary</span><span class="p">(</span><span class="s">&quot;my_jni_lib2&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
</li>
</ol>
<p class="rubric">Native/C++</p>
<p>To build your own Android application, using OpenCV as native part, the following steps should be taken:</p>
<ol class="arabic">
<li><p class="first">You can use an environment variable to specify the location of OpenCV package or just hardcode absolute or relative path in the <code class="docutils literal notranslate"><span class="pre">jni/Android.mk</span></code> of your projects.</p>
</li>
<li><p class="first">The file <code class="docutils literal notranslate"><span class="pre">jni/Android.mk</span></code> should be written for the current application using the common rules for this file.</p>
<p>For detailed information see the Android NDK documentation from the Android NDK archive, in the file <code class="docutils literal notranslate"><span class="pre">&lt;path_where_NDK_is_placed&gt;/docs/ANDROID-MK.html</span></code>.</p>
</li>
<li><p class="first">The following line:</p>
<pre class="highlight literal-block">
<span></span><span class="n">include</span> <span class="nl">C</span><span class="p">:</span><span class="err">\</span><span class="n">Work</span><span class="err">\</span><span class="n">OpenCV4Android</span><span class="err">\</span><span class="n">OpenCV</span><span class="o">-</span><span class="mf">2.4.9</span><span class="o">-</span><span class="n">android</span><span class="o">-</span><span class="n">sdk</span><span class="err">\</span><span class="n">sdk</span><span class="err">\</span><span class="n">native</span><span class="err">\</span><span class="n">jni</span><span class="err">\</span><span class="n">OpenCV</span><span class="p">.</span><span class="n">mk</span>
</pre>
<p>Should be inserted into the <code class="docutils literal notranslate"><span class="pre">jni/Android.mk</span></code> file <strong>after</strong> this line:</p>
<pre class="highlight literal-block">
<span></span><span class="n">include</span> <span class="err">$</span><span class="p">(</span><span class="n">CLEAR_VARS</span><span class="p">)</span>
</pre>
</li>
<li><p class="first">Several variables can be used to customize OpenCV stuff, but you <strong>don’t need</strong> to use them when your application uses the async initialization via the OpenCV Manager API.</p>
<p>These variables should be set <strong>before</strong> the “include …/OpenCV.mk” line:</p>
<pre class="highlight literal-block">
<span></span><span class="nl">OPENCV_INSTALL_MODULES</span><span class="p">:</span><span class="o">=</span><span class="n">on</span>
</pre>
<p>Copies necessary OpenCV dynamic libs to the project libs folder in order to include them into the APK.</p>
<pre class="highlight literal-block">
<span></span><span class="nl">OPENCV_CAMERA_MODULES</span><span class="p">:</span><span class="o">=</span><span class="n">off</span>
</pre>
<p>Skip native OpenCV camera related libs copying to the project libs folder.</p>
<pre class="highlight literal-block">
<span></span><span class="nl">OPENCV_LIB_TYPE</span><span class="p">:</span><span class="o">=</span><span class="n">STATIC</span>
</pre>
<p>Perform static linking with OpenCV. By default dynamic link is used and the project JNI lib depends on libopencv_java.so.</p>
</li>
<li><p class="first">The file <code class="docutils literal notranslate"><span class="pre">Application.mk</span></code> should exist and should contain lines:</p>
<pre class="highlight literal-block">
<span></span><span class="nl">APP_STL</span> <span class="p">:</span><span class="o">=</span> <span class="n">gnustl_static</span>
<span class="nl">APP_CPPFLAGS</span> <span class="p">:</span><span class="o">=</span> <span class="o">-</span><span class="n">frtti</span> <span class="o">-</span><span class="n">fexceptions</span>
</pre>
<p>Also, the line like this one:</p>
<pre class="highlight literal-block">
<span></span><span class="nl">APP_ABI</span> <span class="p">:</span><span class="o">=</span> <span class="n">armeabi</span><span class="o">-</span><span class="n">v7a</span>
</pre>
<p>Should specify the application target platforms.</p>
<p>In some cases a linkage error (like <cite>“In function ‘cv::toUtf16(std::basic_string&lt;…&gt;… undefined reference to ‘mbstowcs’”</cite>) happens when building an application JNI library, depending on OpenCV. The following line in the <code class="docutils literal notranslate"><span class="pre">Application.mk</span></code> usually fixes it:</p>
<pre class="highlight literal-block">
<span></span><span class="nl">APP_PLATFORM</span> <span class="p">:</span><span class="o">=</span> <span class="n">android</span><span class="o">-</span><span class="mi">9</span>
</pre>
</li>
<li><p class="first">Either use <a class="reference internal" href="page_tutorial_android_dev_intro.html#doxid-d9-d3f-tutorial-android-dev-intro-1tutorial-android-dev-intro-ndk"><span class="std std-ref">manual</span></a> ndk-build invocation or <a class="reference internal" href="page_tutorial_android_dev_intro.html#doxid-d9-d3f-tutorial-android-dev-intro-1tutorial-android-dev-intro-eclipse"><span class="std std-ref">setup Eclipse CDT Builder</span></a> to build native JNI lib before (re)building the Java part and creating an APK.</p>
</li>
</ol>
<p class="rubric">Hello OpenCV Sample</p>
<p>Here are basic steps to guide you trough the process of creating a simple OpenCV-centric application. It will be capable of accessing camera output, processing it and displaying the result.</p>
<ol class="arabic">
<li><p class="first">Open Eclipse IDE, create a new clean workspace, create a new Android project File&gt; New&gt; Android Project</p>
</li>
<li><p class="first">Set name, target, package and minSDKVersion accordingly. The minimal SDK version for build with OpenCV4Android SDK is 11. Minimal device API Level (for application manifest) is 8.</p>
</li>
<li><p class="first">Allow Eclipse to create default activity. Lets name the activity HelloOpenCvActivity.</p>
</li>
<li><p class="first">Choose Blank Activity with full screen layout. Lets name the layout HelloOpenCvLayout.</p>
</li>
<li><p class="first">Import OpenCV library project to your workspace.</p>
</li>
<li><p class="first">Reference OpenCV library within your project properties.</p>
<img alt="_images/dev_OCV_reference.png" src="_images/dev_OCV_reference.png" />
</li>
<li><p class="first">Edit your layout file as xml file and pass the following layout there:</p>
<pre class="highlight literal-block">
<span></span><span class="o">&lt;</span><span class="n">LinearLayout</span> <span class="nl">xmlns</span><span class="p">:</span><span class="n">android</span><span class="o">=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
    <span class="nl">xmlns</span><span class="p">:</span><span class="n">tools</span><span class="o">=</span><span class="s">&quot;http://schemas.android.com/tools&quot;</span>
    <span class="nl">xmlns</span><span class="p">:</span><span class="n">opencv</span><span class="o">=</span><span class="s">&quot;http://schemas.android.com/apk/res-auto&quot;</span>
    <span class="nl">android</span><span class="p">:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">&quot;match_parent&quot;</span>
    <span class="nl">android</span><span class="p">:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">&quot;match_parent&quot;</span> <span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="n">org</span><span class="p">.</span><span class="n">opencv</span><span class="p">.</span><span class="n">android</span><span class="p">.</span><span class="n">JavaCameraView</span>
        <span class="nl">android</span><span class="p">:</span><span class="n">layout_width</span><span class="o">=</span><span class="s">&quot;fill_parent&quot;</span>
        <span class="nl">android</span><span class="p">:</span><span class="n">layout_height</span><span class="o">=</span><span class="s">&quot;fill_parent&quot;</span>
        <span class="nl">android</span><span class="p">:</span><span class="n">visibility</span><span class="o">=</span><span class="s">&quot;gone&quot;</span>
        <span class="nl">android</span><span class="p">:</span><span class="n">id</span><span class="o">=</span><span class="s">&quot;@+id/HelloOpenCvView&quot;</span>
        <span class="nl">opencv</span><span class="p">:</span><span class="n">show_fps</span><span class="o">=</span><span class="s">&quot;true&quot;</span>
        <span class="nl">opencv</span><span class="p">:</span><span class="n">camera_id</span><span class="o">=</span><span class="s">&quot;any&quot;</span> <span class="o">/&gt;</span>

<span class="o">&lt;/</span><span class="n">LinearLayout</span><span class="o">&gt;</span>
</pre>
</li>
<li><p class="first">Add the following permissions to the <code class="docutils literal notranslate"><span class="pre">AndroidManifest.xml</span></code> file:</p>
<pre class="highlight literal-block">
<span></span><span class="o">&lt;/</span><span class="n">application</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">uses</span><span class="o">-</span><span class="n">permission</span> <span class="nl">android</span><span class="p">:</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;android.permission.CAMERA&quot;</span><span class="o">/&gt;</span>

<span class="o">&lt;</span><span class="n">uses</span><span class="o">-</span><span class="n">feature</span> <span class="nl">android</span><span class="p">:</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;android.hardware.camera&quot;</span> <span class="nl">android</span><span class="p">:</span><span class="n">required</span><span class="o">=</span><span class="s">&quot;false&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">uses</span><span class="o">-</span><span class="n">feature</span> <span class="nl">android</span><span class="p">:</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;android.hardware.camera.autofocus&quot;</span> <span class="nl">android</span><span class="p">:</span><span class="n">required</span><span class="o">=</span><span class="s">&quot;false&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">uses</span><span class="o">-</span><span class="n">feature</span> <span class="nl">android</span><span class="p">:</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;android.hardware.camera.front&quot;</span> <span class="nl">android</span><span class="p">:</span><span class="n">required</span><span class="o">=</span><span class="s">&quot;false&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">uses</span><span class="o">-</span><span class="n">feature</span> <span class="nl">android</span><span class="p">:</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;android.hardware.camera.front.autofocus&quot;</span> <span class="nl">android</span><span class="p">:</span><span class="n">required</span><span class="o">=</span><span class="s">&quot;false&quot;</span><span class="o">/&gt;</span>
</pre>
</li>
<li><p class="first">Set application theme in AndroidManifest.xml to hide title and system buttons.</p>
<pre class="highlight literal-block">
<span></span><span class="o">&lt;</span><span class="n">application</span>
    <span class="nl">android</span><span class="p">:</span><span class="n">icon</span><span class="o">=</span><span class="s">&quot;@drawable/icon&quot;</span>
    <span class="nl">android</span><span class="p">:</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;@string/app_name&quot;</span>
    <span class="nl">android</span><span class="p">:</span><span class="n">theme</span><span class="o">=</span><span class="s">&quot;@android:style/Theme.NoTitleBar.Fullscreen&quot;</span> <span class="o">&gt;</span>
</pre>
</li>
<li><p class="first">Add OpenCV library initialization to your activity. Fix errors by adding required imports.</p>
<pre class="highlight literal-block">
<span></span><span class="k">private</span> <span class="n">BaseLoaderCallback</span> <span class="n">mLoaderCallback</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BaseLoaderCallback</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span>
    <span class="err">@</span><span class="n">Override</span>
    <span class="k">public</span> <span class="kt">void</span> <span class="n">onManagerConnected</span><span class="p">(</span><span class="kt">int</span> <span class="n">status</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="n">LoaderCallbackInterface</span><span class="p">.</span><span class="nl">SUCCESS</span><span class="p">:</span>
            <span class="p">{</span>
                <span class="n">Log</span><span class="p">.</span><span class="n">i</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s">&quot;OpenCV loaded successfully&quot;</span><span class="p">);</span>
                <span class="n">mOpenCvCameraView</span><span class="p">.</span><span class="n">enableView</span><span class="p">();</span>
            <span class="p">}</span> <span class="k">break</span><span class="p">;</span>
            <span class="k">default</span><span class="o">:</span>
            <span class="p">{</span>
                <span class="n">super</span><span class="p">.</span><span class="n">onManagerConnected</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="err">@</span><span class="n">Override</span>
<span class="k">public</span> <span class="kt">void</span> <span class="n">onResume</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">super</span><span class="p">.</span><span class="n">onResume</span><span class="p">();</span>
    <span class="n">OpenCVLoader</span><span class="p">.</span><span class="n">initAsync</span><span class="p">(</span><span class="n">OpenCVLoader</span><span class="p">.</span><span class="n">OPENCV_VERSION_2_4_6</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="n">mLoaderCallback</span><span class="p">);</span>
<span class="p">}</span>
</pre>
</li>
<li><p class="first">Defines that your activity implements CvCameraViewListener2 interface and fix activity related errors by defining missed methods. For this activity define onCreate, onDestroy and onPause and implement them according code snippet bellow. Fix errors by adding required imports.</p>
<pre class="highlight literal-block">
<span></span><span class="k">private</span> <span class="n">CameraBridgeViewBase</span> <span class="n">mOpenCvCameraView</span><span class="p">;</span>

<span class="err">@</span><span class="n">Override</span>
<span class="k">public</span> <span class="kt">void</span> <span class="n">onCreate</span><span class="p">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Log</span><span class="p">.</span><span class="n">i</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span> <span class="s">&quot;called onCreate&quot;</span><span class="p">);</span>
    <span class="n">super</span><span class="p">.</span><span class="n">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span>
    <span class="n">getWindow</span><span class="p">().</span><span class="n">addFlags</span><span class="p">(</span><span class="n">WindowManager</span><span class="p">.</span><span class="n">LayoutParams</span><span class="p">.</span><span class="n">FLAG_KEEP_SCREEN_ON</span><span class="p">);</span>
    <span class="n">setContentView</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">HelloOpenCvLayout</span><span class="p">);</span>
    <span class="n">mOpenCvCameraView</span> <span class="o">=</span> <span class="p">(</span><span class="n">CameraBridgeViewBase</span><span class="p">)</span> <span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">HelloOpenCvView</span><span class="p">);</span>
    <span class="n">mOpenCvCameraView</span><span class="p">.</span><span class="n">setVisibility</span><span class="p">(</span><span class="n">SurfaceView</span><span class="p">.</span><span class="n">VISIBLE</span><span class="p">);</span>
    <span class="n">mOpenCvCameraView</span><span class="p">.</span><span class="n">setCvCameraViewListener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>

<span class="err">@</span><span class="n">Override</span>
<span class="k">public</span> <span class="kt">void</span> <span class="n">onPause</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">super</span><span class="p">.</span><span class="n">onPause</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mOpenCvCameraView</span> <span class="o">!=</span> <span class="n">null</span><span class="p">)</span>
        <span class="n">mOpenCvCameraView</span><span class="p">.</span><span class="n">disableView</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">public</span> <span class="kt">void</span> <span class="n">onDestroy</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">super</span><span class="p">.</span><span class="n">onDestroy</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mOpenCvCameraView</span> <span class="o">!=</span> <span class="n">null</span><span class="p">)</span>
        <span class="n">mOpenCvCameraView</span><span class="p">.</span><span class="n">disableView</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">public</span> <span class="kt">void</span> <span class="n">onCameraViewStarted</span><span class="p">(</span><span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">)</span> <span class="p">{</span>
<span class="p">}</span>

<span class="k">public</span> <span class="kt">void</span> <span class="n">onCameraViewStopped</span><span class="p">()</span> <span class="p">{</span>
<span class="p">}</span>

<span class="k">public</span> <span class="n">Mat</span> <span class="n">onCameraFrame</span><span class="p">(</span><span class="n">CvCameraViewFrame</span> <span class="n">inputFrame</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">inputFrame</span><span class="p">.</span><span class="n">rgba</span><span class="p">();</span>
<span class="p">}</span>
</pre>
</li>
<li><p class="first">Run your application on device or emulator.</p>
</li>
</ol>
<p>Lets discuss some most important steps. Every Android application with UI must implement Activity and View. By the first steps we create blank activity and default view layout. The simplest OpenCV-centric application must implement OpenCV initialization, create its own view to show preview from camera and implements CvCameraViewListener2 interface to get frames from camera and process it.</p>
<p>First of all we create our application view using xml layout. Our layout consists of the only one full screen component of class org.opencv.android.JavaCameraView. This class is implemented inside OpenCV library. It is inherited from CameraBridgeViewBase, that extends SurfaceView and uses standard Android camera API.</p>
<p>After creating layout we need to implement Activity class. OpenCV initialization process has been already discussed above. In this sample we use asynchronous initialization. Implementation of CvCameraViewListener interface allows you to add processing steps after frame grabbing from camera and before its rendering on screen. The most important function is onCameraFrame. It is callback function and it is called on retrieving frame from camera. The callback input is object of CvCameraViewFrame class that represents frame from camera.</p>
<p>Do not save or use CvCameraViewFrame object out of onCameraFrame callback. This object does not have its own state and its behavior out of callback is unpredictable!</p>
<p>It has rgba() and gray() methods that allows to get frame as RGBA and one channel gray scale Mat respectively. It expects that onCameraFrame function returns RGBA frame that will be drawn on the screen.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="page_tutorial_building_tegra_cuda.html" class="btn btn-neutral float-right" title="Building OpenCV for Tegra with CUDA" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="page_tutorial_table_of_content_introduction.html" class="btn btn-neutral float-left" title="Introduction to OpenCV" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 1999-2017, OpenCV Maintainers

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>