

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>High Dynamic Range Imaging &mdash; OpenCV Documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="_static/target-highlight.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/doxyrest-pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/doxyrest-sphinx_rtd_theme.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="GPU-Accelerated Computer Vision (cuda module)" href="page_tutorial_table_of_content_gpu.html" />
    <link rel="prev" title="Computational photography (photo module)" href="page_tutorial_table_of_content_photo.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> OpenCV Documentation
          

          
          </a>

          
            
            
              <div class="version">
                3.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="group_features2d.html">2D Features Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_viz.html">3D Visualizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_calib3d.html">Camera Calibration and 3D Reconstruction</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_flann.html">Clustering and Search in Multi-Dimensional Spaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_photo.html">Computational Photography</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_core.html">Core functionality</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_highgui.html">High-level GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_imgcodecs.html">Image file reading and writing</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_imgproc.html">Image processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_stitching.html">Images stitching</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_ml.html">Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_objdetect.html">Object Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_shape.html">Shape Distance and Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_superres.html">Super Resolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_video.html">Video Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_videoio.html">Video I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_videostab.html">Video Stabilization</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="page_citelist.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_cuda_intro.html">CUDA Module Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_imgproc_color_conversions.html">Color conversions</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_deprecated.html">Deprecated List</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_ml_intro.html">Machine Learning Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="page_tutorial_root.html">OpenCV Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_features2d.html">2D Features framework (feature2d module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_calib3d.html">Camera calibration and 3D reconstruction (calib3d module)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="page_tutorial_table_of_content_photo.html">Computational photography (photo module)</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">High Dynamic Range Imaging</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_gpu.html">GPU-Accelerated Computer Vision (cuda module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_highgui.html">High Level GUI and Media (highgui module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_imgcodecs.html">Image Input and Output (imgcodecs module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_imgproc.html">Image Processing (imgproc module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_stitching.html">Images stitching (stitching module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_introduction.html">Introduction to OpenCV</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_ml.html">Machine Learning (ml module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_objdetect.html">Object Detection (objdetect module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_viz.html">OpenCV Viz</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_ios.html">OpenCV iOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_core.html">The Core Functionality (core module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_videoio.html">Video Input and Output (videoio module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_video.html">Video analysis (video module)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="page_index.html">OpenCV modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_tutorial_py_root.html">OpenCV-Python Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_todo.html">Todo List</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_videoio_overview.html">Video I/O with OpenCV Overview</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="example_contours2.cpp.html">contours2.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_convexhull.cpp.html">convexhull.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_cout_mat.cpp.html">cout_mat.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_demhist.cpp.html">demhist.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_distrans.cpp.html">distrans.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_edge.cpp.html">edge.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_ffilldemo.cpp.html">ffilldemo.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_filestorage.cpp.html">filestorage.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_fitellipse.cpp.html">fitellipse.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_grabcut.cpp.html">grabcut.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_houghcircles.cpp.html">houghcircles.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_houghlines.cpp.html">houghlines.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_kmeans.cpp.html">kmeans.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_laplace.cpp.html">laplace.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_lsd_lines.cpp.html">lsd_lines.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_minarea.cpp.html">minarea.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_morphology2.cpp.html">morphology2.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_pca.cpp.html">pca.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_polar_transforms.cpp.html">polar_transforms.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_segment_objects.cpp.html">segment_objects.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_watershed.cpp.html">watershed.cpp</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="global.html">Global Namespace</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">OpenCV Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="page_tutorial_root.html">OpenCV Tutorials</a> &raquo;</li>
        
          <li><a href="page_tutorial_table_of_content_photo.html">Computational photography (photo module)</a> &raquo;</li>
        
      <li>High Dynamic Range Imaging</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="high-dynamic-range-imaging">
<span id="doxid-d3-db7-tutorial-hdr-imaging"></span><span id="index-0"></span><h1>High Dynamic Range Imaging</h1>
<p class="rubric">Introduction</p>
<p>Today most digital images and imaging devices use 8 bits per channel thus limiting the dynamic range of the device to two orders of magnitude (actually 256 levels), while human eye can adapt to lighting conditions varying by ten orders of magnitude. When we take photographs of a real world scene bright regions may be overexposed, while the dark ones may be underexposed, so we can’t capture all details using a single exposure. HDR imaging works with images that use more that 8 bits per channel (usually 32-bit float values), allowing much wider dynamic range.</p>
<p>There are different ways to obtain HDR images, but the most common one is to use photographs of the scene taken with different exposure values. To combine this exposures it is useful to know your camera’s response function and there are algorithms to estimate it. After the HDR image has been blended it has to be converted back to 8-bit to view it on usual displays. This process is called tonemapping. Additional complexities arise when objects of the scene or camera move between shots, since images with different exposures should be registered and aligned.</p>
<p>In this tutorial we show how to generate and display HDR image from an exposure sequence. In our case images are already aligned and there are no moving objects. We also demonstrate an alternative approach called exposure fusion that produces low dynamic range image. Each step of HDR pipeline can be implemented using different algorithms so take a look at the reference manual to see them all.</p>
<p class="rubric">Exposure sequence</p>
<img alt="_images/memorial.png" src="_images/memorial.png" />
<p class="rubric">Source Code</p>
<pre class="highlight literal-block">
<span></span><span class="cp">#include</span> <span class="cpf">&lt;opencv2/photo.hpp&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;opencv2/imgcodecs.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;opencv2/highgui.hpp&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;fstream&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <a class="reference internal" href="namespace_cv.html#doxid-d2-d75-namespacecv"><span class="std std-ref">cv</span></a><span></span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <a class="reference internal" href="namespace_std.html#doxid-d8-dcc-namespacestd"><span class="std std-ref">std</span></a><span></span><span class="p">;</span>

<span class="kt">void</span> <span class="n">loadExposureSeq</span><span class="p">(</span><a class="reference internal" href="class_cv_String.html#doxid-dc-d0e-classcv-1-1-string"><span class="std std-ref">String</span></a><span></span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Mat</span><span class="o">&gt;&amp;</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;&amp;</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="n">Mat</span><span class="o">&gt;</span> <span class="n">images</span><span class="p">;</span>
    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">times</span><span class="p">;</span>
    <span class="n">loadExposureSeq</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">images</span><span class="p">,</span> <span class="n">times</span><span class="p">);</span>

    <a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat"><span class="std std-ref">Mat</span></a><span></span> <span class="n">response</span><span class="p">;</span>
    <a class="reference internal" href="struct_cv_Ptr.html#doxid-d2-d56-structcv-1-1-ptr"><span class="std std-ref">Ptr&lt;CalibrateDebevec&gt;</span></a><span></span> <a class="reference internal" href="group_calib3d_fisheye.html#doxid-db-d58-group-calib3d-fisheye-1gad626a78de2b1dae7489e152a5a5a89e1"><span class="std std-ref">calibrate</span></a><span></span> <span class="o">=</span> <a class="reference internal" href="group_photo_hdr.html#doxid-d6-df5-group-photo-hdr-1ga7fed9707ad5f2cc0e633888867109f90"><span class="std std-ref">createCalibrateDebevec</span></a><span></span><span class="p">();</span>
    <span class="n">calibrate</span><span class="o">-&gt;</span><a class="reference internal" href="class_cv_CalibrateCRF.html#doxid-d6-d43-classcv-1-1-calibrate-c-r-f-1a7bd220808762094e0b48819f63437196"><span class="std std-ref">process</span></a><span></span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">times</span><span class="p">);</span>

    <a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat"><span class="std std-ref">Mat</span></a><span></span> <span class="n">hdr</span><span class="p">;</span>
    <a class="reference internal" href="struct_cv_Ptr.html#doxid-d2-d56-structcv-1-1-ptr"><span class="std std-ref">Ptr&lt;MergeDebevec&gt;</span></a><span></span> <span class="n">merge_debevec</span> <span class="o">=</span> <a class="reference internal" href="group_photo_hdr.html#doxid-d6-df5-group-photo-hdr-1gaa8eab36bc764abb2a225db7c945f87f9"><span class="std std-ref">createMergeDebevec</span></a><span></span><span class="p">();</span>
    <span class="n">merge_debevec</span><span class="o">-&gt;</span><a class="reference internal" href="class_cv_MergeDebevec.html#doxid-df-d17-classcv-1-1-merge-debevec-1ae5bb2bef786549e1a1db8c2bbcee2e13"><span class="std std-ref">process</span></a><span></span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">hdr</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">response</span><span class="p">);</span>

    <a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat"><span class="std std-ref">Mat</span></a><span></span> <span class="n">ldr</span><span class="p">;</span>
    <a class="reference internal" href="struct_cv_Ptr.html#doxid-d2-d56-structcv-1-1-ptr"><span class="std std-ref">Ptr&lt;TonemapDurand&gt;</span></a><span></span> <span class="n">tonemap</span> <span class="o">=</span> <a class="reference internal" href="group_photo_hdr.html#doxid-d6-df5-group-photo-hdr-1ga19150c9a4b670437e374e51a3e865654"><span class="std std-ref">createTonemapDurand</span></a><span></span><span class="p">(</span><span class="mf">2.2f</span><span class="p">);</span>
    <span class="n">tonemap</span><span class="o">-&gt;</span><a class="reference internal" href="class_cv_Tonemap.html#doxid-d0-dd3-classcv-1-1-tonemap-1aa705c3b7226f7028a5c117dffab60fe4"><span class="std std-ref">process</span></a><span></span><span class="p">(</span><span class="n">hdr</span><span class="p">,</span> <span class="n">ldr</span><span class="p">);</span>

    <a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat"><span class="std std-ref">Mat</span></a><span></span> <span class="n">fusion</span><span class="p">;</span>
    <a class="reference internal" href="struct_cv_Ptr.html#doxid-d2-d56-structcv-1-1-ptr"><span class="std std-ref">Ptr&lt;MergeMertens&gt;</span></a><span></span> <span class="n">merge_mertens</span> <span class="o">=</span> <a class="reference internal" href="group_photo_hdr.html#doxid-d6-df5-group-photo-hdr-1ga79d59aa3cb3a7c664e59a4b5acc1ccb6"><span class="std std-ref">createMergeMertens</span></a><span></span><span class="p">();</span>
    <span class="n">merge_mertens</span><span class="o">-&gt;</span><a class="reference internal" href="class_cv_MergeMertens.html#doxid-df-d3e-classcv-1-1-merge-mertens-1a3b5ae3fe6c15bd7db83f213903858ea0"><span class="std std-ref">process</span></a><span></span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">fusion</span><span class="p">);</span>

    <a class="reference internal" href="group_imgcodecs.html#doxid-d4-da8-group-imgcodecs-1gabbc7ef1aa2edfaa87772f1202d67e0ce"><span class="std std-ref">imwrite</span></a><span></span><span class="p">(</span><span class="s">&quot;fusion.png&quot;</span><span class="p">,</span> <span class="n">fusion</span> <span class="o">*</span> <span class="mi">255</span><span class="p">);</span>
    <a class="reference internal" href="group_imgcodecs.html#doxid-d4-da8-group-imgcodecs-1gabbc7ef1aa2edfaa87772f1202d67e0ce"><span class="std std-ref">imwrite</span></a><span></span><span class="p">(</span><span class="s">&quot;ldr.png&quot;</span><span class="p">,</span> <span class="n">ldr</span> <span class="o">*</span> <span class="mi">255</span><span class="p">);</span>
    <a class="reference internal" href="group_imgcodecs.html#doxid-d4-da8-group-imgcodecs-1gabbc7ef1aa2edfaa87772f1202d67e0ce"><span class="std std-ref">imwrite</span></a><span></span><span class="p">(</span><span class="s">&quot;hdr.hdr&quot;</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">loadExposureSeq</span><span class="p">(</span><a class="reference internal" href="class_cv_String.html#doxid-dc-d0e-classcv-1-1-string"><span class="std std-ref">String</span></a><span></span> <span class="n">path</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Mat</span><span class="o">&gt;&amp;</span> <span class="n">images</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;&amp;</span> <span class="n">times</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">);</span>
    <span class="n">ifstream</span> <span class="nf">list_file</span><span class="p">((</span><span class="n">path</span> <span class="o">+</span> <span class="s">&quot;list.txt&quot;</span><span class="p">).</span><span class="n">c_str</span><span class="p">());</span>
    <span class="n">string</span> <span class="n">name</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">val</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">list_file</span> <span class="o">&gt;&gt;</span> <span class="n">name</span> <span class="o">&gt;&gt;</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
        <a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat"><span class="std std-ref">Mat</span></a><span></span> <span class="n">img</span> <span class="o">=</span> <a class="reference internal" href="group_imgcodecs.html#doxid-d4-da8-group-imgcodecs-1ga288b8b3da0892bd651fce07b3bbd3a56"><span class="std std-ref">imread</span></a><span></span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="n">name</span><span class="p">);</span>
        <span class="n">images</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">img</span><span class="p">);</span>
        <span class="n">times</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">val</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">list_file</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
<span class="p">}</span>
</pre>
<p class="rubric">Explanation</p>
<ol class="arabic">
<li><p class="first"><strong>Load images and exposure times</strong></p>
<pre class="highlight literal-block">
<span></span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Mat</span><span class="o">&gt;</span> <span class="n">images</span><span class="p">;</span>
<span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">times</span><span class="p">;</span>
<span class="n">loadExposureSeq</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">images</span><span class="p">,</span> <span class="n">times</span><span class="p">);</span>
</pre>
<p>Firstly we load input images and exposure times from user-defined folder. The folder should contain images and <em>list.txt</em> - file that contains file names and inverse exposure times.</p>
<p>For our image sequence the list is following:</p>
<pre class="highlight literal-block">
<span></span><span class="n">memorial00</span><span class="p">.</span><span class="n">png</span> <span class="mf">0.03125</span>
<span class="n">memorial01</span><span class="p">.</span><span class="n">png</span> <span class="mf">0.0625</span>
<span class="p">...</span>
<span class="n">memorial15</span><span class="p">.</span><span class="n">png</span> <span class="mi">1024</span>
</pre>
</li>
<li><p class="first"><strong>Estimate camera response</strong></p>
<pre class="highlight literal-block">
<span></span><span class="n">Mat</span> <span class="n">response</span><span class="p">;</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">CalibrateDebevec</span><span class="o">&gt;</span> <span class="n">calibrate</span> <span class="o">=</span> <a class="reference internal" href="group_photo_hdr.html#doxid-d6-df5-group-photo-hdr-1ga7fed9707ad5f2cc0e633888867109f90"><span class="std std-ref">createCalibrateDebevec</span></a><span></span><span class="p">();</span>
<span class="n">calibrate</span><span class="o">-&gt;</span><span class="n">process</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">times</span><span class="p">);</span>
</pre>
<p>It is necessary to know camera response function (CRF) for a lot of HDR construction algorithms. We use one of the calibration algorithms to estimate inverse CRF for all 256 pixel values.</p>
</li>
<li><p class="first"><strong>Make HDR image</strong></p>
<pre class="highlight literal-block">
<span></span><span class="n">Mat</span> <span class="n">hdr</span><span class="p">;</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">MergeDebevec</span><span class="o">&gt;</span> <span class="n">merge_debevec</span> <span class="o">=</span> <a class="reference internal" href="group_photo_hdr.html#doxid-d6-df5-group-photo-hdr-1gaa8eab36bc764abb2a225db7c945f87f9"><span class="std std-ref">createMergeDebevec</span></a><span></span><span class="p">();</span>
<span class="n">merge_debevec</span><span class="o">-&gt;</span><span class="n">process</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">hdr</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">response</span><span class="p">);</span>
</pre>
<p>We use Debevec’s weighting scheme to construct HDR image using response calculated in the previous item.</p>
</li>
<li><p class="first"><strong>Tonemap HDR image</strong></p>
<pre class="highlight literal-block">
<span></span><span class="n">Mat</span> <span class="n">ldr</span><span class="p">;</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">TonemapDurand</span><span class="o">&gt;</span> <span class="n">tonemap</span> <span class="o">=</span> <a class="reference internal" href="group_photo_hdr.html#doxid-d6-df5-group-photo-hdr-1ga19150c9a4b670437e374e51a3e865654"><span class="std std-ref">createTonemapDurand</span></a><span></span><span class="p">(</span><span class="mf">2.2f</span><span class="p">);</span>
<span class="n">tonemap</span><span class="o">-&gt;</span><span class="n">process</span><span class="p">(</span><span class="n">hdr</span><span class="p">,</span> <span class="n">ldr</span><span class="p">);</span>
</pre>
<p>Since we want to see our results on common LDR display we have to map our HDR image to 8-bit range preserving most details. It is the main goal of tonemapping methods. We use tonemapper with bilateral filtering and set 2.2 as the value for gamma correction.</p>
</li>
<li><p class="first"><strong>Perform exposure fusion</strong></p>
<pre class="highlight literal-block">
<span></span><span class="n">Mat</span> <span class="n">fusion</span><span class="p">;</span>
<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">MergeMertens</span><span class="o">&gt;</span> <span class="n">merge_mertens</span> <span class="o">=</span> <a class="reference internal" href="group_photo_hdr.html#doxid-d6-df5-group-photo-hdr-1ga79d59aa3cb3a7c664e59a4b5acc1ccb6"><span class="std std-ref">createMergeMertens</span></a><span></span><span class="p">();</span>
<span class="n">merge_mertens</span><span class="o">-&gt;</span><span class="n">process</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">fusion</span><span class="p">);</span>
</pre>
<p>There is an alternative way to merge our exposures in case when we don’t need HDR image. This process is called exposure fusion and produces LDR image that doesn’t require gamma correction. It also doesn’t use exposure values of the photographs.</p>
</li>
<li><p class="first"><strong>Write results</strong></p>
<pre class="highlight literal-block">
<a class="reference internal" href="group_imgcodecs.html#doxid-d4-da8-group-imgcodecs-1gabbc7ef1aa2edfaa87772f1202d67e0ce"><span class="std std-ref">imwrite</span></a><span></span><span class="p">(</span><span class="s">&quot;fusion.png&quot;</span><span class="p">,</span> <span class="n">fusion</span> <span class="o">*</span> <span class="mi">255</span><span class="p">);</span>
<a class="reference internal" href="group_imgcodecs.html#doxid-d4-da8-group-imgcodecs-1gabbc7ef1aa2edfaa87772f1202d67e0ce"><span class="std std-ref">imwrite</span></a><span></span><span class="p">(</span><span class="s">&quot;ldr.png&quot;</span><span class="p">,</span> <span class="n">ldr</span> <span class="o">*</span> <span class="mi">255</span><span class="p">);</span>
<a class="reference internal" href="group_imgcodecs.html#doxid-d4-da8-group-imgcodecs-1gabbc7ef1aa2edfaa87772f1202d67e0ce"><span class="std std-ref">imwrite</span></a><span></span><span class="p">(</span><span class="s">&quot;hdr.hdr&quot;</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
</pre>
<p>Now it’s time to look at the results. Note that HDR image can’t be stored in one of common image formats, so we save it to Radiance image (.hdr). Also all HDR imaging functions return results in [0, 1] range so we should multiply result by 255.</p>
</li>
</ol>
<p class="rubric">Results</p>
<p class="rubric">Tonemapped image</p>
<img alt="_images/ldr.png" src="_images/ldr.png" />
<p class="rubric">Exposure fusion</p>
<img alt="_images/fusion.png" src="_images/fusion.png" />
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="page_tutorial_table_of_content_gpu.html" class="btn btn-neutral float-right" title="GPU-Accelerated Computer Vision (cuda module)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="page_tutorial_table_of_content_photo.html" class="btn btn-neutral float-left" title="Computational photography (photo module)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 1999-2017, OpenCV Maintainers

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>