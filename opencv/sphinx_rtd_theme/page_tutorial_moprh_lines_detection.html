

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Extract horizontal and vertical lines by using morphological operations &mdash; OpenCV Documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="_static/target-highlight.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/doxyrest-pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/doxyrest-sphinx_rtd_theme.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Finding contours in your image" href="page_tutorial_find_contours.html" />
    <link rel="prev" title="Eroding and Dilating" href="page_tutorial_erosion_dilatation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> OpenCV Documentation
          

          
          </a>

          
            
            
              <div class="version">
                3.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="group_features2d.html">2D Features Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_viz.html">3D Visualizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_calib3d.html">Camera Calibration and 3D Reconstruction</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_flann.html">Clustering and Search in Multi-Dimensional Spaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_photo.html">Computational Photography</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_core.html">Core functionality</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_highgui.html">High-level GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_imgcodecs.html">Image file reading and writing</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_imgproc.html">Image processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_stitching.html">Images stitching</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_ml.html">Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_objdetect.html">Object Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_shape.html">Shape Distance and Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_superres.html">Super Resolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_video.html">Video Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_videoio.html">Video I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_videostab.html">Video Stabilization</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="page_citelist.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_cuda_intro.html">CUDA Module Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_imgproc_color_conversions.html">Color conversions</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_deprecated.html">Deprecated List</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_ml_intro.html">Machine Learning Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="page_tutorial_root.html">OpenCV Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_features2d.html">2D Features framework (feature2d module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_calib3d.html">Camera calibration and 3D reconstruction (calib3d module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_photo.html">Computational photography (photo module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_gpu.html">GPU-Accelerated Computer Vision (cuda module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_highgui.html">High Level GUI and Media (highgui module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_imgcodecs.html">Image Input and Output (imgcodecs module)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="page_tutorial_table_of_content_imgproc.html">Image Processing (imgproc module)</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_copyMakeBorder.html">Adding borders to your images</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_warp_affine.html">Affine Transformations</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_back_projection.html">Back Projection</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_threshold.html">Basic Thresholding Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_canny_detector.html">Canny Edge Detector</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_hull.html">Convex Hull</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_bounding_rects_circles.html">Creating Bounding boxes and circles for contours</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_bounding_rotated_ellipses.html">Creating Bounding rotated boxes and ellipses for contours</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_erosion_dilatation.html">Eroding and Dilating</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Extract horizontal and vertical lines by using morphological operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_find_contours.html">Finding contours in your image</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_histogram_calculation.html">Histogram Calculation</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_histogram_comparison.html">Histogram Comparison</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_histogram_equalization.html">Histogram Equalization</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_hitOrMiss.html">Hit-or-Miss</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_hough_circle.html">Hough Circle Transform</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_hough_lines.html">Hough Line Transform</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_moments.html">Image Moments</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_pyramids.html">Image Pyramids</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_distance_transform.html">Image Segmentation with Distance Transform and Watershed Algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_laplace_operator.html">Laplace Operator</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_filter_2d.html">Making your own linear filters!</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_opening_closing_hats.html">More Morphology Transformations</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_point_polygon_test.html">Point Polygon Test</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_remap.html">Remapping</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_gausian_median_blur_bilateral_filter.html">Smoothing Images</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_sobel_derivatives.html">Sobel Derivatives</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_template_matching.html">Template Matching</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_threshold_inRange.html">Thresholding Operations using inRange</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_stitching.html">Images stitching (stitching module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_introduction.html">Introduction to OpenCV</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_ml.html">Machine Learning (ml module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_objdetect.html">Object Detection (objdetect module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_viz.html">OpenCV Viz</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_ios.html">OpenCV iOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_core.html">The Core Functionality (core module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_videoio.html">Video Input and Output (videoio module)</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_table_of_content_video.html">Video analysis (video module)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="page_index.html">OpenCV modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_tutorial_py_root.html">OpenCV-Python Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_todo.html">Todo List</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_videoio_overview.html">Video I/O with OpenCV Overview</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="example_contours2.cpp.html">contours2.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_convexhull.cpp.html">convexhull.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_cout_mat.cpp.html">cout_mat.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_demhist.cpp.html">demhist.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_distrans.cpp.html">distrans.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_edge.cpp.html">edge.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_ffilldemo.cpp.html">ffilldemo.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_filestorage.cpp.html">filestorage.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_fitellipse.cpp.html">fitellipse.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_grabcut.cpp.html">grabcut.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_houghcircles.cpp.html">houghcircles.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_houghlines.cpp.html">houghlines.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_kmeans.cpp.html">kmeans.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_laplace.cpp.html">laplace.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_lsd_lines.cpp.html">lsd_lines.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_minarea.cpp.html">minarea.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_morphology2.cpp.html">morphology2.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_pca.cpp.html">pca.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_polar_transforms.cpp.html">polar_transforms.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_segment_objects.cpp.html">segment_objects.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_watershed.cpp.html">watershed.cpp</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="global.html">Global Namespace</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">OpenCV Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="page_tutorial_root.html">OpenCV Tutorials</a> &raquo;</li>
        
          <li><a href="page_tutorial_table_of_content_imgproc.html">Image Processing (imgproc module)</a> &raquo;</li>
        
      <li>Extract horizontal and vertical lines by using morphological operations</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="extract-horizontal-and-vertical-lines-by-using-morphological-operations">
<span id="doxid-d1-dee-tutorial-moprh-lines-detection"></span><span id="index-0"></span><h1>Extract horizontal and vertical lines by using morphological operations</h1>
<p class="rubric">Goal</p>
<p>In this tutorial you will learn how to:</p>
<ul>
<li><p class="first">Apply two very common morphology operators (i.e. Dilation and Erosion), with the creation of custom kernels, in order to extract straight lines on the horizontal and vertical axes. For this purpose, you will use the following OpenCV functions:</p>
<ul class="simple">
<li><a class="reference internal" href="group_imgproc_filter.html#doxid-d4-d86-group-imgproc-filter-1gaeb1e0c1033e3f6b891a25d0511362aeb"><span class="std std-ref">cv::erode</span></a></li>
<li><a class="reference internal" href="group_imgproc_filter.html#doxid-d4-d86-group-imgproc-filter-1ga4ff0f3318642c4f469d0e11f242f3b6c"><span class="std std-ref">cv::dilate</span></a></li>
<li><a class="reference internal" href="group_imgproc_filter.html#doxid-d4-d86-group-imgproc-filter-1gac342a1bb6eabf6f55c803b09268e36dc"><span class="std std-ref">cv::getStructuringElement</span></a></li>
</ul>
<p>in an example where your goal will be to extract the music notes from a music sheet.</p>
</li>
</ul>
<p class="rubric">Theory</p>
<p class="rubric">Morphology Operations</p>
<p>Morphology is a set of image processing operations that process images based on predefined <em>structuring elements</em> known also as kernels. The value of each pixel in the output image is based on a comparison of the corresponding pixel in the input image with its neighbors. By choosing the size and shape of the kernel, you can construct a morphological operation that is sensitive to specific shapes regarding the input image.</p>
<p>Two of the most basic morphological operations are dilation and erosion. Dilation adds pixels to the boundaries of the object in an image, while erosion does exactly the opposite. The amount of pixels added or removed, respectively depends on the size and shape of the structuring element used to process the image. In general the rules followed from these two operations have as follows:</p>
<ul>
<li><p class="first"><strong>Dilation</strong> : The value of the output pixel is the <em>maximum</em> value of all the pixels that fall within the structuring element’s size and shape. For example in a binary image, if any of the pixels of the input image falling within the range of the kernel is set to the value 1, the corresponding pixel of the output image will be set to 1 as well. The latter applies to any type of image (e.g. grayscale, bgr, etc).</p>
<img alt="Dilation on a Binary Image" src="_images/morph21.gif" />
<img alt="Dilation on a Grayscale Image" src="_images/morph6.gif" />
</li>
<li><p class="first"><strong>Erosion</strong> : The vise versa applies for the erosion operation. The value of the output pixel is the <em>minimum</em> value of all the pixels that fall within the structuring element’s size and shape. Look the at the example figures below:</p>
<img alt="Erosion on a Binary Image" src="_images/morph211.png" />
<img alt="Erosion on a Grayscale Image" src="_images/morph61.png" />
<p class="rubric">Structuring Elements</p>
</li>
</ul>
<p>As it can be seen above and in general in any morphological operation the structuring element used to probe the input image, is the most important part.</p>
<p>A structuring element is a matrix consisting of only 0’s and 1’s that can have any arbitrary shape and size. Typically are much smaller than the image being processed, while the pixels with values of 1 define the neighborhood. The center pixel of the structuring element, called the origin, identifies the pixel of interest the pixel being processed.</p>
<p>For example, the following illustrates a diamond-shaped structuring element of 7x7 size.</p>
<img alt="A Diamond-Shaped Structuring Element and its Origin" src="_images/morph12.gif" />
<p>A structuring element can have many common shapes, such as lines, diamonds, disks, periodic lines, and circles and sizes. You typically choose a structuring element the same size and shape as the objects you want to process/extract in the input image. For example, to find lines in an image, create a linear structuring element as you will see later.</p>
<p class="rubric">Code</p>
<p>This tutorial code’s is shown lines below. You can also download it from <a class="reference external" href="https://github.com/opencv/opencv/tree/master/samples/cpp/tutorial_code/ImgProc/Morphology_3.cpp">here</a>.</p>
<pre class="highlight literal-block">
<span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <a class="reference internal" href="namespace_std.html#doxid-d8-dcc-namespacestd"><span class="std std-ref">std</span></a><span></span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <a class="reference internal" href="namespace_cv.html#doxid-d2-d75-namespacecv"><span class="std std-ref">cv</span></a><span></span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Load the image</span>
    <a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat"><span class="std std-ref">Mat</span></a><span></span> <span class="n">src</span> <span class="o">=</span> <a class="reference internal" href="group_imgcodecs.html#doxid-d4-da8-group-imgcodecs-1ga288b8b3da0892bd651fce07b3bbd3a56"><span class="std std-ref">imread</span></a><span></span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

    <span class="c1">// Check if image is loaded fine</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">src</span><span class="p">.</span><a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat-1a4d33bed1c850265370d2af0ff02e1564"><span class="std std-ref">data</span></a><span></span><span class="p">)</span>
        <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Problem loading image!!!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

    <span class="c1">// Show source image</span>
    <a class="reference internal" href="group_highgui.html#doxid-d7-dfc-group-highgui-1ga453d42fe4cb60e5723281a89973ee563"><span class="std std-ref">imshow</span></a><span></span><span class="p">(</span><span class="s">&quot;src&quot;</span><span class="p">,</span> <span class="n">src</span><span class="p">);</span>

    <span class="c1">// Transform source image to gray if it is not</span>
    <a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat"><span class="std std-ref">Mat</span></a><span></span> <span class="n">gray</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">src</span><span class="p">.</span><a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat-1aa11336b9ac538e0475d840657ce164be"><span class="std std-ref">channels</span></a><span></span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
    <span class="p">{</span>
        <a class="reference internal" href="group_imgproc_misc.html#doxid-d7-d1b-group-imgproc-misc-1ga397ae87e1288a81d2363b61574eb8cab"><span class="std std-ref">cvtColor</span></a><span></span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">gray</span><span class="p">,</span> <a class="reference internal" href="group_imgproc_c.html#doxid-df-d4e-group-imgproc-c-1ggaa491173a6b1628f4ff82067b2e1ceaa9a398508a98b3bf25bd1b9307ccba4e7dd"><span class="std std-ref">CV_BGR2GRAY</span></a><span></span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">gray</span> <span class="o">=</span> <span class="n">src</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Show gray image</span>
    <a class="reference internal" href="group_highgui.html#doxid-d7-dfc-group-highgui-1ga453d42fe4cb60e5723281a89973ee563"><span class="std std-ref">imshow</span></a><span></span><span class="p">(</span><span class="s">&quot;gray&quot;</span><span class="p">,</span> <span class="n">gray</span><span class="p">);</span>

    <span class="c1">// Apply adaptiveThreshold at the bitwise_not of gray, notice the ~ symbol</span>
    <a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat"><span class="std std-ref">Mat</span></a><span></span> <span class="n">bw</span><span class="p">;</span>
    <a class="reference internal" href="group_imgproc_misc.html#doxid-d7-d1b-group-imgproc-misc-1ga72b913f352e4a1b1b397736707afcde3"><span class="std std-ref">adaptiveThreshold</span></a><span></span><span class="p">(</span><span class="o">~</span><span class="n">gray</span><span class="p">,</span> <span class="n">bw</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <a class="reference internal" href="group_imgproc_c.html#doxid-df-d4e-group-imgproc-c-1gga0b887f38fa71033f0904f8e2330b6815aa6d8e8df52568c5385e227a16269c278"><span class="std std-ref">CV_ADAPTIVE_THRESH_MEAN_C</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_cv_ThresholdTypes.html#doxid-d7-d1b-group-imgproc-misc-1ggaa9e58d2860d4afa658ef70a9b1115576a147222a96556ebc1d948b372bcd7ac59"><span class="std std-ref">THRESH_BINARY</span></a><span></span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">);</span>

    <span class="c1">// Show binary image</span>
    <a class="reference internal" href="group_highgui.html#doxid-d7-dfc-group-highgui-1ga453d42fe4cb60e5723281a89973ee563"><span class="std std-ref">imshow</span></a><span></span><span class="p">(</span><span class="s">&quot;binary&quot;</span><span class="p">,</span> <span class="n">bw</span><span class="p">);</span>

    <span class="c1">// Create the images that will use to extract the horizontal and vertical lines</span>
    <a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat"><span class="std std-ref">Mat</span></a><span></span> <span class="n">horizontal</span> <span class="o">=</span> <span class="n">bw</span><span class="p">.</span><a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat-1ad1c9cc37d66c4e5bd05fae36f62d1cb4"><span class="std std-ref">clone</span></a><span></span><span class="p">();</span>
    <a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat"><span class="std std-ref">Mat</span></a><span></span> <span class="n">vertical</span> <span class="o">=</span> <span class="n">bw</span><span class="p">.</span><a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat-1ad1c9cc37d66c4e5bd05fae36f62d1cb4"><span class="std std-ref">clone</span></a><span></span><span class="p">();</span>

    <span class="c1">// Specify size on horizontal axis</span>
    <span class="kt">int</span> <span class="n">horizontalsize</span> <span class="o">=</span> <span class="n">horizontal</span><span class="p">.</span><a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat-1aa3e5a47585c9ef6a0842556739155e3e"><span class="std std-ref">cols</span></a><span></span> <span class="o">/</span> <span class="mi">30</span><span class="p">;</span>

    <span class="c1">// Create structure element for extracting horizontal lines through morphology operations</span>
    <a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat"><span class="std std-ref">Mat</span></a><span></span> <span class="n">horizontalStructure</span> <span class="o">=</span> <a class="reference internal" href="group_imgproc_filter.html#doxid-d4-d86-group-imgproc-filter-1gac342a1bb6eabf6f55c803b09268e36dc"><span class="std std-ref">getStructuringElement</span></a><span></span><span class="p">(</span><a class="reference internal" href="enum_cv_MorphShapes.html#doxid-d4-d86-group-imgproc-filter-1ggac2db39b56866583a95a5680313c314ada260c4cbde19a749726763c01a074c60f"><span class="std std-ref">MORPH_RECT</span></a><span></span><span class="p">,</span> <a class="reference internal" href="namespace_cv.html#doxid-dc-d84-group-core-basic-1ga346f563897249351a34549137c8532a0"><span class="std std-ref">Size</span></a><span></span><span class="p">(</span><span class="n">horizontalsize</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>

    <span class="c1">// Apply morphology operations</span>
    <a class="reference internal" href="group_imgproc_filter.html#doxid-d4-d86-group-imgproc-filter-1gaeb1e0c1033e3f6b891a25d0511362aeb"><span class="std std-ref">erode</span></a><span></span><span class="p">(</span><span class="n">horizontal</span><span class="p">,</span> <span class="n">horizontal</span><span class="p">,</span> <span class="n">horizontalStructure</span><span class="p">,</span> <a class="reference internal" href="namespace_cv.html#doxid-dc-d84-group-core-basic-1ga1e83eafb2d26b3c93f09e8338bcab192"><span class="std std-ref">Point</span></a><span></span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>
    <a class="reference internal" href="group_imgproc_filter.html#doxid-d4-d86-group-imgproc-filter-1ga4ff0f3318642c4f469d0e11f242f3b6c"><span class="std std-ref">dilate</span></a><span></span><span class="p">(</span><span class="n">horizontal</span><span class="p">,</span> <span class="n">horizontal</span><span class="p">,</span> <span class="n">horizontalStructure</span><span class="p">,</span> <a class="reference internal" href="namespace_cv.html#doxid-dc-d84-group-core-basic-1ga1e83eafb2d26b3c93f09e8338bcab192"><span class="std std-ref">Point</span></a><span></span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>

    <span class="c1">// Show extracted horizontal lines</span>
    <a class="reference internal" href="group_highgui.html#doxid-d7-dfc-group-highgui-1ga453d42fe4cb60e5723281a89973ee563"><span class="std std-ref">imshow</span></a><span></span><span class="p">(</span><span class="s">&quot;horizontal&quot;</span><span class="p">,</span> <span class="n">horizontal</span><span class="p">);</span>

    <span class="c1">// Specify size on vertical axis</span>
    <span class="kt">int</span> <span class="n">verticalsize</span> <span class="o">=</span> <span class="n">vertical</span><span class="p">.</span><a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat-1abed816466c45234254d25bc59c31245e"><span class="std std-ref">rows</span></a><span></span> <span class="o">/</span> <span class="mi">30</span><span class="p">;</span>

    <span class="c1">// Create structure element for extracting vertical lines through morphology operations</span>
    <a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat"><span class="std std-ref">Mat</span></a><span></span> <span class="n">verticalStructure</span> <span class="o">=</span> <a class="reference internal" href="group_imgproc_filter.html#doxid-d4-d86-group-imgproc-filter-1gac342a1bb6eabf6f55c803b09268e36dc"><span class="std std-ref">getStructuringElement</span></a><span></span><span class="p">(</span><a class="reference internal" href="enum_cv_MorphShapes.html#doxid-d4-d86-group-imgproc-filter-1ggac2db39b56866583a95a5680313c314ada260c4cbde19a749726763c01a074c60f"><span class="std std-ref">MORPH_RECT</span></a><span></span><span class="p">,</span> <a class="reference internal" href="namespace_cv.html#doxid-dc-d84-group-core-basic-1ga346f563897249351a34549137c8532a0"><span class="std std-ref">Size</span></a><span></span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span><span class="n">verticalsize</span><span class="p">));</span>

    <span class="c1">// Apply morphology operations</span>
    <a class="reference internal" href="group_imgproc_filter.html#doxid-d4-d86-group-imgproc-filter-1gaeb1e0c1033e3f6b891a25d0511362aeb"><span class="std std-ref">erode</span></a><span></span><span class="p">(</span><span class="n">vertical</span><span class="p">,</span> <span class="n">vertical</span><span class="p">,</span> <span class="n">verticalStructure</span><span class="p">,</span> <a class="reference internal" href="namespace_cv.html#doxid-dc-d84-group-core-basic-1ga1e83eafb2d26b3c93f09e8338bcab192"><span class="std std-ref">Point</span></a><span></span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>
    <a class="reference internal" href="group_imgproc_filter.html#doxid-d4-d86-group-imgproc-filter-1ga4ff0f3318642c4f469d0e11f242f3b6c"><span class="std std-ref">dilate</span></a><span></span><span class="p">(</span><span class="n">vertical</span><span class="p">,</span> <span class="n">vertical</span><span class="p">,</span> <span class="n">verticalStructure</span><span class="p">,</span> <a class="reference internal" href="namespace_cv.html#doxid-dc-d84-group-core-basic-1ga1e83eafb2d26b3c93f09e8338bcab192"><span class="std std-ref">Point</span></a><span></span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>

    <span class="c1">// Show extracted vertical lines</span>
    <a class="reference internal" href="group_highgui.html#doxid-d7-dfc-group-highgui-1ga453d42fe4cb60e5723281a89973ee563"><span class="std std-ref">imshow</span></a><span></span><span class="p">(</span><span class="s">&quot;vertical&quot;</span><span class="p">,</span> <span class="n">vertical</span><span class="p">);</span>

    <span class="c1">// Inverse vertical image</span>
    <a class="reference internal" href="group_core_array.html#doxid-d2-de8-group-core-array-1ga0002cf8b418479f4cb49a75442baee2f"><span class="std std-ref">bitwise_not</span></a><span></span><span class="p">(</span><span class="n">vertical</span><span class="p">,</span> <span class="n">vertical</span><span class="p">);</span>
    <a class="reference internal" href="group_highgui.html#doxid-d7-dfc-group-highgui-1ga453d42fe4cb60e5723281a89973ee563"><span class="std std-ref">imshow</span></a><span></span><span class="p">(</span><span class="s">&quot;vertical_bit&quot;</span><span class="p">,</span> <span class="n">vertical</span><span class="p">);</span>

    <span class="c1">// Extract edges and smooth image according to the logic</span>
    <span class="c1">// 1. extract edges</span>
    <span class="c1">// 2. dilate(edges)</span>
    <span class="c1">// 3. src.copyTo(smooth)</span>
    <span class="c1">// 4. blur smooth img</span>
    <span class="c1">// 5. smooth.copyTo(src, edges)</span>

    <span class="c1">// Step 1</span>
    <a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat"><span class="std std-ref">Mat</span></a><span></span> <span class="n">edges</span><span class="p">;</span>
    <a class="reference internal" href="group_imgproc_misc.html#doxid-d7-d1b-group-imgproc-misc-1ga72b913f352e4a1b1b397736707afcde3"><span class="std std-ref">adaptiveThreshold</span></a><span></span><span class="p">(</span><span class="n">vertical</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <a class="reference internal" href="group_imgproc_c.html#doxid-df-d4e-group-imgproc-c-1gga0b887f38fa71033f0904f8e2330b6815aa6d8e8df52568c5385e227a16269c278"><span class="std std-ref">CV_ADAPTIVE_THRESH_MEAN_C</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_cv_ThresholdTypes.html#doxid-d7-d1b-group-imgproc-misc-1ggaa9e58d2860d4afa658ef70a9b1115576a147222a96556ebc1d948b372bcd7ac59"><span class="std std-ref">THRESH_BINARY</span></a><span></span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">);</span>
    <a class="reference internal" href="group_highgui.html#doxid-d7-dfc-group-highgui-1ga453d42fe4cb60e5723281a89973ee563"><span class="std std-ref">imshow</span></a><span></span><span class="p">(</span><span class="s">&quot;edges&quot;</span><span class="p">,</span> <span class="n">edges</span><span class="p">);</span>

    <span class="c1">// Step 2</span>
    <a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat"><span class="std std-ref">Mat</span></a><span></span> <span class="n">kernel</span> <span class="o">=</span> <span class="n">Mat</span><span class="o">::</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <a class="reference internal" href="group_core_hal_interface.html#doxid-d1-d1b-group-core-hal-interface-1ga81df635441b21f532fdace401e04f588"><span class="std std-ref">CV_8UC1</span></a><span></span><span class="p">);</span>
    <a class="reference internal" href="group_imgproc_filter.html#doxid-d4-d86-group-imgproc-filter-1ga4ff0f3318642c4f469d0e11f242f3b6c"><span class="std std-ref">dilate</span></a><span></span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">kernel</span><span class="p">);</span>
    <a class="reference internal" href="group_highgui.html#doxid-d7-dfc-group-highgui-1ga453d42fe4cb60e5723281a89973ee563"><span class="std std-ref">imshow</span></a><span></span><span class="p">(</span><span class="s">&quot;dilate&quot;</span><span class="p">,</span> <span class="n">edges</span><span class="p">);</span>

    <span class="c1">// Step 3</span>
    <a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat"><span class="std std-ref">Mat</span></a><span></span> <span class="n">smooth</span><span class="p">;</span>
    <span class="n">vertical</span><span class="p">.</span><a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat-1a33fd5d125b4c302b0c9aa86980791a77"><span class="std std-ref">copyTo</span></a><span></span><span class="p">(</span><span class="n">smooth</span><span class="p">);</span>

    <span class="c1">// Step 4</span>
    <a class="reference internal" href="group_imgproc_filter.html#doxid-d4-d86-group-imgproc-filter-1ga8c45db9afe636703801b0b2e440fce37"><span class="std std-ref">blur</span></a><span></span><span class="p">(</span><span class="n">smooth</span><span class="p">,</span> <span class="n">smooth</span><span class="p">,</span> <a class="reference internal" href="namespace_cv.html#doxid-dc-d84-group-core-basic-1ga346f563897249351a34549137c8532a0"><span class="std std-ref">Size</span></a><span></span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>

    <span class="c1">// Step 5</span>
    <span class="n">smooth</span><span class="p">.</span><a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat-1a33fd5d125b4c302b0c9aa86980791a77"><span class="std std-ref">copyTo</span></a><span></span><span class="p">(</span><span class="n">vertical</span><span class="p">,</span> <span class="n">edges</span><span class="p">);</span>

    <span class="c1">// Show final result</span>
    <a class="reference internal" href="group_highgui.html#doxid-d7-dfc-group-highgui-1ga453d42fe4cb60e5723281a89973ee563"><span class="std std-ref">imshow</span></a><span></span><span class="p">(</span><span class="s">&quot;smooth&quot;</span><span class="p">,</span> <span class="n">vertical</span><span class="p">);</span>

    <a class="reference internal" href="group_highgui.html#doxid-d7-dfc-group-highgui-1ga5628525ad33f52eab17feebcfba38bd7"><span class="std std-ref">waitKey</span></a><span></span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre>
<p class="rubric">Explanation / Result</p>
<ol class="arabic">
<li><p class="first">Load the source image and check if it is loaded without any problem, then show it:</p>
<pre class="highlight literal-block">
<span></span><span class="c1">// Load the image</span>
<span class="n">Mat</span> <span class="n">src</span> <span class="o">=</span> <a class="reference internal" href="group_imgcodecs.html#doxid-d4-da8-group-imgcodecs-1ga288b8b3da0892bd651fce07b3bbd3a56"><span class="std std-ref">imread</span></a><span></span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

<span class="c1">// Check if image is loaded fine</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">src</span><span class="p">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Problem loading image!!!&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>

<span class="c1">// Show source image</span>
<a class="reference internal" href="group_highgui.html#doxid-d7-dfc-group-highgui-1ga453d42fe4cb60e5723281a89973ee563"><span class="std std-ref">imshow</span></a><span></span><span class="p">(</span><span class="s">&quot;src&quot;</span><span class="p">,</span> <span class="n">src</span><span class="p">);</span>
</pre>
<img alt="_images/src.png" src="_images/src.png" />
</li>
<li><p class="first">Then transform image to grayscale if it not already:</p>
<pre class="highlight literal-block">
<span></span><span class="c1">// Transform source image to gray if it is not</span>
<span class="n">Mat</span> <span class="n">gray</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="n">src</span><span class="p">.</span><span class="n">channels</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
<span class="p">{</span>
    <a class="reference internal" href="group_imgproc_misc.html#doxid-d7-d1b-group-imgproc-misc-1ga397ae87e1288a81d2363b61574eb8cab"><span class="std std-ref">cvtColor</span></a><span></span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">gray</span><span class="p">,</span> <a class="reference internal" href="group_imgproc_c.html#doxid-df-d4e-group-imgproc-c-1ggaa491173a6b1628f4ff82067b2e1ceaa9a398508a98b3bf25bd1b9307ccba4e7dd"><span class="std std-ref">CV_BGR2GRAY</span></a><span></span><span class="p">);</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">src</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Show gray image</span>
<a class="reference internal" href="group_highgui.html#doxid-d7-dfc-group-highgui-1ga453d42fe4cb60e5723281a89973ee563"><span class="std std-ref">imshow</span></a><span></span><span class="p">(</span><span class="s">&quot;gray&quot;</span><span class="p">,</span> <span class="n">gray</span><span class="p">);</span>
</pre>
<img alt="_images/gray.png" src="_images/gray.png" />
</li>
<li><p class="first">Afterwards transform grayscale image to binary. Notice the ~ symbol which indicates that we use the inverse (i.e. bitwise_not) version of it:</p>
<pre class="highlight literal-block">
<span></span><span class="c1">// Apply adaptiveThreshold at the bitwise_not of gray, notice the ~ symbol</span>
<span class="n">Mat</span> <span class="n">bw</span><span class="p">;</span>
<a class="reference internal" href="group_imgproc_misc.html#doxid-d7-d1b-group-imgproc-misc-1ga72b913f352e4a1b1b397736707afcde3"><span class="std std-ref">adaptiveThreshold</span></a><span></span><span class="p">(</span><span class="o">~</span><span class="n">gray</span><span class="p">,</span> <span class="n">bw</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <a class="reference internal" href="group_imgproc_c.html#doxid-df-d4e-group-imgproc-c-1gga0b887f38fa71033f0904f8e2330b6815aa6d8e8df52568c5385e227a16269c278"><span class="std std-ref">CV_ADAPTIVE_THRESH_MEAN_C</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_cv_ThresholdTypes.html#doxid-d7-d1b-group-imgproc-misc-1ggaa9e58d2860d4afa658ef70a9b1115576a147222a96556ebc1d948b372bcd7ac59"><span class="std std-ref">THRESH_BINARY</span></a><span></span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">);</span>

<span class="c1">// Show binary image</span>
<a class="reference internal" href="group_highgui.html#doxid-d7-dfc-group-highgui-1ga453d42fe4cb60e5723281a89973ee563"><span class="std std-ref">imshow</span></a><span></span><span class="p">(</span><span class="s">&quot;binary&quot;</span><span class="p">,</span> <span class="n">bw</span><span class="p">);</span>
</pre>
<img alt="_images/binary.png" src="_images/binary.png" />
</li>
<li><p class="first">Now we are ready to apply morphological operations in order to extract the horizontal and vertical lines and as a consequence to separate the the music notes from the music sheet, but first let’s initialize the output images that we will use for that reason:</p>
<pre class="highlight literal-block">
<span></span><span class="c1">// Create the images that will use to extract the horizontal and vertical lines</span>
<span class="n">Mat</span> <span class="n">horizontal</span> <span class="o">=</span> <span class="n">bw</span><span class="p">.</span><a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat-1ad1c9cc37d66c4e5bd05fae36f62d1cb4"><span class="std std-ref">clone</span></a><span></span><span class="p">();</span>
<span class="n">Mat</span> <span class="n">vertical</span> <span class="o">=</span> <span class="n">bw</span><span class="p">.</span><a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat-1ad1c9cc37d66c4e5bd05fae36f62d1cb4"><span class="std std-ref">clone</span></a><span></span><span class="p">();</span>
</pre>
</li>
<li><p class="first">As we specified in the theory in order to extract the object that we desire, we need to create the corresponding structure element. Since here we want to extract the horizontal lines, a corresponding structure element for that purpose will have the following shape:</p>
<img alt="_images/linear_horiz.png" src="_images/linear_horiz.png" />
<p>and in the source code this is represented by the following code snippet:</p>
<pre class="highlight literal-block">
<span></span><span class="c1">// Specify size on horizontal axis</span>
<span class="kt">int</span> <span class="n">horizontalsize</span> <span class="o">=</span> <span class="n">horizontal</span><span class="p">.</span><span class="n">cols</span> <span class="o">/</span> <span class="mi">30</span><span class="p">;</span>

<span class="c1">// Create structure element for extracting horizontal lines through morphology operations</span>
<span class="n">Mat</span> <span class="n">horizontalStructure</span> <span class="o">=</span> <a class="reference internal" href="group_imgproc_filter.html#doxid-d4-d86-group-imgproc-filter-1gac342a1bb6eabf6f55c803b09268e36dc"><span class="std std-ref">getStructuringElement</span></a><span></span><span class="p">(</span><a class="reference internal" href="enum_cv_MorphShapes.html#doxid-d4-d86-group-imgproc-filter-1ggac2db39b56866583a95a5680313c314ada260c4cbde19a749726763c01a074c60f"><span class="std std-ref">MORPH_RECT</span></a><span></span><span class="p">,</span> <a class="reference internal" href="namespace_cv.html#doxid-dc-d84-group-core-basic-1ga346f563897249351a34549137c8532a0"><span class="std std-ref">Size</span></a><span></span><span class="p">(</span><span class="n">horizontalsize</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>

<span class="c1">// Apply morphology operations</span>
<a class="reference internal" href="group_imgproc_filter.html#doxid-d4-d86-group-imgproc-filter-1gaeb1e0c1033e3f6b891a25d0511362aeb"><span class="std std-ref">erode</span></a><span></span><span class="p">(</span><span class="n">horizontal</span><span class="p">,</span> <span class="n">horizontal</span><span class="p">,</span> <span class="n">horizontalStructure</span><span class="p">,</span> <a class="reference internal" href="namespace_cv.html#doxid-dc-d84-group-core-basic-1ga1e83eafb2d26b3c93f09e8338bcab192"><span class="std std-ref">Point</span></a><span></span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>
<a class="reference internal" href="group_imgproc_filter.html#doxid-d4-d86-group-imgproc-filter-1ga4ff0f3318642c4f469d0e11f242f3b6c"><span class="std std-ref">dilate</span></a><span></span><span class="p">(</span><span class="n">horizontal</span><span class="p">,</span> <span class="n">horizontal</span><span class="p">,</span> <span class="n">horizontalStructure</span><span class="p">,</span> <a class="reference internal" href="namespace_cv.html#doxid-dc-d84-group-core-basic-1ga1e83eafb2d26b3c93f09e8338bcab192"><span class="std std-ref">Point</span></a><span></span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>

<span class="c1">// Show extracted horizontal lines</span>
<a class="reference internal" href="group_highgui.html#doxid-d7-dfc-group-highgui-1ga453d42fe4cb60e5723281a89973ee563"><span class="std std-ref">imshow</span></a><span></span><span class="p">(</span><span class="s">&quot;horizontal&quot;</span><span class="p">,</span> <span class="n">horizontal</span><span class="p">);</span>
</pre>
<img alt="_images/horiz.png" src="_images/horiz.png" />
</li>
<li><p class="first">The same applies for the vertical lines, with the corresponding structure element:</p>
<img alt="_images/linear_vert.png" src="_images/linear_vert.png" />
<p>and again this is represented as follows:</p>
<pre class="highlight literal-block">
<span></span><span class="c1">// Specify size on vertical axis</span>
<span class="kt">int</span> <span class="n">verticalsize</span> <span class="o">=</span> <span class="n">vertical</span><span class="p">.</span><span class="n">rows</span> <span class="o">/</span> <span class="mi">30</span><span class="p">;</span>

<span class="c1">// Create structure element for extracting vertical lines through morphology operations</span>
<span class="n">Mat</span> <span class="n">verticalStructure</span> <span class="o">=</span> <a class="reference internal" href="group_imgproc_filter.html#doxid-d4-d86-group-imgproc-filter-1gac342a1bb6eabf6f55c803b09268e36dc"><span class="std std-ref">getStructuringElement</span></a><span></span><span class="p">(</span><a class="reference internal" href="enum_cv_MorphShapes.html#doxid-d4-d86-group-imgproc-filter-1ggac2db39b56866583a95a5680313c314ada260c4cbde19a749726763c01a074c60f"><span class="std std-ref">MORPH_RECT</span></a><span></span><span class="p">,</span> <a class="reference internal" href="namespace_cv.html#doxid-dc-d84-group-core-basic-1ga346f563897249351a34549137c8532a0"><span class="std std-ref">Size</span></a><span></span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span><span class="n">verticalsize</span><span class="p">));</span>

<span class="c1">// Apply morphology operations</span>
<a class="reference internal" href="group_imgproc_filter.html#doxid-d4-d86-group-imgproc-filter-1gaeb1e0c1033e3f6b891a25d0511362aeb"><span class="std std-ref">erode</span></a><span></span><span class="p">(</span><span class="n">vertical</span><span class="p">,</span> <span class="n">vertical</span><span class="p">,</span> <span class="n">verticalStructure</span><span class="p">,</span> <a class="reference internal" href="namespace_cv.html#doxid-dc-d84-group-core-basic-1ga1e83eafb2d26b3c93f09e8338bcab192"><span class="std std-ref">Point</span></a><span></span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>
<a class="reference internal" href="group_imgproc_filter.html#doxid-d4-d86-group-imgproc-filter-1ga4ff0f3318642c4f469d0e11f242f3b6c"><span class="std std-ref">dilate</span></a><span></span><span class="p">(</span><span class="n">vertical</span><span class="p">,</span> <span class="n">vertical</span><span class="p">,</span> <span class="n">verticalStructure</span><span class="p">,</span> <a class="reference internal" href="namespace_cv.html#doxid-dc-d84-group-core-basic-1ga1e83eafb2d26b3c93f09e8338bcab192"><span class="std std-ref">Point</span></a><span></span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>

<span class="c1">// Show extracted vertical lines</span>
<a class="reference internal" href="group_highgui.html#doxid-d7-dfc-group-highgui-1ga453d42fe4cb60e5723281a89973ee563"><span class="std std-ref">imshow</span></a><span></span><span class="p">(</span><span class="s">&quot;vertical&quot;</span><span class="p">,</span> <span class="n">vertical</span><span class="p">);</span>
</pre>
<img alt="_images/vert.png" src="_images/vert.png" />
</li>
<li><p class="first">As you can see we are almost there. However, at that point you will notice that the edges of the notes are a bit rough. For that reason we need to refine the edges in order to obtain a smoother result:</p>
<pre class="highlight literal-block">
<span></span><span class="c1">// Inverse vertical image</span>
<a class="reference internal" href="group_core_array.html#doxid-d2-de8-group-core-array-1ga0002cf8b418479f4cb49a75442baee2f"><span class="std std-ref">bitwise_not</span></a><span></span><span class="p">(</span><span class="n">vertical</span><span class="p">,</span> <span class="n">vertical</span><span class="p">);</span>
<a class="reference internal" href="group_highgui.html#doxid-d7-dfc-group-highgui-1ga453d42fe4cb60e5723281a89973ee563"><span class="std std-ref">imshow</span></a><span></span><span class="p">(</span><span class="s">&quot;vertical_bit&quot;</span><span class="p">,</span> <span class="n">vertical</span><span class="p">);</span>

<span class="c1">// Extract edges and smooth image according to the logic</span>
<span class="c1">// 1. extract edges</span>
<span class="c1">// 2. dilate(edges)</span>
<span class="c1">// 3. src.copyTo(smooth)</span>
<span class="c1">// 4. blur smooth img</span>
<span class="c1">// 5. smooth.copyTo(src, edges)</span>

<span class="c1">// Step 1</span>
<span class="n">Mat</span> <span class="n">edges</span><span class="p">;</span>
<a class="reference internal" href="group_imgproc_misc.html#doxid-d7-d1b-group-imgproc-misc-1ga72b913f352e4a1b1b397736707afcde3"><span class="std std-ref">adaptiveThreshold</span></a><span></span><span class="p">(</span><span class="n">vertical</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <a class="reference internal" href="group_imgproc_c.html#doxid-df-d4e-group-imgproc-c-1gga0b887f38fa71033f0904f8e2330b6815aa6d8e8df52568c5385e227a16269c278"><span class="std std-ref">CV_ADAPTIVE_THRESH_MEAN_C</span></a><span></span><span class="p">,</span> <a class="reference internal" href="enum_cv_ThresholdTypes.html#doxid-d7-d1b-group-imgproc-misc-1ggaa9e58d2860d4afa658ef70a9b1115576a147222a96556ebc1d948b372bcd7ac59"><span class="std std-ref">THRESH_BINARY</span></a><span></span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">);</span>
<a class="reference internal" href="group_highgui.html#doxid-d7-dfc-group-highgui-1ga453d42fe4cb60e5723281a89973ee563"><span class="std std-ref">imshow</span></a><span></span><span class="p">(</span><span class="s">&quot;edges&quot;</span><span class="p">,</span> <span class="n">edges</span><span class="p">);</span>

<span class="c1">// Step 2</span>
<span class="n">Mat</span> <span class="n">kernel</span> <span class="o">=</span> <span class="n">Mat</span><span class="o">::</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <a class="reference internal" href="group_core_hal_interface.html#doxid-d1-d1b-group-core-hal-interface-1ga81df635441b21f532fdace401e04f588"><span class="std std-ref">CV_8UC1</span></a><span></span><span class="p">);</span>
<a class="reference internal" href="group_imgproc_filter.html#doxid-d4-d86-group-imgproc-filter-1ga4ff0f3318642c4f469d0e11f242f3b6c"><span class="std std-ref">dilate</span></a><span></span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">kernel</span><span class="p">);</span>
<a class="reference internal" href="group_highgui.html#doxid-d7-dfc-group-highgui-1ga453d42fe4cb60e5723281a89973ee563"><span class="std std-ref">imshow</span></a><span></span><span class="p">(</span><span class="s">&quot;dilate&quot;</span><span class="p">,</span> <span class="n">edges</span><span class="p">);</span>

<span class="c1">// Step 3</span>
<span class="n">Mat</span> <span class="n">smooth</span><span class="p">;</span>
<span class="n">vertical</span><span class="p">.</span><a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat-1a33fd5d125b4c302b0c9aa86980791a77"><span class="std std-ref">copyTo</span></a><span></span><span class="p">(</span><span class="n">smooth</span><span class="p">);</span>

<span class="c1">// Step 4</span>
<a class="reference internal" href="group_imgproc_filter.html#doxid-d4-d86-group-imgproc-filter-1ga8c45db9afe636703801b0b2e440fce37"><span class="std std-ref">blur</span></a><span></span><span class="p">(</span><span class="n">smooth</span><span class="p">,</span> <span class="n">smooth</span><span class="p">,</span> <a class="reference internal" href="namespace_cv.html#doxid-dc-d84-group-core-basic-1ga346f563897249351a34549137c8532a0"><span class="std std-ref">Size</span></a><span></span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>

<span class="c1">// Step 5</span>
<span class="n">smooth</span><span class="p">.</span><span class="n">copyTo</span><span class="p">(</span><span class="n">vertical</span><span class="p">,</span> <span class="n">edges</span><span class="p">);</span>

<span class="c1">// Show final result</span>
<a class="reference internal" href="group_highgui.html#doxid-d7-dfc-group-highgui-1ga453d42fe4cb60e5723281a89973ee563"><span class="std std-ref">imshow</span></a><span></span><span class="p">(</span><span class="s">&quot;smooth&quot;</span><span class="p">,</span> <span class="n">vertical</span><span class="p">);</span>
</pre>
<img alt="_images/smooth.png" src="_images/smooth.png" />
</li>
</ol>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="page_tutorial_find_contours.html" class="btn btn-neutral float-right" title="Finding contours in your image" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="page_tutorial_erosion_dilatation.html" class="btn btn-neutral float-left" title="Eroding and Dilating" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 1999-2017, OpenCV Maintainers

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>