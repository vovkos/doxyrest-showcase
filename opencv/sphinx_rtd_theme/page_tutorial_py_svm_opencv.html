

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>OCR of Hand-written Data using SVM &mdash; OpenCV Documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="_static/target-highlight.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/doxyrest-pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/doxyrest-sphinx_rtd_theme.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Understanding SVM" href="page_tutorial_py_svm_basics.html" />
    <link rel="prev" title="Support Vector Machines (SVM)" href="page_tutorial_py_svm_index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> OpenCV Documentation
          

          
          </a>

          
            
            
              <div class="version">
                3.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="group_features2d.html">2D Features Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_viz.html">3D Visualizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_calib3d.html">Camera Calibration and 3D Reconstruction</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_flann.html">Clustering and Search in Multi-Dimensional Spaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_photo.html">Computational Photography</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_core.html">Core functionality</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_highgui.html">High-level GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_imgcodecs.html">Image file reading and writing</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_imgproc.html">Image processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_stitching.html">Images stitching</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_ml.html">Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_objdetect.html">Object Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_shape.html">Shape Distance and Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_superres.html">Super Resolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_video.html">Video Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_videoio.html">Video I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="group_videostab.html">Video Stabilization</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="page_citelist.html">Bibliography</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_cuda_intro.html">CUDA Module Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_imgproc_color_conversions.html">Color conversions</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_deprecated.html">Deprecated List</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_ml_intro.html">Machine Learning Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_tutorial_root.html">OpenCV Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_index.html">OpenCV modules</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="page_tutorial_py_root.html">OpenCV-Python Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_py_table_of_contents_calib3d.html">Camera Calibration and 3D Reconstruction</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_py_table_of_contents_photo.html">Computational Photography</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_py_table_of_contents_core.html">Core Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_py_table_of_contents_feature2d.html">Feature Detection and Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_py_table_of_contents_gui.html">Gui Features in OpenCV</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_py_table_of_contents_imgproc.html">Image Processing in OpenCV</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_py_table_of_contents_setup.html">Introduction to OpenCV</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="page_tutorial_py_table_of_contents_ml.html">Machine Learning</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_py_kmeans_index.html">K-Means Clustering</a></li>
<li class="toctree-l3"><a class="reference internal" href="page_tutorial_py_knn_index.html">K-Nearest Neighbour</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="page_tutorial_py_svm_index.html">Support Vector Machines (SVM)</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">OCR of Hand-written Data using SVM</a></li>
<li class="toctree-l4"><a class="reference internal" href="page_tutorial_py_svm_basics.html">Understanding SVM</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_py_table_of_contents_objdetect.html">Object Detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_py_table_of_contents_bindings.html">OpenCV-Python Bindings</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_tutorial_py_table_of_contents_video.html">Video Analysis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="page_todo.html">Todo List</a></li>
<li class="toctree-l1"><a class="reference internal" href="page_videoio_overview.html">Video I/O with OpenCV Overview</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="example_contours2.cpp.html">contours2.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_convexhull.cpp.html">convexhull.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_cout_mat.cpp.html">cout_mat.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_demhist.cpp.html">demhist.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_distrans.cpp.html">distrans.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_edge.cpp.html">edge.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_ffilldemo.cpp.html">ffilldemo.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_filestorage.cpp.html">filestorage.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_fitellipse.cpp.html">fitellipse.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_grabcut.cpp.html">grabcut.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_houghcircles.cpp.html">houghcircles.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_houghlines.cpp.html">houghlines.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_kmeans.cpp.html">kmeans.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_laplace.cpp.html">laplace.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_lsd_lines.cpp.html">lsd_lines.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_minarea.cpp.html">minarea.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_morphology2.cpp.html">morphology2.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_pca.cpp.html">pca.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_polar_transforms.cpp.html">polar_transforms.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_segment_objects.cpp.html">segment_objects.cpp</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_watershed.cpp.html">watershed.cpp</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="global.html">Global Namespace</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">OpenCV Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="page_tutorial_py_root.html">OpenCV-Python Tutorials</a> &raquo;</li>
        
          <li><a href="page_tutorial_py_table_of_contents_ml.html">Machine Learning</a> &raquo;</li>
        
          <li><a href="page_tutorial_py_svm_index.html">Support Vector Machines (SVM)</a> &raquo;</li>
        
      <li>OCR of Hand-written Data using SVM</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ocr-of-hand-written-data-using-svm">
<span id="doxid-dd-d3b-tutorial-py-svm-opencv"></span><span id="index-0"></span><h1>OCR of Hand-written Data using SVM</h1>
<p class="rubric">Goal</p>
<p>In this chapter</p>
<ul class="simple">
<li>We will revisit the hand-written data OCR, but, with SVM instead of kNN.</li>
</ul>
<p class="rubric">OCR of Hand-written Digits</p>
<p>In kNN, we directly used pixel intensity as the feature vector. This time we will use <a class="reference external" href="http://en.wikipedia.org/wiki/Histogram_of_oriented_gradients">Histogram of Oriented Gradients</a> (HOG) as feature vectors.</p>
<p>Here, before finding the HOG, we deskew the image using its second order moments. So we first define a function <strong>deskew()</strong> which takes a digit image and deskew it. Below is the deskew() function:</p>
<pre class="highlight literal-block">
<span></span><span class="n">def</span> <span class="n">deskew</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">:</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">moments</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="k">if</span> <a class="reference internal" href="class_cv_MatExpr.html#doxid-d9-ddc-classcv-1-1-mat-expr-1a30843fc6c148a00f5d300a7f43f3fbdc"><span class="std std-ref">abs</span></a><span></span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="sc">&#39;mu02&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">1e-2</span><span class="o">:</span>
        <span class="k">return</span> <span class="n">img</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">skew</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="sc">&#39;mu11&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">m</span><span class="p">[</span><span class="sc">&#39;mu02&#39;</span><span class="p">]</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="n">skew</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">SZ</span><span class="o">*</span><span class="n">skew</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">warpAffine</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">M</span><span class="p">,(</span><span class="n">SZ</span><span class="p">,</span> <span class="n">SZ</span><span class="p">),</span><span class="n">flags</span><span class="o">=</span><span class="n">affine_flags</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img</span>
</pre>
<p>Below image shows above deskew function applied to an image of zero. Left image is the original image and right image is the deskewed image.</p>
<img alt="image" src="_images/deskew.jpg" />
<p>Next we have to find the HOG Descriptor of each cell. For that, we find Sobel derivatives of each cell in X and Y direction. Then find their magnitude and direction of gradient at each pixel. This gradient is quantized to 16 integer values. Divide this image to four sub-squares. For each sub-square, calculate the histogram of direction (16 bins) weighted with their magnitude. So each sub-square gives you a vector containing 16 values. Four such vectors (of four sub-squares) together gives us a feature vector containing 64 values. This is the feature vector we use to train our data.</p>
<pre class="highlight literal-block">
<span></span><span class="n">def</span> <span class="n">hog</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">:</span>
    <span class="n">gx</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">Sobel</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">CV_32F</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">gy</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">Sobel</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">CV_32F</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">mag</span><span class="p">,</span> <span class="n">ang</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">cartToPolar</span><span class="p">(</span><span class="n">gx</span><span class="p">,</span> <span class="n">gy</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">int32</span><span class="p">(</span><span class="n">bin_n</span><span class="o">*</span><span class="n">ang</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">))</span>    <span class="err">#</span> <span class="n">quantizing</span> <span class="n">binvalues</span> <span class="n">in</span> <span class="p">(</span><span class="mf">0.</span><span class="p">.</span><span class="mf">.16</span><span class="p">)</span>
    <span class="n">bin_cells</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="o">:</span><span class="mi">10</span><span class="p">,</span><span class="o">:</span><span class="mi">10</span><span class="p">],</span> <span class="n">bins</span><span class="p">[</span><span class="mi">10</span><span class="o">:</span><span class="p">,</span><span class="o">:</span><span class="mi">10</span><span class="p">],</span> <span class="n">bins</span><span class="p">[</span><span class="o">:</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="o">:</span><span class="p">],</span> <span class="n">bins</span><span class="p">[</span><span class="mi">10</span><span class="o">:</span><span class="p">,</span><span class="mi">10</span><span class="o">:</span><span class="p">]</span>
    <span class="n">mag_cells</span> <span class="o">=</span> <span class="n">mag</span><span class="p">[</span><span class="o">:</span><span class="mi">10</span><span class="p">,</span><span class="o">:</span><span class="mi">10</span><span class="p">],</span> <span class="n">mag</span><span class="p">[</span><span class="mi">10</span><span class="o">:</span><span class="p">,</span><span class="o">:</span><span class="mi">10</span><span class="p">],</span> <span class="n">mag</span><span class="p">[</span><span class="o">:</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="o">:</span><span class="p">],</span> <span class="n">mag</span><span class="p">[</span><span class="mi">10</span><span class="o">:</span><span class="p">,</span><span class="mi">10</span><span class="o">:</span><span class="p">]</span>
    <span class="n">hists</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">m</span><span class="p">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bin_n</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span><span class="p">,</span> <span class="n">m</span> <span class="n">in</span> <span class="n">zip</span><span class="p">(</span><span class="n">bin_cells</span><span class="p">,</span> <span class="n">mag_cells</span><span class="p">)]</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">hists</span><span class="p">)</span>     <span class="err">#</span> <span class="n">hist</span> <span class="n">is</span> <span class="n">a</span> <span class="mi">64</span> <span class="n">bit</span> <span class="n">vector</span>
    <span class="k">return</span> <span class="n">hist</span>
</pre>
<p>Finally, as in the previous case, we start by splitting our big dataset into individual cells. For every digit, 250 cells are reserved for training data and remaining 250 data is reserved for testing. Full code is given below, you also can download it from <a class="reference external" href="https://github.com/opencv/opencv/tree/master/samples/python/tutorial_code/ml/py_svm_opencv/hogsvm.py">here</a> :</p>
<pre class="highlight literal-block">
<span></span><span class="n">import</span> <span class="n">cv2</span>
<span class="n">import</span> <span class="n">numpy</span> <span class="n">as</span> <span class="n">np</span>

<span class="n">SZ</span><span class="o">=</span><span class="mi">20</span>
<span class="n">bin_n</span> <span class="o">=</span> <span class="mi">16</span> <span class="err">#</span> <span class="n">Number</span> <span class="n">of</span> <span class="n">bins</span>


<span class="n">affine_flags</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">WARP_INVERSE_MAP</span><span class="o">|</span><span class="n">cv2</span><span class="p">.</span><span class="n">INTER_LINEAR</span>


<span class="n">def</span> <span class="n">deskew</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">:</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">moments</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="k">if</span> <a class="reference internal" href="class_cv_MatExpr.html#doxid-d9-ddc-classcv-1-1-mat-expr-1a30843fc6c148a00f5d300a7f43f3fbdc"><span class="std std-ref">abs</span></a><span></span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="sc">&#39;mu02&#39;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">1e-2</span><span class="o">:</span>
        <span class="k">return</span> <span class="n">img</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">skew</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="sc">&#39;mu11&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">m</span><span class="p">[</span><span class="sc">&#39;mu02&#39;</span><span class="p">]</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="n">skew</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">SZ</span><span class="o">*</span><span class="n">skew</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">warpAffine</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">M</span><span class="p">,(</span><span class="n">SZ</span><span class="p">,</span> <span class="n">SZ</span><span class="p">),</span><span class="n">flags</span><span class="o">=</span><span class="n">affine_flags</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img</span>



<span class="n">def</span> <span class="n">hog</span><span class="p">(</span><span class="n">img</span><span class="p">)</span><span class="o">:</span>
    <span class="n">gx</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">Sobel</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">CV_32F</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">gy</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">Sobel</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">CV_32F</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">mag</span><span class="p">,</span> <span class="n">ang</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">cartToPolar</span><span class="p">(</span><span class="n">gx</span><span class="p">,</span> <span class="n">gy</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">int32</span><span class="p">(</span><span class="n">bin_n</span><span class="o">*</span><span class="n">ang</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">))</span>    <span class="err">#</span> <span class="n">quantizing</span> <span class="n">binvalues</span> <span class="n">in</span> <span class="p">(</span><span class="mf">0.</span><span class="p">.</span><span class="mf">.16</span><span class="p">)</span>
    <span class="n">bin_cells</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="o">:</span><span class="mi">10</span><span class="p">,</span><span class="o">:</span><span class="mi">10</span><span class="p">],</span> <span class="n">bins</span><span class="p">[</span><span class="mi">10</span><span class="o">:</span><span class="p">,</span><span class="o">:</span><span class="mi">10</span><span class="p">],</span> <span class="n">bins</span><span class="p">[</span><span class="o">:</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="o">:</span><span class="p">],</span> <span class="n">bins</span><span class="p">[</span><span class="mi">10</span><span class="o">:</span><span class="p">,</span><span class="mi">10</span><span class="o">:</span><span class="p">]</span>
    <span class="n">mag_cells</span> <span class="o">=</span> <span class="n">mag</span><span class="p">[</span><span class="o">:</span><span class="mi">10</span><span class="p">,</span><span class="o">:</span><span class="mi">10</span><span class="p">],</span> <span class="n">mag</span><span class="p">[</span><span class="mi">10</span><span class="o">:</span><span class="p">,</span><span class="o">:</span><span class="mi">10</span><span class="p">],</span> <span class="n">mag</span><span class="p">[</span><span class="o">:</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="o">:</span><span class="p">],</span> <span class="n">mag</span><span class="p">[</span><span class="mi">10</span><span class="o">:</span><span class="p">,</span><span class="mi">10</span><span class="o">:</span><span class="p">]</span>
    <span class="n">hists</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">m</span><span class="p">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bin_n</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span><span class="p">,</span> <span class="n">m</span> <span class="n">in</span> <span class="n">zip</span><span class="p">(</span><span class="n">bin_cells</span><span class="p">,</span> <span class="n">mag_cells</span><span class="p">)]</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">hists</span><span class="p">)</span>     <span class="err">#</span> <span class="n">hist</span> <span class="n">is</span> <span class="n">a</span> <span class="mi">64</span> <span class="n">bit</span> <span class="n">vector</span>
    <span class="k">return</span> <span class="n">hist</span>


<span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">imread</span><span class="p">(</span><span class="sc">&#39;digits.png&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="k">if</span> <span class="n">img</span> <span class="n">is</span> <span class="nl">None</span><span class="p">:</span>
    <span class="n">raise</span> <span class="n">Exception</span><span class="p">(</span><span class="s">&quot;we need the digits.png image from samples/data here !&quot;</span><span class="p">)</span>


<span class="n">cells</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">hsplit</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="n">in</span> <span class="n">np</span><span class="p">.</span><span class="n">vsplit</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="mi">50</span><span class="p">)]</span>

<span class="cp"># First half is trainData, remaining is testData</span>
<span class="n">train_cells</span> <span class="o">=</span> <span class="p">[</span> <span class="n">i</span><span class="p">[</span><span class="o">:</span><span class="mi">50</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="n">cells</span> <span class="p">]</span>
<span class="n">test_cells</span> <span class="o">=</span> <span class="p">[</span> <span class="n">i</span><span class="p">[</span><span class="mi">50</span><span class="o">:</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="n">cells</span><span class="p">]</span>



<span class="n">deskewed</span> <span class="o">=</span> <span class="p">[</span><span class="n">map</span><span class="p">(</span><span class="n">deskew</span><span class="p">,</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="n">in</span> <span class="n">train_cells</span><span class="p">]</span>
<span class="n">hogdata</span> <span class="o">=</span> <span class="p">[</span><span class="n">map</span><span class="p">(</span><span class="n">hog</span><span class="p">,</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="n">in</span> <span class="n">deskewed</span><span class="p">]</span>
<span class="n">trainData</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">(</span><span class="n">hogdata</span><span class="p">).</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">64</span><span class="p">)</span>
<span class="n">responses</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="mi">250</span><span class="p">)[</span><span class="o">:</span><span class="p">,</span><span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">]</span>

<span class="n">svm</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="n">ml</span><span class="p">.</span><span class="n">SVM_create</span><span class="p">()</span>
<span class="n">svm</span><span class="p">.</span><span class="n">setKernel</span><span class="p">(</span><span class="n">cv2</span><span class="p">.</span><span class="n">ml</span><span class="p">.</span><span class="n">SVM_LINEAR</span><span class="p">)</span>
<span class="n">svm</span><span class="p">.</span><span class="n">setType</span><span class="p">(</span><span class="n">cv2</span><span class="p">.</span><span class="n">ml</span><span class="p">.</span><span class="n">SVM_C_SVC</span><span class="p">)</span>
<span class="n">svm</span><span class="p">.</span><span class="n">setC</span><span class="p">(</span><span class="mf">2.67</span><span class="p">)</span>
<span class="n">svm</span><span class="p">.</span><span class="n">setGamma</span><span class="p">(</span><span class="mf">5.383</span><span class="p">)</span>

<span class="n">svm</span><span class="p">.</span><span class="n">train</span><span class="p">(</span><span class="n">trainData</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">ml</span><span class="p">.</span><span class="n">ROW_SAMPLE</span><span class="p">,</span> <span class="n">responses</span><span class="p">)</span>
<span class="n">svm</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="sc">&#39;svm_data.dat&#39;</span><span class="p">)</span>



<span class="n">deskewed</span> <span class="o">=</span> <span class="p">[</span><span class="n">map</span><span class="p">(</span><span class="n">deskew</span><span class="p">,</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="n">in</span> <span class="n">test_cells</span><span class="p">]</span>
<span class="n">hogdata</span> <span class="o">=</span> <span class="p">[</span><span class="n">map</span><span class="p">(</span><span class="n">hog</span><span class="p">,</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="n">in</span> <span class="n">deskewed</span><span class="p">]</span>
<span class="n">testData</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">float32</span><span class="p">(</span><span class="n">hogdata</span><span class="p">).</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">bin_n</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">svm</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">testData</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>


<span class="n">mask</span> <span class="o">=</span> <span class="n">result</span><span class="o">==</span><span class="n">responses</span>
<span class="n">correct</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
<span class="n">print</span> <span class="n">correct</span><span class="o">*</span><span class="mf">100.0</span><span class="o">/</span><span class="n">result</span><span class="p">.</span><span class="n">size</span>
</pre>
<p>This particular technique gave me nearly 94% accuracy. You can try different values for various parameters of SVM to check if higher accuracy is possible. Or you can read technical papers on this area and try to implement them.</p>
<p class="rubric">Additional Resources</p>
<ol class="arabic simple">
<li><a class="reference external" href="www.youtube.com/watch?v=0Zib1YEE4LU‎">Histograms of Oriented Gradients Video</a></li>
</ol>
<p class="rubric">Exercises</p>
<ol class="arabic simple">
<li>OpenCV samples contain digits.py which applies a slight improvement of the above method to get improved result. It also contains the reference. Check it and understand it.</li>
</ol>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="page_tutorial_py_svm_basics.html" class="btn btn-neutral float-right" title="Understanding SVM" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="page_tutorial_py_svm_index.html" class="btn btn-neutral float-left" title="Support Vector Machines (SVM)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 1999-2017, OpenCV Maintainers

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>