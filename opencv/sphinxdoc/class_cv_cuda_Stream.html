
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>class cv::cuda::Stream &#8212; OpenCV Documentation</title>
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/doxyrest-pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/doxyrest-sphinxdoc.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script type="text/javascript" src="_static/target-highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Initalization and Information" href="group_cudacore_init.html" />
    <link rel="prev" title="enum cv::cuda::HostMem::AllocType" href="enum_cv_cuda_HostMem_AllocType.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="group_cudacore_init.html" title="Initalization and Information"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="enum_cv_cuda_HostMem_AllocType.html" title="enum cv::cuda::HostMem::AllocType"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">OpenCV Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="group_core.html" >Core functionality</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="group_core_opengl.html" >OpenGL interoperability</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="group_cuda.html" >CUDA-accelerated Computer Vision</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="group_cudacore.html" >Core part</a> &#187;</li>
          <li class="nav-item nav-item-5"><a href="group_cudacore_struct.html" accesskey="U">Data Structures</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">class cv::cuda::Stream</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#detailed-documentation">Detailed Documentation</a><ul>
<li><a class="reference internal" href="#construction">Construction</a></li>
<li><a class="reference internal" href="#methods">Methods</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="enum_cv_cuda_HostMem_AllocType.html"
                        title="previous chapter">enum cv::cuda::HostMem::AllocType</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="group_cudacore_init.html"
                        title="next chapter">Initalization and Information</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="class-cv-cuda-stream">
<span id="doxid-d1-d04-classcv-1-1cuda-1-1-stream"></span><span id="index-0"></span><h1>class cv::cuda::Stream</h1>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="overview">
<h2>Overview</h2>
<p>This class encapsulates a queue of asynchronous calls. <a class="reference internal" href="#details-d1-d04-classcv-1-1cuda-1-1-stream"><span class="std std-ref">Moreâ€¦</span></a></p>
<pre class="highlight doxyrest-overview-code-block literal-block">
<span></span><span class="cp">#include</span> <span class="cpf">&lt;cuda.hpp&gt;</span><span class="cp"></span>

<span class="k">class</span> <span class="n">Stream</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="c1">// typedefs</span>

    <span class="k">typedef</span> <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="doxyrest-code-target target" id="doxid-d1-d04-classcv-1-1cuda-1-1-stream-1a9a27b645eaf4c8bf8c73dd7125712b13">StreamCallback</span><span></span><span class="p">)(</span>
        <span class="kt">int</span> <span class="n">status</span><span class="p">,</span>
        <span class="kt">void</span> <span class="o">*</span><span class="n">userData</span>
        <span class="p">);</span>

    <span class="c1">// construction</span>

    <a class="reference internal" href="#doxid-d1-d04-classcv-1-1cuda-1-1-stream-1aa6434e2f5f29bd81406732b39951c246"><span class="std std-ref">Stream</span></a><span></span><span class="p">();</span>
    <a class="reference internal" href="#doxid-d1-d04-classcv-1-1cuda-1-1-stream-1a3da3061ab4b0c737fcb092494b54cec8"><span class="std std-ref">Stream</span></a><span></span><span class="p">(</span><span class="k">const</span> <a class="reference internal" href="struct_cv_Ptr.html#doxid-d2-d56-structcv-1-1-ptr"><span class="std std-ref">Ptr</span></a><span></span><span class="o">&lt;</span><a class="reference internal" href="class_cv_cuda_GpuMat_Allocator.html#doxid-d0-dbb-classcv-1-1cuda-1-1-gpu-mat-1-1-allocator"><span class="std std-ref">GpuMat::Allocator</span></a><span></span><span class="o">&gt;&amp;</span> <span class="n">allocator</span><span class="p">);</span>

    <span class="c1">// methods</span>

    <span class="kt">void</span>
    <a class="reference internal" href="#doxid-d1-d04-classcv-1-1cuda-1-1-stream-1aaad28e33e26b9c19c8d0c87c1d6f733d"><span class="std std-ref">enqueueHostCallback</span></a><span></span><span class="p">(</span>
        <a class="reference internal" href="#doxid-d1-d04-classcv-1-1cuda-1-1-stream-1a9a27b645eaf4c8bf8c73dd7125712b13"><span class="std std-ref">StreamCallback</span></a><span></span> <span class="n">callback</span><span class="p">,</span>
        <span class="kt">void</span><span class="o">*</span> <span class="n">userData</span>
        <span class="p">);</span>

    <a class="reference internal" href="#doxid-d1-d04-classcv-1-1cuda-1-1-stream-1a056a9195ab28d22a0278b092901a2ced"><span class="std std-ref">operator bool_type</span></a><span></span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>

    <span class="kt">bool</span>
    <a class="reference internal" href="#doxid-d1-d04-classcv-1-1cuda-1-1-stream-1a9fab618395d42fa31987506e42fab1b4"><span class="std std-ref">queryIfComplete</span></a><span></span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>

    <span class="kt">void</span>
    <a class="reference internal" href="#doxid-d1-d04-classcv-1-1cuda-1-1-stream-1a9e8a713f312a15ba00702d6f46867987"><span class="std std-ref">waitEvent</span></a><span></span><span class="p">(</span><span class="k">const</span> <a class="reference internal" href="class_cv_cuda_Event.html#doxid-d6-d04-classcv-1-1cuda-1-1-event"><span class="std std-ref">Event</span></a><span></span><span class="o">&amp;</span> <span class="n">event</span><span class="p">);</span>

    <span class="kt">void</span>
    <a class="reference internal" href="#doxid-d1-d04-classcv-1-1cuda-1-1-stream-1a0e1d939503e8faad741ab584b720bca6"><span class="std std-ref">waitForCompletion</span></a><span></span><span class="p">();</span>

    <span class="k">static</span>
    <span class="n">Stream</span><span class="o">&amp;</span>
    <a class="reference internal" href="#doxid-d1-d04-classcv-1-1cuda-1-1-stream-1a680af5adfeeb1cdaa5b7b13f680c0131"><span class="std std-ref">Null</span></a><span></span><span class="p">();</span>
<span class="p">};</span>
</pre>
</div>
<div class="section" id="detailed-documentation">
<span id="details-d1-d04-classcv-1-1cuda-1-1-stream"></span><h2>Detailed Documentation</h2>
<p>This class encapsulates a queue of asynchronous calls.</p>
<p>Currently, you may face problems if an operation is enqueued twice with different data. Some functions use the constant GPU memory, and next call may update the memory before the previous one has been finished. But calling different operations asynchronously is safe because each operation has its own constant buffer. Memory copy/upload/download/set operations to the buffers you hold are also safe.</p>
<p>The <a class="reference internal" href="#doxid-d1-d04-classcv-1-1cuda-1-1-stream"><span class="std std-ref">Stream</span></a> class is not thread-safe. Please use different <a class="reference internal" href="#doxid-d1-d04-classcv-1-1cuda-1-1-stream"><span class="std std-ref">Stream</span></a> objects for different CPU threads.</p>
<pre class="highlight literal-block">
<span></span><span class="kt">void</span> <span class="nf">thread1</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">cuda</span><span class="o">::</span><span class="n">Stream</span> <span class="n">stream1</span><span class="p">;</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">cuda</span><span class="o">::</span><span class="n">func1</span><span class="p">(...,</span> <span class="n">stream1</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">thread2</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">cuda</span><span class="o">::</span><span class="n">Stream</span> <span class="n">stream2</span><span class="p">;</span>
    <span class="n">cv</span><span class="o">::</span><span class="n">cuda</span><span class="o">::</span><span class="n">func2</span><span class="p">(...,</span> <span class="n">stream2</span><span class="p">);</span>
<span class="p">}</span>
</pre>
<p>By default all CUDA routines are launched in <a class="reference internal" href="#doxid-d1-d04-classcv-1-1cuda-1-1-stream-1a680af5adfeeb1cdaa5b7b13f680c0131"><span class="std std-ref">Stream::Null()</span></a> object, if the stream is not specified by user. In multi-threading environment the stream objects must be passed explicitly (see previous note).</p>
<div class="section" id="construction">
<h3>Construction</h3>
<pre class="highlight doxyrest-title-code-block literal-block" id="doxid-d1-d04-classcv-1-1cuda-1-1-stream-1aa6434e2f5f29bd81406732b39951c246">
<span id="index-1"></span><span></span><span class="n">Stream</span><span class="p">()</span>
</pre>
<p>creates a new asynchronous stream</p>
<pre class="highlight doxyrest-title-code-block literal-block" id="doxid-d1-d04-classcv-1-1cuda-1-1-stream-1a3da3061ab4b0c737fcb092494b54cec8">
<span id="index-2"></span><span></span><span class="n">Stream</span><span class="p">(</span><span class="k">const</span> <a class="reference internal" href="struct_cv_Ptr.html#doxid-d2-d56-structcv-1-1-ptr"><span class="std std-ref">Ptr</span></a><span></span><span class="o">&lt;</span><a class="reference internal" href="class_cv_cuda_GpuMat_Allocator.html#doxid-d0-dbb-classcv-1-1cuda-1-1-gpu-mat-1-1-allocator"><span class="std std-ref">GpuMat::Allocator</span></a><span></span><span class="o">&gt;&amp;</span> <span class="n">allocator</span><span class="p">)</span>
</pre>
<p>creates a new asynchronous stream with custom allocator</p>
</div>
<div class="section" id="methods">
<h3>Methods</h3>
<pre class="highlight doxyrest-title-code-block literal-block" id="doxid-d1-d04-classcv-1-1cuda-1-1-stream-1aaad28e33e26b9c19c8d0c87c1d6f733d">
<span id="index-3"></span><span></span><span class="kt">void</span>
<span class="n">enqueueHostCallback</span><span class="p">(</span>
    <a class="reference internal" href="#doxid-d1-d04-classcv-1-1cuda-1-1-stream-1a9a27b645eaf4c8bf8c73dd7125712b13"><span class="std std-ref">StreamCallback</span></a><span></span> <span class="n">callback</span><span class="p">,</span>
    <span class="kt">void</span><span class="o">*</span> <span class="n">userData</span>
    <span class="p">)</span>
</pre>
<p>Adds a callback to be called on the host after all currently enqueued items in the stream have completed.</p>
<p>Callbacks must not make any CUDA API calls. Callbacks must not perform any synchronization that may depend on outstanding device work or other callbacks that are not mandated to run earlier. Callbacks without a mandated order (in independent streams) execute in undefined order and may be serialized.</p>
<pre class="highlight doxyrest-title-code-block literal-block" id="doxid-d1-d04-classcv-1-1cuda-1-1-stream-1a056a9195ab28d22a0278b092901a2ced">
<span id="index-4"></span><span></span><span class="k">operator</span> <span class="n">bool_type</span><span class="p">()</span> <span class="k">const</span>
</pre>
<p>returns true if stream object is not default (!= 0)</p>
<pre class="highlight doxyrest-title-code-block literal-block" id="doxid-d1-d04-classcv-1-1cuda-1-1-stream-1a9fab618395d42fa31987506e42fab1b4">
<span id="index-5"></span><span></span><span class="kt">bool</span>
<span class="n">queryIfComplete</span><span class="p">()</span> <span class="k">const</span>
</pre>
<p>Returns true if the current stream queue is finished. Otherwise, it returns false.</p>
<pre class="highlight doxyrest-title-code-block literal-block" id="doxid-d1-d04-classcv-1-1cuda-1-1-stream-1a9e8a713f312a15ba00702d6f46867987">
<span id="index-6"></span><span></span><span class="kt">void</span>
<span class="n">waitEvent</span><span class="p">(</span><span class="k">const</span> <a class="reference internal" href="class_cv_cuda_Event.html#doxid-d6-d04-classcv-1-1cuda-1-1-event"><span class="std std-ref">Event</span></a><span></span><span class="o">&amp;</span> <span class="n">event</span><span class="p">)</span>
</pre>
<p>Makes a compute stream wait on an event.</p>
<pre class="highlight doxyrest-title-code-block literal-block" id="doxid-d1-d04-classcv-1-1cuda-1-1-stream-1a0e1d939503e8faad741ab584b720bca6">
<span id="index-7"></span><span></span><span class="kt">void</span>
<span class="n">waitForCompletion</span><span class="p">()</span>
</pre>
<p>Blocks the current CPU thread until all operations in the stream are complete.</p>
<pre class="highlight doxyrest-title-code-block literal-block" id="doxid-d1-d04-classcv-1-1cuda-1-1-stream-1a680af5adfeeb1cdaa5b7b13f680c0131">
<span id="index-8"></span><span></span><span class="k">static</span>
<span class="n">Stream</span><span class="o">&amp;</span>
<span class="n">Null</span><span class="p">()</span>
</pre>
<p>return <a class="reference internal" href="#doxid-d1-d04-classcv-1-1cuda-1-1-stream"><span class="std std-ref">Stream</span></a> object for default CUDA stream</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="group_cudacore_init.html" title="Initalization and Information"
             >next</a> |</li>
        <li class="right" >
          <a href="enum_cv_cuda_HostMem_AllocType.html" title="enum cv::cuda::HostMem::AllocType"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">OpenCV Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="group_core.html" >Core functionality</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="group_core_opengl.html" >OpenGL interoperability</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="group_cuda.html" >CUDA-accelerated Computer Vision</a> &#187;</li>
          <li class="nav-item nav-item-4"><a href="group_cudacore.html" >Core part</a> &#187;</li>
          <li class="nav-item nav-item-5"><a href="group_cudacore_struct.html" >Data Structures</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 1999-2017, OpenCV Maintainers.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>