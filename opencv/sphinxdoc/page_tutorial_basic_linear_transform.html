
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Changing the contrast and brightness of an image! &#8212; OpenCV Documentation</title>
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/doxyrest-pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/doxyrest-sphinxdoc.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script type="text/javascript" src="_static/target-highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Discrete Fourier Transform" href="page_tutorial_discrete_fourier_transform.html" />
    <link rel="prev" title="Basic Drawing" href="page_tutorial_basic_geometric_drawing.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="page_tutorial_discrete_fourier_transform.html" title="Discrete Fourier Transform"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="page_tutorial_basic_geometric_drawing.html" title="Basic Drawing"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">OpenCV Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="page_tutorial_root.html" >OpenCV Tutorials</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="page_tutorial_table_of_content_core.html" accesskey="U">The Core Functionality (core module)</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="page_tutorial_basic_geometric_drawing.html"
                        title="previous chapter">Basic Drawing</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="page_tutorial_discrete_fourier_transform.html"
                        title="next chapter">Discrete Fourier Transform</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="changing-the-contrast-and-brightness-of-an-image">
<span id="doxid-d3-dc1-tutorial-basic-linear-transform"></span><span id="index-0"></span><h1>Changing the contrast and brightness of an image!</h1>
<p class="rubric">Goal</p>
<p>In this tutorial you will learn how to:</p>
<ul class="simple">
<li>Access pixel values</li>
<li>Initialize a matrix with zeros</li>
<li>Learn what <a class="reference internal" href="group_core_utils.html#doxid-db-de0-group-core-utils-1gab93126370b85fda2c8bfaf8c811faeaf"><span class="std std-ref">cv::saturate_cast</span></a> does and why it is useful</li>
<li>Get some cool info about pixel transformations</li>
<li>Improve the brightness of an image on a practical example</li>
</ul>
<p class="rubric">Theory</p>
<p>The explanation below belongs to the book <a class="reference external" href="http://szeliski.org/Book/">Computer Vision: Algorithms and Applications</a> by Richard Szeliski</p>
<p class="rubric">Image Processing</p>
<ul class="simple">
<li>A general image processing operator is a function that takes one or more input images and produces an output image.</li>
<li>Image transforms can be seen as:<ul>
<li>Point operators (pixel transforms)</li>
<li>Neighborhood (area-based) operators</li>
</ul>
</li>
</ul>
<p class="rubric">Pixel Transforms</p>
<ul class="simple">
<li>In this kind of image processing transform, each output pixelâ€™s value depends on only the corresponding input pixel value (plus, potentially, some globally collected information or parameters).</li>
<li>Examples of such operators include <em>brightness and contrast adjustments</em> as well as color correction and transformations.</li>
</ul>
<p class="rubric">Brightness and contrast adjustments</p>
<ul>
<li><p class="first">Two commonly used point processes are <em>multiplication</em> and <em>addition</em> with a constant:</p>
<div class="math notranslate nohighlight">
\[g(x) = \alpha f(x) + \beta\]</div>
</li>
<li><p class="first">The parameters <span class="math notranslate nohighlight">\(\alpha &gt; 0\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span> are often called the <em>gain</em> and <em>bias</em> parameters; sometimes these parameters are said to control <em>contrast</em> and <em>brightness</em> respectively.</p>
</li>
<li><p class="first">You can think of <span class="math notranslate nohighlight">\(f(x)\)</span> as the source image pixels and <span class="math notranslate nohighlight">\(g(x)\)</span> as the output image pixels. Then, more conveniently we can write the expression as:</p>
<div class="math notranslate nohighlight">
\[g(i,j) = \alpha \cdot f(i,j) + \beta\]</div>
<p>where <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span> indicates that the pixel is located in the <em>i-th</em> row and <em>j-th</em> column.</p>
</li>
</ul>
<p class="rubric">Code</p>
<ul>
<li><p class="first">The following code performs the operation <span class="math notranslate nohighlight">\(g(i,j) = \alpha \cdot f(i,j) + \beta\)</span> :</p>
<pre class="highlight literal-block">
<span></span><span class="cp">#include</span> <span class="cpf">&quot;opencv2/imgcodecs.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;opencv2/highgui.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <a class="reference internal" href="namespace_std.html#doxid-d8-dcc-namespacestd"><span class="std std-ref">std</span></a><span></span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <a class="reference internal" href="namespace_cv.html#doxid-d2-d75-namespacecv"><span class="std std-ref">cv</span></a><span></span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="kt">double</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span> <span class="cm">/*&lt; Simple contrast control */</span>
    <span class="kt">int</span> <span class="n">beta</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>       <span class="cm">/*&lt; Simple brightness control */</span>

    <a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat"><span class="std std-ref">Mat</span></a><span></span> <span class="n">image</span> <span class="o">=</span> <a class="reference internal" href="group_imgcodecs.html#doxid-d4-da8-group-imgcodecs-1ga288b8b3da0892bd651fce07b3bbd3a56"><span class="std std-ref">imread</span></a><span></span><span class="p">(</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">);</span>
    <a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat"><span class="std std-ref">Mat</span></a><span></span> <span class="n">new_image</span> <span class="o">=</span> <span class="n">Mat</span><span class="o">::</span><span class="n">zeros</span><span class="p">(</span> <span class="n">image</span><span class="p">.</span><a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat-1a146f8e8dda07d1365a575ab83d9828d1"><span class="std std-ref">size</span></a><span></span><span class="p">(),</span> <span class="n">image</span><span class="p">.</span><a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat-1af2d2652e552d7de635988f18a84b53e5"><span class="std std-ref">type</span></a><span></span><span class="p">()</span> <span class="p">);</span>

    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; Basic Linear Transforms &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;-------------------------&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;* Enter the alpha value [1.0-3.0]: &quot;</span><span class="p">;</span> <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">alpha</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;* Enter the beta value [0-100]: &quot;</span><span class="p">;</span>    <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">beta</span><span class="p">;</span>

    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">image</span><span class="p">.</span><a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat-1abed816466c45234254d25bc59c31245e"><span class="std std-ref">rows</span></a><span></span><span class="p">;</span> <span class="n">y</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">image</span><span class="p">.</span><a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat-1aa3e5a47585c9ef6a0842556739155e3e"><span class="std std-ref">cols</span></a><span></span><span class="p">;</span> <span class="n">x</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">c</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">c</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
                <span class="n">new_image</span><span class="p">.</span><a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat-1aa5d20fc86d41d59e4d71ae93daee9726"><span class="std std-ref">at</span></a><span></span><span class="o">&lt;</span><a class="reference internal" href="class_cv_Vec.html#doxid-db-d93-classcv-1-1-vec"><span class="std std-ref">Vec3b</span></a><span></span><span class="o">&gt;</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span>
                  <a class="reference internal" href="namespace_cv.html#doxid-db-de0-group-core-utils-1ga2858f5fe522e46a2e17662669199f6ff"><span class="std std-ref">saturate_cast&lt;uchar&gt;</span></a><span></span><span class="p">(</span> <span class="n">alpha</span><span class="o">*</span><span class="p">(</span> <span class="n">image</span><span class="p">.</span><a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat-1aa5d20fc86d41d59e4d71ae93daee9726"><span class="std std-ref">at</span></a><span></span><span class="o">&lt;</span><a class="reference internal" href="class_cv_Vec.html#doxid-db-d93-classcv-1-1-vec"><span class="std std-ref">Vec3b</span></a><span></span><span class="o">&gt;</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)[</span><span class="n">c</span><span class="p">]</span> <span class="p">)</span> <span class="o">+</span> <span class="n">beta</span> <span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <a class="reference internal" href="group_highgui.html#doxid-d7-dfc-group-highgui-1ga5afdf8410934fd099df85c75b2e0888b"><span class="std std-ref">namedWindow</span></a><span></span><span class="p">(</span><span class="s">&quot;Original Image&quot;</span><span class="p">,</span> <a class="reference internal" href="enum_cv_WindowFlags.html#doxid-d7-dfc-group-highgui-1ggabf7d2c5625bc59ac130287f925557ac3acf621ace7a54954cbac01df27e47228f"><span class="std std-ref">WINDOW_AUTOSIZE</span></a><span></span><span class="p">);</span>
    <a class="reference internal" href="group_highgui.html#doxid-d7-dfc-group-highgui-1ga5afdf8410934fd099df85c75b2e0888b"><span class="std std-ref">namedWindow</span></a><span></span><span class="p">(</span><span class="s">&quot;New Image&quot;</span><span class="p">,</span> <a class="reference internal" href="enum_cv_WindowFlags.html#doxid-d7-dfc-group-highgui-1ggabf7d2c5625bc59ac130287f925557ac3acf621ace7a54954cbac01df27e47228f"><span class="std std-ref">WINDOW_AUTOSIZE</span></a><span></span><span class="p">);</span>

    <a class="reference internal" href="group_highgui.html#doxid-d7-dfc-group-highgui-1ga453d42fe4cb60e5723281a89973ee563"><span class="std std-ref">imshow</span></a><span></span><span class="p">(</span><span class="s">&quot;Original Image&quot;</span><span class="p">,</span> <span class="n">image</span><span class="p">);</span>
    <a class="reference internal" href="group_highgui.html#doxid-d7-dfc-group-highgui-1ga453d42fe4cb60e5723281a89973ee563"><span class="std std-ref">imshow</span></a><span></span><span class="p">(</span><span class="s">&quot;New Image&quot;</span><span class="p">,</span> <span class="n">new_image</span><span class="p">);</span>

    <a class="reference internal" href="group_highgui.html#doxid-d7-dfc-group-highgui-1ga5628525ad33f52eab17feebcfba38bd7"><span class="std std-ref">waitKey</span></a><span></span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre>
</li>
</ul>
<p class="rubric">Explanation</p>
<ol class="arabic">
<li><p class="first">We begin by creating parameters to save <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span> to be entered by the user:</p>
<pre class="highlight literal-block">
<span></span><span class="kt">double</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span> <span class="cm">/*&lt; Simple contrast control */</span>
<span class="kt">int</span> <span class="n">beta</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>       <span class="cm">/*&lt; Simple brightness control */</span>
</pre>
</li>
<li><p class="first">We load an image using <a class="reference internal" href="group_imgcodecs.html#doxid-d4-da8-group-imgcodecs-1ga288b8b3da0892bd651fce07b3bbd3a56"><span class="std std-ref">cv::imread</span></a> and save it in a Mat object:</p>
<pre class="highlight literal-block">
<span></span><span class="n">Mat</span> <span class="n">image</span> <span class="o">=</span> <a class="reference internal" href="group_imgcodecs.html#doxid-d4-da8-group-imgcodecs-1ga288b8b3da0892bd651fce07b3bbd3a56"><span class="std std-ref">imread</span></a><span></span><span class="p">(</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">);</span>
</pre>
</li>
<li><p class="first">Now, since we will make some transformations to this image, we need a new Mat object to store it. Also, we want this to have the following features:</p>
<ul>
<li><p class="first">Initial pixel values equal to zero</p>
</li>
<li><p class="first">Same size and type as the original image</p>
<pre class="highlight literal-block">
<span></span><span class="n">Mat</span> <span class="n">new_image</span> <span class="o">=</span> <span class="n">Mat</span><span class="o">::</span><span class="n">zeros</span><span class="p">(</span> <span class="n">image</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">image</span><span class="p">.</span><span class="n">type</span><span class="p">()</span> <span class="p">);</span>
</pre>
<p>We observe that <a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat-1a0b57b6a326c8876d944d188a46e0f556"><span class="std std-ref">cv::Mat::zeros</span></a> returns a Matlab-style zero initializer based on <em>image.size()</em> and <em>image.type()</em></p>
</li>
</ul>
</li>
<li><p class="first">Now, to perform the operation <span class="math notranslate nohighlight">\(g(i,j) = \alpha \cdot f(i,j) + \beta\)</span> we will access to each pixel in image. Since we are operating with BGR images, we will have three values per pixel (B, G and R), so we will also access them separately. Here is the piece of code:</p>
<pre class="highlight literal-block">
<span></span><span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="n">y</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span> <span class="n">x</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">c</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">c</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
            <span class="n">new_image</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><a class="reference internal" href="namespace_cv.html#doxid-dc-d84-group-core-basic-1ga7e6060c0b8d48459964df6e1eb524c03"><span class="std std-ref">Vec3b</span></a><span></span><span class="o">&gt;</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span>
              <a class="reference internal" href="namespace_cv.html#doxid-db-de0-group-core-utils-1ga2858f5fe522e46a2e17662669199f6ff"><span class="std std-ref">saturate_cast&lt;uchar&gt;</span></a><span></span><span class="p">(</span> <span class="n">alpha</span><span class="o">*</span><span class="p">(</span> <span class="n">image</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><a class="reference internal" href="namespace_cv.html#doxid-dc-d84-group-core-basic-1ga7e6060c0b8d48459964df6e1eb524c03"><span class="std std-ref">Vec3b</span></a><span></span><span class="o">&gt;</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)[</span><span class="n">c</span><span class="p">]</span> <span class="p">)</span> <span class="o">+</span> <span class="n">beta</span> <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
<p>Notice the following:</p>
<ul class="simple">
<li>To access each pixel in the images we are using this syntax: <em>image.at&lt;Vec3b&gt;(y,x)[c]</em> where <em>y</em> is the row, <em>x</em> is the column and <em>c</em> is R, G or B (0, 1 or 2).</li>
<li>Since the operation <span class="math notranslate nohighlight">\(\alpha \cdot p(i,j) + \beta\)</span> can give values out of range or not integers (if <span class="math notranslate nohighlight">\(\alpha\)</span> is float), we use <a class="reference internal" href="group_core_utils.html#doxid-db-de0-group-core-utils-1gab93126370b85fda2c8bfaf8c811faeaf"><span class="std std-ref">cv::saturate_cast</span></a> to make sure the values are valid.</li>
</ul>
</li>
<li><p class="first">Finally, we create windows and show the images, the usual way.</p>
<pre class="highlight literal-block">
<a class="reference internal" href="group_highgui.html#doxid-d7-dfc-group-highgui-1ga5afdf8410934fd099df85c75b2e0888b"><span class="std std-ref">namedWindow</span></a><span></span><span class="p">(</span><span class="s">&quot;Original Image&quot;</span><span class="p">,</span> <a class="reference internal" href="enum_cv_WindowFlags.html#doxid-d7-dfc-group-highgui-1ggabf7d2c5625bc59ac130287f925557ac3acf621ace7a54954cbac01df27e47228f"><span class="std std-ref">WINDOW_AUTOSIZE</span></a><span></span><span class="p">);</span>
<a class="reference internal" href="group_highgui.html#doxid-d7-dfc-group-highgui-1ga5afdf8410934fd099df85c75b2e0888b"><span class="std std-ref">namedWindow</span></a><span></span><span class="p">(</span><span class="s">&quot;New Image&quot;</span><span class="p">,</span> <a class="reference internal" href="enum_cv_WindowFlags.html#doxid-d7-dfc-group-highgui-1ggabf7d2c5625bc59ac130287f925557ac3acf621ace7a54954cbac01df27e47228f"><span class="std std-ref">WINDOW_AUTOSIZE</span></a><span></span><span class="p">);</span>

<a class="reference internal" href="group_highgui.html#doxid-d7-dfc-group-highgui-1ga453d42fe4cb60e5723281a89973ee563"><span class="std std-ref">imshow</span></a><span></span><span class="p">(</span><span class="s">&quot;Original Image&quot;</span><span class="p">,</span> <span class="n">image</span><span class="p">);</span>
<a class="reference internal" href="group_highgui.html#doxid-d7-dfc-group-highgui-1ga453d42fe4cb60e5723281a89973ee563"><span class="std std-ref">imshow</span></a><span></span><span class="p">(</span><span class="s">&quot;New Image&quot;</span><span class="p">,</span> <span class="n">new_image</span><span class="p">);</span>

<a class="reference internal" href="group_highgui.html#doxid-d7-dfc-group-highgui-1ga5628525ad33f52eab17feebcfba38bd7"><span class="std std-ref">waitKey</span></a><span></span><span class="p">();</span>
</pre>
<p>Instead of using the <strong>for</strong> loops to access each pixel, we could have simply used this command:</p>
<pre class="highlight literal-block">
<span></span><span class="n">image</span><span class="p">.</span><span class="n">convertTo</span><span class="p">(</span><span class="n">new_image</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">);</span>
</pre>
<p>where <a class="reference internal" href="class_cv_Mat.html#doxid-db-de6-classcv-1-1-mat-1adf88c60c5b4980e05bb556080916978b"><span class="std std-ref">cv::Mat::convertTo</span></a> would effectively perform *new_image = a*image + beta*. However, we wanted to show you how to access each pixel. In any case, both methods give the same result but convertTo is more optimized and works a lot faster.</p>
<p class="rubric">Result</p>
</li>
</ol>
<ul>
<li><p class="first">Running our code and using <span class="math notranslate nohighlight">\(\alpha = 2.2\)</span> and <span class="math notranslate nohighlight">\(\beta = 50\)</span></p>
<pre class="highlight literal-block">
<span></span><span class="err">$</span> <span class="p">.</span><span class="o">/</span><span class="n">BasicLinearTransforms</span> <span class="n">lena</span><span class="p">.</span><span class="n">jpg</span>
<span class="n">Basic</span> <span class="n">Linear</span> <span class="n">Transforms</span>
<span class="o">-------------------------</span>
<span class="o">*</span> <span class="n">Enter</span> <span class="n">the</span> <span class="n">alpha</span> <span class="n">value</span> <span class="p">[</span><span class="mf">1.0</span><span class="o">-</span><span class="mf">3.0</span><span class="p">]</span><span class="o">:</span> <span class="mf">2.2</span>
<span class="o">*</span> <span class="n">Enter</span> <span class="n">the</span> <span class="n">beta</span> <span class="n">value</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">100</span><span class="p">]</span><span class="o">:</span> <span class="mi">50</span>
</pre>
</li>
<li><p class="first">We get this:</p>
<img alt="_images/Basic_Linear_Transform_Tutorial_Result_big.jpg" src="_images/Basic_Linear_Transform_Tutorial_Result_big.jpg" />
</li>
</ul>
<p class="rubric">Practical example</p>
<p>In this paragraph, we will put into practice what we have learned to correct an underexposed image by adjusting the brightness and the contrast of the image. We will also see another technique to correct the brightness of an image called gamma correction.</p>
<p class="rubric">Brightness and contrast adjustments</p>
<p>Increasing (/ decreasing) the <span class="math notranslate nohighlight">\(\beta\)</span> value will add (/ subtract) a constant value to every pixel. Pixel values outside of the [0 ; 255] range will be saturated (i.e. a pixel value higher (/ lesser) than 255 (/ 0) will be clamp to 255 (/ 0)).</p>
<img alt="In light gray, histogram of the original image, in dark gray when brightness = 80 in Gimp" src="_images/Basic_Linear_Transform_Tutorial_hist_beta.png" />
<p>The histogram represents for each color level the number of pixels with that color level. A dark image will have many pixels with low color value and thus the histogram will present a peak in his left part. When adding a constant bias, the histogram is shifted to the right as we have added a constant bias to all the pixels.</p>
<p>The <span class="math notranslate nohighlight">\(\alpha\)</span> parameter will modify how the levels spread. If <span class="math notranslate nohighlight">\(\alpha &lt; 1\)</span>, the color levels will be compressed and the result will be an image with less contrast.</p>
<img alt="In light gray, histogram of the original image, in dark gray when contrast &lt; 0 in Gimp" src="_images/Basic_Linear_Transform_Tutorial_hist_alpha.png" />
<p>Note that these histograms have been obtained using the Brightness-Contrast tool in the Gimp software. The brightness tool should be identical to the <span class="math notranslate nohighlight">\(\beta\)</span> bias parameters but the contrast tool seems to differ to the <span class="math notranslate nohighlight">\(\alpha\)</span> gain where the output range seems to be centered with Gimp (as you can notice in the previous histogram).</p>
<p>It can occur that playing with the <span class="math notranslate nohighlight">\(\beta\)</span> bias will improve the brightness but in the same time the image will appear with a slight veil as the contrast will be reduced. The <span class="math notranslate nohighlight">\(\alpha\)</span> gain can be used to diminue this effect but due to the saturation, we will lose some details in the original bright regions.</p>
<p class="rubric">Gamma correction</p>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Gamma_correction">Gamma correction</a> can be used to correct the brightness of an image by using a non linear transformation between the input values and the mapped output values:</p>
<div class="math notranslate nohighlight">
\[O = \left( \frac{I}{255} \right)^{\gamma} \times 255\]</div>
<p>As this relation is non linear, the effect will not be the same for all the pixels and will depend to their original value.</p>
<img alt="Plot for different values of gamma" src="_images/Basic_Linear_Transform_Tutorial_gamma.png" />
<p>When <span class="math notranslate nohighlight">\(\gamma &lt; 1\)</span>, the original dark regions will be brighter and the histogram will be shifted to the right whereas it will be the opposite with <span class="math notranslate nohighlight">\(\gamma &gt; 1\)</span>.</p>
<p class="rubric">Correct an underexposed image</p>
<p>The following image has been corrected with: <span class="math notranslate nohighlight">\(\alpha = 1.3\)</span> and <span class="math notranslate nohighlight">\(\beta = 40\)</span>.</p>
<img alt="By Visem (Own work) [CC BY-SA 3.0], via Wikimedia Commons" src="_images/Basic_Linear_Transform_Tutorial_linear_transform_correction.jpg" />
<p>The overall brightness has been improved but you can notice that the clouds are now greatly saturated due to the numerical saturation of the implementation used (<a class="reference external" href="https://en.wikipedia.org/wiki/Clipping_(photography)">highlight clipping</a> in photography).</p>
<p>The following image has been corrected with: <span class="math notranslate nohighlight">\(\gamma = 0.4\)</span>.</p>
<img alt="By Visem (Own work) [CC BY-SA 3.0], via Wikimedia Commons" src="_images/Basic_Linear_Transform_Tutorial_gamma_correction.jpg" />
<p>The gamma correction should tend to add less saturation effect as the mapping is non linear and there is no numerical saturation possible as in the previous method.</p>
<img alt="Left: histogram after alpha, beta correction ; Center: histogram of the original image ; Right: histogram after the gamma correction" src="_images/Basic_Linear_Transform_Tutorial_histogram_compare.png" />
<p>The previous figure compares the histograms for the three images (the y-ranges are not the same between the three histograms). You can notice that most of the pixel values are in the lower part of the histogram for the original image. After <span class="math notranslate nohighlight">\(\alpha\)</span>, <span class="math notranslate nohighlight">\(\beta\)</span> correction, we can observe a big peak at 255 due to the saturation as well as a shift in the right. After gamma correction, the histogram is shifted to the right but the pixels in the dark regions are more shifted (see the gamma curves <a class="reference external" href="Basic_Linear_Transform_Tutorial_gamma.png">figure</a>) than those in the bright regions.</p>
<p>In this tutorial, you have seen two simple methods to adjust the contrast and the brightness of an image. <strong>They are basic techniques and are not intended to be used as a replacement of a raster graphics editor!</strong></p>
<p class="rubric">Code</p>
<p>Code for the tutorial is <a class="reference external" href="https://github.com/opencv/opencv/blob/master/samples/cpp/tutorial_code/ImgProc/changing_contrast_brightness_image/changing_contrast_brightness_image.cpp">here</a>. Code for the gamma correction:</p>
<pre class="highlight literal-block">
<span></span><span class="n">Mat</span> <span class="n">lookUpTable</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <a class="reference internal" href="group_core_hal_interface.html#doxid-d1-d1b-group-core-hal-interface-1ga32b18d904ee2b1731a9416a8eef67d06"><span class="std std-ref">CV_8U</span></a><span></span><span class="p">);</span>
<a class="reference internal" href="group_core_hal_interface.html#doxid-d1-d1b-group-core-hal-interface-1ga65f85814a8290f9797005d3b28e7e5fc"><span class="std std-ref">uchar</span></a><span></span><span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="n">lookUpTable</span><span class="p">.</span><span class="n">ptr</span><span class="p">();</span>
<span class="k">for</span><span class="p">(</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <a class="reference internal" href="namespace_cv.html#doxid-db-de0-group-core-utils-1ga2858f5fe522e46a2e17662669199f6ff"><span class="std std-ref">saturate_cast&lt;uchar&gt;</span></a><span></span><span class="p">(</span><a class="reference internal" href="namespace_cv.html#doxid-d2-d75-namespacecv-1a8bc36646a43b82baa15f151a973fb0c5"><span class="std std-ref">pow</span></a><span></span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="mf">255.0</span><span class="p">,</span> <span class="n">gamma_</span><span class="p">)</span> <span class="o">*</span> <span class="mf">255.0</span><span class="p">);</span>

<span class="n">Mat</span> <span class="n">res</span> <span class="o">=</span> <span class="n">img</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span>
<a class="reference internal" href="group_core_array.html#doxid-d2-de8-group-core-array-1gab55b8d062b7f5587720ede032d34156f"><span class="std std-ref">LUT</span></a><span></span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">lookUpTable</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
</pre>
<p>A look-up table is used to improve the performance of the computation as only 256 values needs to be calculated once.</p>
<p class="rubric">Additional resources</p>
<ul class="simple">
<li><a class="reference external" href="https://learnopengl.com/#!Advanced-Lighting/Gamma-Correction">Gamma correction in graphics rendering</a></li>
<li><a class="reference external" href="http://www.graphics.cornell.edu/~westin/gamma/gamma.html">Gamma correction and images displayed on CRT monitors</a></li>
<li><a class="reference external" href="http://www.cambridgeincolour.com/tutorials/digital-exposure-techniques.htm">Digital exposure techniques</a></li>
</ul>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="page_tutorial_discrete_fourier_transform.html" title="Discrete Fourier Transform"
             >next</a> |</li>
        <li class="right" >
          <a href="page_tutorial_basic_geometric_drawing.html" title="Basic Drawing"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">OpenCV Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="page_tutorial_root.html" >OpenCV Tutorials</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="page_tutorial_table_of_content_core.html" >The Core Functionality (core module)</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 1999-2017, OpenCV Maintainers.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>