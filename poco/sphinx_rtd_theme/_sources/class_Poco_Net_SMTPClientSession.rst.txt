.. index:: pair: class; Poco::Net::SMTPClientSession
.. _doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session:

class Poco::Net::SMTPClientSession
==================================

.. toctree::
	:hidden:

	enum_Poco_Net_SMTPClientSession_LoginMethod.rst
	enum_Poco_Net_SMTPClientSession_StatusClass.rst

Overview
~~~~~~~~

This class implements an Simple Mail Transfer Protocol (SMTP, RFC 2821) client for sending e-mail messages. :ref:`More...<details-class_poco_1_1_net_1_1_s_m_t_p_client_session>`


.. ref-code-block:: cpp
	:class: doxyrest-overview-code-block

	#include <SMTPClientSession.h>
	
	class SMTPClientSession
	{
	public:
		// typedefs
	
		typedef std::vector<std::string> :target:`Recipients<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a4fd335c1a7d4d2a108bbad694155a10f>`;

		// enums
	
		enum
		{
		    :target:`SMTP_PORT<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a3abcb9299e31af1b5299fbf8509355eda30025fcbbd32630c9d13b0b9302654d8>` = 25,
		};
	
		enum :ref:`LoginMethod<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1adba0bcdd171b26ecaae7fac6dcfb6439>`;

		// construction
	
		:ref:`SMTPClientSession<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a011a3a9db575f2eb3f83e56dfe7520ca>`(:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` :ref:`StreamSocket<doxid-class_poco_1_1_net_1_1_stream_socket>`& socket);
	
		:ref:`SMTPClientSession<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a275b7a397f82f84ca63c90941197a578>`(
			:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& host,
			Poco::UInt16 port = :ref:`SMTP_PORT<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a3abcb9299e31af1b5299fbf8509355eda30025fcbbd32630c9d13b0b9302654d8>`
			);

		// methods
	
		void
		:ref:`setTimeout<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a412af28aa83cc55f2e6141595dd49346>`(:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` :ref:`Poco::Timespan<doxid-class_poco_1_1_timespan>`& timeout);
	
		:ref:`Poco::Timespan<doxid-class_poco_1_1_timespan>`
		:ref:`getTimeout<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a93a09bc8d60548840dac788d2e0c76cf>`() const;
	
		void
		:ref:`login<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a4c06024c3aa9b8f4b1ac533f7a99bd2e>`(:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& hostname);
	
		void
		:ref:`login<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1aab851514102f94509d3b4e371c103b1b>`();
	
		void
		:ref:`login<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a936496d2151fa36927a445a3a87ee1e7>`(
			:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& hostname,
			:ref:`LoginMethod<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1adba0bcdd171b26ecaae7fac6dcfb6439>` loginMethod,
			:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& username,
			:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& password
			);
	
		void
		:ref:`login<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1ad570f8436becacc7ca6373b012481630>`(
			:ref:`LoginMethod<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1adba0bcdd171b26ecaae7fac6dcfb6439>` loginMethod,
			:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& username,
			:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& password
			);
	
		void
		:ref:`open<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1ad9bfab98acbbcad779d864155f2eafbb>`();
	
		void
		:ref:`close<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a202bc20c0fc8aa98bebf6d7d5642c7d2>`();
	
		void
		:ref:`sendMessage<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a90f52c68615b0ad7bbbfc75ab01df0d4>`(:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` :ref:`MailMessage<doxid-class_poco_1_1_net_1_1_mail_message>`& message);
	
		void
		:ref:`sendMessage<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a8488425f39190b4b47b68cb4b27fa682>`(
			:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` :ref:`MailMessage<doxid-class_poco_1_1_net_1_1_mail_message>`& message,
			:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` :ref:`Recipients<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a4fd335c1a7d4d2a108bbad694155a10f>`& recipients
			);
	
		void
		:ref:`sendMessage<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1adcd11950699f35cc3944022930802d9c>`(std::istream& istr);
	
		int
		:ref:`sendCommand<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a811655e25b5023267c27808fcae00200>`(
			:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& command,
			std::string& response
			);
	
		int
		:ref:`sendCommand<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1ad061d91ade8b8712378cea243707f6ce>`(
			:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& command,
			:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& arg,
			std::string& response
			);
	
		void
		:ref:`sendAddresses<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a46a0f2a5bcddf648e6b428d5429ec9c1>`(
			:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& from,
			:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` :ref:`Recipients<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a4fd335c1a7d4d2a108bbad694155a10f>`& recipients
			);
	
		void
		:ref:`sendData<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1ae13613715d65a172a4662f6b83f9951a>`();

	protected:
		// enums
	
		enum
		{
		    :target:`DEFAULT_TIMEOUT<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a0f07575c416a55ec8cf2407ec65f68e3a3b174f0914c6c7f512bdb1bcd55acf46>` = 30000000,
		};
	
		enum :ref:`StatusClass<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a314e0970541aebaea5590fdd78ee88c2>`;

		// methods
	
		static
		bool
		:target:`isPositiveCompletion<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a8fa9aa2accf2e5a5e25cdd3704760ea2>`(int status);
	
		static
		bool
		:target:`isPositiveIntermediate<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1af06dc23fa33bc17925a0d9303aa5a0e2>`(int status);
	
		static
		bool
		:target:`isTransientNegative<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a7f21398414679af64aa398e0efdd1fe5>`(int status);
	
		static
		bool
		:target:`isPermanentNegative<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a8b41d5770e845d6b69358b4c1807fe19>`(int status);
	
		void
		:target:`login<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a80852f050ac7dccdafbd14adb9af4dd8>`(
			:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& hostname,
			std::string& response
			);
	
		void
		:target:`loginUsingCRAMMD5<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a2972596687abf38b1d766f24bff29f68>`(
			:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& username,
			:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& password
			);
	
		void
		:target:`loginUsingCRAMSHA1<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a527fbae87db1f4accea9ef89b6abf3a8>`(
			:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& username,
			:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& password
			);
	
		void
		:target:`loginUsingCRAM<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1ae1ccabd53526641c9dc3ad69b1e81a0a>`(
			:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& username,
			:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& method,
			:ref:`Poco::DigestEngine<doxid-class_poco_1_1_digest_engine>`& hmac
			);
	
		void
		:target:`loginUsingLogin<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a1b85f364595c7edc7eeed8153b7b16a5>`(
			:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& username,
			:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& password
			);
	
		void
		:target:`loginUsingPlain<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a17d5a10bcd5b429d014daf313c0c6c91>`(
			:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& username,
			:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& password
			);
	
		void
		:target:`loginUsingXOAUTH2<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1abd720c5b7ffabfa32aafd8f98827e5ba>`(
			:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& username,
			:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& password
			);
	
		:ref:`DialogSocket<doxid-class_poco_1_1_net_1_1_dialog_socket>`&
		:target:`socket<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a527d74cda34843b38b971dcdc448b76b>`();
	};
.. _details-class_poco_1_1_net_1_1_s_m_t_p_client_session:

Detailed Documentation
~~~~~~~~~~~~~~~~~~~~~~

This class implements an Simple Mail Transfer Protocol (SMTP, RFC 2821) client for sending e-mail messages.

Construction
------------

.. index:: pair: function; SMTPClientSession
.. _doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a011a3a9db575f2eb3f83e56dfe7520ca:

.. ref-code-block:: cpp
	:class: doxyrest-title-code-block

	SMTPClientSession(:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` :ref:`StreamSocket<doxid-class_poco_1_1_net_1_1_stream_socket>`& socket)

Creates the :ref:`SMTPClientSession <doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session>` using the given socket, which must be connected to a SMTP server.

.. index:: pair: function; SMTPClientSession
.. _doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a275b7a397f82f84ca63c90941197a578:

.. ref-code-block:: cpp
	:class: doxyrest-title-code-block

	SMTPClientSession(
		:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& host,
		Poco::UInt16 port = :ref:`SMTP_PORT<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a3abcb9299e31af1b5299fbf8509355eda30025fcbbd32630c9d13b0b9302654d8>`
		)

Creates the :ref:`SMTPClientSession <doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session>` using a socket connected to the given host and port.

Methods
-------

.. index:: pair: function; setTimeout
.. _doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a412af28aa83cc55f2e6141595dd49346:

.. ref-code-block:: cpp
	:class: doxyrest-title-code-block

	void
	setTimeout(:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` :ref:`Poco::Timespan<doxid-class_poco_1_1_timespan>`& timeout)

Sets the timeout for socket read operations.

.. index:: pair: function; getTimeout
.. _doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a93a09bc8d60548840dac788d2e0c76cf:

.. ref-code-block:: cpp
	:class: doxyrest-title-code-block

	:ref:`Poco::Timespan<doxid-class_poco_1_1_timespan>`
	getTimeout() const

Returns the timeout for socket read operations.

.. index:: pair: function; login
.. _doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a4c06024c3aa9b8f4b1ac533f7a99bd2e:

.. ref-code-block:: cpp
	:class: doxyrest-title-code-block

	void
	login(:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& hostname)

Greets the SMTP server by sending a EHLO command with the given hostname as argument.

If the server does not understand the EHLO command, a HELO command is sent instead.

Throws a SMTPException in case of a SMTP-specific error, or a NetException in case of a general network communication failure.

.. index:: pair: function; login
.. _doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1aab851514102f94509d3b4e371c103b1b:

.. ref-code-block:: cpp
	:class: doxyrest-title-code-block

	void
	login()

Calls login(hostname) with the current host name.

.. index:: pair: function; login
.. _doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a936496d2151fa36927a445a3a87ee1e7:

.. ref-code-block:: cpp
	:class: doxyrest-title-code-block

	void
	login(
		:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& hostname,
		:ref:`LoginMethod<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1adba0bcdd171b26ecaae7fac6dcfb6439>` loginMethod,
		:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& username,
		:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& password
		)

Logs in to the SMTP server using the given authentication method and the given credentials.

.. index:: pair: function; login
.. _doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1ad570f8436becacc7ca6373b012481630:

.. ref-code-block:: cpp
	:class: doxyrest-title-code-block

	void
	login(
		:ref:`LoginMethod<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1adba0bcdd171b26ecaae7fac6dcfb6439>` loginMethod,
		:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& username,
		:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& password
		)

Logs in to the SMTP server using the given authentication method and the given credentials.

.. index:: pair: function; open
.. _doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1ad9bfab98acbbcad779d864155f2eafbb:

.. ref-code-block:: cpp
	:class: doxyrest-title-code-block

	void
	open()

Reads the initial response from the SMTP server.

Usually called implicitly through :ref:`login() <doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1aab851514102f94509d3b4e371c103b1b>`, but can also be called explicitly to implement different forms of SMTP authentication.

Does nothing if called more than once.

.. index:: pair: function; close
.. _doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a202bc20c0fc8aa98bebf6d7d5642c7d2:

.. ref-code-block:: cpp
	:class: doxyrest-title-code-block

	void
	close()

Sends a QUIT command and closes the connection to the server.

Throws a SMTPException in case of a SMTP-specific error, or a NetException in case of a general network communication failure.

.. index:: pair: function; sendMessage
.. _doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a90f52c68615b0ad7bbbfc75ab01df0d4:

.. ref-code-block:: cpp
	:class: doxyrest-title-code-block

	void
	sendMessage(:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` :ref:`MailMessage<doxid-class_poco_1_1_net_1_1_mail_message>`& message)

Sends the given mail message by sending a MAIL FROM command, a RCPT TO command for every recipient, and a DATA command with the message headers and content.

Using this function results in RCPT TO commands list generated from the recipient list supplied with the message itself.

Throws a SMTPException in case of a SMTP-specific error, or a NetException in case of a general network communication failure.

.. index:: pair: function; sendMessage
.. _doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a8488425f39190b4b47b68cb4b27fa682:

.. ref-code-block:: cpp
	:class: doxyrest-title-code-block

	void
	sendMessage(
		:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` :ref:`MailMessage<doxid-class_poco_1_1_net_1_1_mail_message>`& message,
		:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` :ref:`Recipients<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a4fd335c1a7d4d2a108bbad694155a10f>`& recipients
		)

Sends the given mail message by sending a MAIL FROM command, a RCPT TO command for every recipient, and a DATA command with the message headers and content.

Using this function results in message header being generated from the supplied recipients list.

Throws a SMTPException in case of a SMTP-specific error, or a NetException in case of a general network communication failure.

.. index:: pair: function; sendMessage
.. _doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1adcd11950699f35cc3944022930802d9c:

.. ref-code-block:: cpp
	:class: doxyrest-title-code-block

	void
	sendMessage(std::istream& istr)

Sends the mail message from the supplied stream.

Content of the stream is copied without any checking. Only the completion status is checked and, if not valid, SMTPExcpetion is thrown.

.. index:: pair: function; sendCommand
.. _doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a811655e25b5023267c27808fcae00200:

.. ref-code-block:: cpp
	:class: doxyrest-title-code-block

	int
	sendCommand(
		:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& command,
		std::string& response
		)

Sends the given command verbatim to the server and waits for a response.

Throws a SMTPException in case of a SMTP-specific error, or a NetException in case of a general network communication failure.

.. index:: pair: function; sendCommand
.. _doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1ad061d91ade8b8712378cea243707f6ce:

.. ref-code-block:: cpp
	:class: doxyrest-title-code-block

	int
	sendCommand(
		:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& command,
		:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& arg,
		std::string& response
		)

Sends the given command verbatim to the server and waits for a response.

Throws a SMTPException in case of a SMTP-specific error, or a NetException in case of a general network communication failure.

.. index:: pair: function; sendAddresses
.. _doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a46a0f2a5bcddf648e6b428d5429ec9c1:

.. ref-code-block:: cpp
	:class: doxyrest-title-code-block

	void
	sendAddresses(
		:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` std::string& from,
		:ref:`const<doxid-zconf_8h_1a2c212835823e3c54a8ab6d95c652660e>` :ref:`Recipients<doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1a4fd335c1a7d4d2a108bbad694155a10f>`& recipients
		)

Sends the message preamble by sending a MAIL FROM command, and a RCPT TO command for every recipient.

Throws a SMTPException in case of a SMTP-specific error, or a NetException in case of a general network communication failure.

.. index:: pair: function; sendData
.. _doxid-class_poco_1_1_net_1_1_s_m_t_p_client_session_1ae13613715d65a172a4662f6b83f9951a:

.. ref-code-block:: cpp
	:class: doxyrest-title-code-block

	void
	sendData()

Sends the message preamble by sending a DATA command.

Throws a SMTPException in case of a SMTP-specific error, or a NetException in case of a general network communication failure.

